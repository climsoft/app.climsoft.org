"use strict";(self.webpackChunkclimsoft_app=self.webpackChunkclimsoft_app||[]).push([[407],{7777:($,S,d)=>{d.d(S,{C:()=>y});var _=d(3668);let y=(()=>{class Z{constructor(){this.unSaved=!0}canDeactivate(c){return!c.canExit||c.canExit()}}return Z.\u0275fac=function(c){return new(c||Z)},Z.\u0275prov=_.Yz7({token:Z,factory:Z.\u0275fac,providedIn:"root"}),Z})()},407:($,S,d)=>{d.r(S),d.d(S,{DataEntryModule:()=>rr});var _=d(6019),y=d(4333),Z=d(1850),t=d(3668),c=d(2606);const T=function(n){return[n]};function E(n,a){if(1&n&&(t.TgZ(0,"c-nav-item",6),t._uU(1,"\n            "),t.TgZ(2,"a",7),t._uU(3),t.ALo(4,"uppercase"),t.qZA(),t._uU(5,"\n          "),t.qZA()),2&n){const e=a.$implicit,o=a.index;t.oxw();const r=t.MAs(14);t.Q6J("cTabContent",r)("tabPaneIdx",o),t.xp6(2),t.Q6J("routerLink",t.VKq(6,T,e.route)),t.xp6(1),t.hij(" ",t.lcZ(4,4,e.name),"")}}let A=(()=>{class n{constructor(e,o){this.router=e,this.route=o,this.tabs=[{name:"Hourly",route:"hourly",index:0},{name:"Hourly Wind",route:"hourly-wind",index:1},{name:"Daily",route:"daily",index:2},{name:"Monthly",route:"monthly",index:3},{name:"Synoptic 2 RA1",route:"synoptic-2ra1",index:5},{name:"Agro",route:"agro",index:6}]}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(Z.F0),t.Y36(Z.gz))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-data-entry-base"]],decls:28,vars:1,consts:[["xs","12"],[1,"mb-4"],["variant","tabs"],["aria-disabled","",3,"cTabContent","tabPaneIdx",4,"ngFor","ngForOf"],["dataEntryTabContent","cTabContent"],["xs","12","lg","12",1,"p-4"],["aria-disabled","",3,"cTabContent","tabPaneIdx"],["cNavLink","","routerLinkActive","active",3,"routerLink"]],template:function(e,o){1&e&&(t.TgZ(0,"c-row"),t._uU(1,"\n  "),t.TgZ(2,"c-col",0),t._uU(3,"\n    "),t.TgZ(4,"c-card",1),t._uU(5,"\n      "),t.TgZ(6,"c-card-body"),t._uU(7,"\n        "),t.TgZ(8,"c-nav",2),t._uU(9,"\n          "),t.YNc(10,E,6,8,"c-nav-item",3),t._uU(11,"\n        "),t.qZA(),t._uU(12,"\n        "),t.TgZ(13,"c-tab-content",null,4),t._uU(15,"\n          "),t.TgZ(16,"c-row"),t._uU(17,"\n            "),t.TgZ(18,"c-col",5),t._uU(19,"\n              "),t._UZ(20,"router-outlet"),t._uU(21,"\n            "),t.qZA(),t._uU(22,"\n          "),t.qZA(),t._uU(23,"\n        "),t.qZA(),t._uU(24,"\n      "),t.qZA(),t._uU(25,"\n    "),t.qZA(),t._uU(26,"\n  "),t.qZA(),t._uU(27,"\n"),t.qZA()),2&e&&(t.xp6(10),t.Q6J("ngForOf",o.tabs))},directives:[c.iok,c.Yp0,c.AkF,c.yue,c.rZi,_.sg,c.C$2,Z.lC,c.HOP,c.hL0,Z.yS,c.Vh3,Z.Od],pipes:[_.gd],styles:['.nav-item-link-after[_ngcontent-%COMP%], .nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%] > .nav-link[_ngcontent-%COMP%]:hover:after, .nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%] > .nav-link.active[_ngcontent-%COMP%]:after{content:"";background-color:#458cff;height:2px;position:absolute;width:100%;left:0;bottom:-1px;transition:all .25s ease 0s;transform:scale(0)}.nav-tabs[_ngcontent-%COMP%]{border-bottom:2px solid #eaeaea}.nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]{border:none;color:#141922;border-width:0}.nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%] > .nav-link[_ngcontent-%COMP%]{border:none;color:#141922;position:relative}.nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%] > .nav-link[_ngcontent-%COMP%], .nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%] > .nav-link[_ngcontent-%COMP%]:hover{border:none;color:#141922!important}.nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%] > .nav-link.active[_ngcontent-%COMP%], .nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%] > .nav-link.active[_ngcontent-%COMP%]:hover{border:none;color:#141922!important;font-weight:600;background-color:#fff}.nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:after, .nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]:after, .nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover:after{transform:scale(1)}']}),n})();var w=d(7384),m=d(461),f=d(2835),C=d(4753),h=d(2098),l=d(9133),M=d(9468),O=d(2997),g=d(2070),q=d(2719),u=(()=>{return(n=u||(u={})).N="",n.M="M",n.T="T",n.E="E",n.G="G",n.D="D",u;var n})();const F=["N","M","T","E","G","D"],b={N:{label:"No Flag",class:"btn-empty"},M:{label:"Missing",class:"btn-missing"},T:{label:"Trace",class:"btn-trace"},E:{label:"Estimated",class:"btn-estimated"},G:{label:"Generated",class:"btn-generated"},D:{label:"Dubious",class:"btn-dubious"}};var x=d(4437),D=d(3834),H=d(4499),vt=d(453);const ot="/v1/form_hourlys",nt="/v1/form_hourlywinds",rt="/v1/form_daily2s",it="/v1/form_monthlys",lt="/v1/form_synoptic_2_ra1s",at="/v1/form_agro1s";let U=(()=>{class n{constructor(e){this.http=e,this.hourlyState$=new H.X(!1),this.hourlyWindState$=new H.X(!1),this.dailyState$=new H.X(!1),this.monthlyState$=new H.X(!1),this.synopticState$=new H.X(!1),this.agroState$=new H.X(!1)}get dailyState(){return this.dailyState$.asObservable()}get hourlyState(){return this.hourlyState$.asObservable()}get hourlyWindState(){return this.hourlyWindState$.asObservable()}get monthlyState(){return this.monthlyState$.asObservable()}get agroState(){return this.agroState$.asObservable()}get synopticState(){return this.synopticState$.asObservable()}getDailyEntry(e,o,r,i,s){return this.updateDailyState({station:e,element:o,monthYear:`${i}-1-${r}`,hour:s}),this.http.GET(`${rt}?station_id=${e}&element_id=${o}&yyyy=${r}&mm=${i}&hh=${s}&limit=25&offset=0`)}addDailyEntry(e){return this.http.POST(`${rt}`,e)}updateDailyEntry(e,o,r,i,s,p){return this.http.PUT(`${rt}/${e}/${o}/${r}/${i}/${s}`,p)}updateDailyState(e){this.dailyState$.next(e)}resetDailyState(){this.dailyState$.next(!1)}getHourlyEntry(e,o,r,i,s){return this.updateHourlyState({station:e,element:o,date:new Date(`${i}-${s}-${r}`).toISOString()}),this.http.GET(`${ot}?station_id=${e}&element_id=${o}&yyyy=${r}&mm=${i}&dd=${s}&limit=25&offset=0`)}addHourlyEntry(e){return this.http.POST(`${ot}`,e)}updateHourlyEntry(e,o,r,i,s,p){return this.http.PUT(`${ot}/${e}/${o}/${r}/${i}/${s}`,p)}updateHourlyState(e){this.hourlyState$.next(e)}resetHourlyState(){this.hourlyState$.next(!1)}elementLookup(e){return this.http.GET(`/v1/obselements/${e}`)}getRegKeys(){return this.http.GET("/v1/reg-keys")}getHourlyWindEntry(e,o,r,i){return this.updateHourlyWindState({station:e,date:new Date(`${r}-${i}-${o}`).toISOString()}),this.http.GET(`${nt}?station_id=${e}&yyyy=${o}&mm=${r}&dd=${i}&limit=25&offset=0`)}addHourlyWindEntry(e){return this.http.POST(`${nt}`,e)}updateHourlyWindEntry(e,o,r,i,s){return this.http.PUT(`${nt}/${e}/${o}/${r}/${i}`,s)}updateHourlyWindState(e){this.hourlyWindState$.next(e)}resetHourlyWindState(){this.hourlyWindState$.next(!1)}getMonthlyEntry(e,o,r){return console.log(r),this.updateMonthlyState({station:e,element:o,year:new Date(`1-1-${r}`).toISOString()}),this.http.GET(`${it}?station_id=${e}&element_id=${o}&yyyy=${r}&limit=25&offset=0`)}addMonthlyEntry(e){return this.http.POST(`${it}`,e)}updateMonthlyEntry(e,o,r,i){return this.http.PUT(`${it}/${e}/${o}/${r}`,i)}updateMonthlyState(e){this.monthlyState$.next(e)}resetMonthlyState(){this.monthlyState$.next(!1)}getSynopticEntry(e,o,r,i,s){return this.synopticState$.next({station:e,year:o,month:r,day:i,hour:s}),this.http.GET(`${lt}/${e}/${o}/${r}/${i}/${s}`)}addSynopticEntry(e){return this.http.POST(lt,e)}updateSynopEntry(e,o,r,i,s,p){return this.http.PUT(`${lt}/${e}/${o}/${r}/${i}/${s}`,p)}updateSynopticState(e,o,r,i,s){this.synopticState$.next({station:e,year:o,month:r,day:i,hour:s})}getAgroEntry(e,o,r,i){return this.updateAgroState({station:e,year:o,month:r,day:i}),this.http.GET(`${at}/${e}/${o}/${r}/${i}`)}addAgroEntry(e){return this.http.POST(`${at}`,e)}updateAgroEntry(e,o,r,i,s){return this.http.PUT(`${at}/${e}/${o}/${r}/${i}`,s)}updateAgroState(e){this.agroState$.next(e)}resetAgroState(){this.agroState$.next(!1)}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(vt.O))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var V=d(9935);function Ct(n,a){if(1&n&&(t.TgZ(0,"li"),t.TgZ(1,"div"),t._uU(2),t.qZA(),t.qZA()),2&n){const e=a.$implicit;t.xp6(1),t.Gre("inner ",e.class,""),t.xp6(1),t.hij(" ",e.value||"Empty"," ")}}let P=(()=>{class n{constructor(){}ngOnInit(){console.log(b)}get flags(){return Object.keys(b).filter(e=>"N"!==e).map(e=>({key:e,value:b[e].label,class:b[e].class}))}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-flag-legend"]],decls:3,vars:1,consts:[[1,"flag-legend"],[4,"ngFor","ngForOf"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"ul"),t.YNc(2,Ct,3,4,"li",1),t.qZA(),t.qZA()),2&e&&(t.xp6(2),t.Q6J("ngForOf",o.flags))},directives:[_.sg],styles:[".flag-legend[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding:0}.flag-legend[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{list-style:none;display:inline-block}.flag-legend[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]{font-size:.8rem;padding:.1rem .6rem .2rem;border:1px solid #2a3f4d;border-radius:1.5rem;line-height:.9rem;color:#fff}.flag-legend[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .inner.btn-empty[_ngcontent-%COMP%]{color:#4f5d73;background-color:#ecc9c9}.flag-legend[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .inner.btn-missing[_ngcontent-%COMP%]{color:#e60000;background-color:#ecc9c9}.flag-legend[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .inner.btn-trace[_ngcontent-%COMP%]{background-color:#4f5d73}.flag-legend[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .inner.btn-estimated[_ngcontent-%COMP%]{background-color:#9da5b1}.flag-legend[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .inner.btn-generated[_ngcontent-%COMP%]{background-color:#39f}.flag-legend[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .inner.btn-dubious[_ngcontent-%COMP%]{background-color:#f9b115}.flag-legend[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%] + li[_ngcontent-%COMP%]{padding:.1rem}"]}),n})();var J=d(8063),k=d(4859),j=d(4379),Y=d(5154),Q=d(5077);function Zt(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"li"),t.TgZ(1,"button",5),t.NdJ("click",function(){const i=t.CHM(e).$implicit;return t.oxw().selectFlag(i)}),t._uU(2),t.qZA(),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw();t.xp6(1),t.Q6J("ngClass",o.flagConfig[e].class),t.xp6(1),t.hij(" ",e," ")}}const bt=function(n){return{enabled:n}},xt=function(n){return{disabled:n}};let L=(()=>{class n{constructor(e){this._eref=e,this.disabled=!1,this.onSelect=new t.vpe,this.flags=F,this.flagConfig=b,this.activeFlag="N",this.toggled=!1}onDocumentClick(e){e.stopPropagation(),this._eref.nativeElement.contains(e.target)||(this.toggled=!1)}ngOnInit(){}ngOnChanges(e){e.flag&&e.flag.currentValue&&(this.activeFlag=e.flag.currentValue)}toggleActive(){this.disabled||(this.toggled=!this.toggled)}selectFlag(e){this.activeFlag=e,this.toggled=!1,this.onSelect.emit(e)}get activeLabel(){return this.flagConfig[this.activeFlag].label}get filteredFlags(){return this.flags.filter(e=>"N"!==e)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(t.SBq))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-flag-picker"]],hostBindings:function(e,o){1&e&&t.NdJ("click",function(i){return o.onDocumentClick(i)},!1,t.evT)},inputs:{flag:"flag",disabled:"disabled"},outputs:{onSelect:"onSelect"},features:[t.TTD],decls:8,vars:12,consts:[[1,"flag-picker",3,"ngClass"],[1,"inner"],[3,"cTooltip","ngClass","click"],["type","button",1,"btn","btn-circle","btn-light",3,"click"],[4,"ngFor","ngForOf"],["type","button",1,"btn","btn-circle",3,"ngClass","click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"a",2),t.NdJ("click",function(){return o.toggleActive()}),t._uU(3),t.qZA(),t.qZA(),t.TgZ(4,"ul"),t.TgZ(5,"li"),t.TgZ(6,"button",3),t.NdJ("click",function(){return o.selectFlag("N")}),t.qZA(),t.qZA(),t.YNc(7,Zt,3,2,"li",4),t.qZA(),t.qZA()),2&e&&(t.Q6J("ngClass",t.VKq(8,bt,o.toggled)),t.xp6(2),t.Gre("active-flag btn ",o.flagConfig[o.activeFlag].class,""),t.Q6J("cTooltip",o.activeLabel)("ngClass",t.VKq(10,xt,o.disabled)),t.xp6(1),t.hij(" ","N"===o.activeFlag?" ":o.activeFlag," "),t.xp6(4),t.Q6J("ngForOf",o.filteredFlags))},directives:[_.mk,c.i9q,_.sg],styles:[".flag-picker[_ngcontent-%COMP%]{position:relative;display:inline-block}.flag-picker[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{display:none;position:absolute;left:0;top:2.5rem;z-index:10;transition:all ease-in-out .3s;padding:.4rem .1rem;background-color:#edeefa;border:1px solid #cfd0dc;border-radius:1.5rem;box-shadow:#00000040 1px 1px 0 1px}.flag-picker[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{list-style:none;padding:.2rem}.flag-picker.enabled[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{display:block}.flag-picker.enabled[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:inline-block}.flag-picker[_ngcontent-%COMP%]   .active-flag[_ngcontent-%COMP%]{display:inline-block;width:2.5rem;height:2.3rem;padding:.25rem .5rem;border-radius:.5rem;border:1px solid #034566;background-color:#ebedef;color:#fff;font-size:1.1rem;font-weight:600;cursor:pointer;text-decoration:none}.flag-picker[_ngcontent-%COMP%]   .active-flag.disabled[_ngcontent-%COMP%]{cursor:not-allowed}.flag-picker[_ngcontent-%COMP%]   .active-flag.btn-light[_ngcontent-%COMP%]{color:#33434b;background-color:#ecc9c9}.flag-picker[_ngcontent-%COMP%]   .active-flag.btn-missing[_ngcontent-%COMP%]{background-color:#ecc9c9;color:#e60000;padding:.3rem}.flag-picker[_ngcontent-%COMP%]   .active-flag.btn-trace[_ngcontent-%COMP%]{background-color:#4f5d73}.flag-picker[_ngcontent-%COMP%]   .active-flag.btn-estimated[_ngcontent-%COMP%]{color:#33434b;background-color:#9da5b1}.flag-picker[_ngcontent-%COMP%]   .active-flag.btn-generated[_ngcontent-%COMP%]{background-color:#39f}.flag-picker[_ngcontent-%COMP%]   .active-flag.btn-dubious[_ngcontent-%COMP%]{background-color:#f9b115}.btn-circle[_ngcontent-%COMP%]{width:2rem;height:2rem;padding:.3rem 0;border-radius:1.2rem;text-align:center;font-size:.9rem;font-weight:bold;line-height:.5rem}.btn-circle.btn-light[_ngcontent-%COMP%]{background-color:#ebedef;color:#4f5d73;border:1px solid #33434b}.btn-circle.btn-missing[_ngcontent-%COMP%]{color:#e60000;background-color:#ecc9c9;border:1px solid #e60000}.btn-circle.btn-trace[_ngcontent-%COMP%]{color:#ebedef;background-color:#4f5d73}.btn-circle.btn-estimated[_ngcontent-%COMP%]{color:#33434b;background-color:#9da5b1}.btn-circle.btn-generated[_ngcontent-%COMP%]{background-color:#39f}.btn-circle.btn-dubious[_ngcontent-%COMP%]{background-color:#f9b115}"]}),n})();const Tt=["inputValue"];function wt(n,a){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Oqu(e.fg.label.value)}}function Ft(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"button",10),t.NdJ("click",function(){return t.CHM(e),t.oxw().revert()}),t._uU(1),t.qZA()}if(2&n){const e=t.oxw();t.xp6(1),t.Oqu(e.fg.label.value)}}let At=(()=>{class n{constructor(e){this.ref=e,this.modified=!1,this.group=new l.cw({index:new l.NI(0),element:new l.NI(0),label:new l.NI("No Value"),value:new l.NI(null,l.kI.required),flag:new l.NI(u.N)}),this.disabled=!1,this.onDirty=new t.vpe,this.onRevert=new t.vpe,this.onFocus=new t.vpe,this.onBlur=new t.vpe,this.onReturn=new t.vpe,this.valFocus=!1,this.hasFocus=!1}ngOnInit(){this.group.valueChanges.pipe((0,m.h)(e=>!this.modified)).subscribe(e=>{this.onDirty.emit(!0)})}ngAfterViewInit(){(0,Q.R)(this.ref.nativeElement,"keyup").pipe((0,m.h)(e=>13===e.keyCode&&this.valFocus)).subscribe(e=>{this.onValRetunKey()})}ngOnChanges(e){this.disabled?this.group.disable():this.group.enable()}selectFlag(e){this.group.controls.flag.setValue(e)}focusValue(){this.txtVal.nativeElement.focus()}get fg(){return this.group.controls}get isDirty(){return this.fg.value.dirty||this.fg.flag.dirty}get isInvalid(){return this.fg.value.dirty&&this.fg.value.value&&this.fg.flag.value===u.M}get styles(){const e={"has-focus":this.hasFocus};return this.isDirty&&(e["is-dirty"]=!0),this.isInvalid&&(e["is-dirty"]=!1,e["is-invalid"]=!0),e}onValRetunKey(){(!this.fg.value.value||0==+this.fg.value.value)&&this.fg.flag.setValue(u.M),this.onReturn.emit(+this.fg.index.value)}onValueFocus(){this.hasFocus=!0,this.onFocus.emit(this.fg.index.value),this.valFocus=!0}onValueBlur(e){this.hasFocus=!1;const o=this.fg.value.value;this.pristine&&this.pristine.value===o&&""!==o&&this.fg.value.markAsPristine(),""===o&&this.fg.flag.value!==u.M&&this.selectFlag(u.M),""!==o&&this.fg.flag.value===u.M&&this.selectFlag(u.N),this.onBlur.emit(this.fg.index.value),this.valFocus=!1}revert(){this.onRevert.emit(+this.fg.index.value)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(t.SBq))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-agro-form-group"]],viewQuery:function(e,o){if(1&e&&t.Gf(Tt,5),2&e){let r;t.iGM(r=t.CRH())&&(o.txtVal=r.first)}},inputs:{modified:"modified",group:"group",disabled:"disabled"},outputs:{onDirty:"onDirty",onRevert:"onRevert",onFocus:"onFocus",onBlur:"onBlur",onReturn:"onReturn"},features:[t.TTD],decls:10,vars:6,consts:[[1,"agro-data-row",3,"ngClass","formGroup"],["md","8",1,"py-2","label"],[4,"ngIf"],["type","button","cButton","","color","dark","shape","rounded-pill",3,"click",4,"ngIf"],["md","2",1,"py-1"],["formControlName","value","aria-label","value","cFormControl","",3,"focus","blur"],["inputValue",""],["md","2",1,"py-1","text-center"],["type","hidden","formControlName","flag","aria-label","flag","cFormControl",""],[3,"flag","disabled","onSelect"],["type","button","cButton","","color","dark","shape","rounded-pill",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"c-row",0),t.TgZ(1,"c-col",1),t.YNc(2,wt,2,1,"span",2),t.YNc(3,Ft,2,1,"button",3),t.qZA(),t.TgZ(4,"c-col",4),t.TgZ(5,"input",5,6),t.NdJ("focus",function(){return o.onValueFocus()})("blur",function(i){return o.onValueBlur(i)}),t.qZA(),t.qZA(),t.TgZ(7,"c-col",7),t._UZ(8,"input",8),t.TgZ(9,"app-flag-picker",9),t.NdJ("onSelect",function(i){return o.selectFlag(i)}),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.Q6J("ngClass",o.styles)("formGroup",o.group),t.xp6(2),t.Q6J("ngIf",!o.isDirty),t.xp6(1),t.Q6J("ngIf",o.isDirty),t.xp6(6),t.Q6J("flag",o.fg.flag.value)("disabled",o.disabled))},directives:[c.iok,_.mk,l.JL,l.sg,c.Yp0,_.O5,l.Fj,c.oHf,l.JJ,l.u,L,c.Hq3],styles:[".agro-data-row[_ngcontent-%COMP%]{padding:.1rem .3rem;margin:.2rem 0;background-color:#e5ecf2;border:1px solid #cdd4da;border-radius:.2rem}.agro-data-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{text-align:left}.agro-data-row[_ngcontent-%COMP%]   c-col[_ngcontent-%COMP%]{padding:0 .2rem}.agro-data-row.has-error[_ngcontent-%COMP%]{background-color:#ffe2e2;border:1px solid #dd6868}.agro-data-row.is-invalid[_ngcontent-%COMP%]{background-color:#ffe2e2;border:1px solid #dd6868}.agro-data-row.is-dirty[_ngcontent-%COMP%]{background-color:#a3e8fd;border:1px solid #8cc9db}.agro-data-row.has-focus[_ngcontent-%COMP%]{background-color:#e2e7ec;border:1px solid #9dacb9;box-shadow:#00000040 1px 1px 0 1px}.agro-data-row[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:disabled{cursor:not-allowed}.agro-data-row[_ngcontent-%COMP%]   .btn.rounded-pill[_ngcontent-%COMP%]{padding:.1rem .6rem;font-size:.8rem}.agro-data-row[_ngcontent-%COMP%]   .text-label[_ngcontent-%COMP%]{padding:.375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;text-align:center;border-radius:.25rem;border:1px solid #8cc9db}"]}),n})();const Mt=["agroGroup"];function qt(n,a){1&n&&(t.TgZ(0,"c-col",2),t._UZ(1,"app-infinite-loading"),t.qZA())}function St(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",28),t.TgZ(1,"div",29),t.TgZ(2,"span"),t._uU(3),t.qZA(),t.TgZ(4,"a",30),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).resetStation()}),t.O4$(),t._UZ(5,"svg",31),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(3),t.Oqu(e.station.station_name)}}function Ot(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"app-station-selection",32),t.NdJ("onSelection",function(r){return t.CHM(e),t.oxw(2).onStationSelect(r)}),t.qZA()}}function Dt(n,a){1&n&&(t.TgZ(0,"div"),t.O4$(),t._UZ(1,"svg",34),t._uU(2," Station selection required."),t.qZA())}function Ht(n,a){if(1&n&&(t.TgZ(0,"div",33),t.YNc(1,Dt,3,0,"div",20),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.f.station.errors.required)}}function kt(n,a){1&n&&(t.TgZ(0,"div",35),t.O4$(),t._UZ(1,"svg",34),t._uU(2," Year and Month is required "),t.qZA())}function It(n,a){if(1&n&&(t.TgZ(0,"c-row"),t.TgZ(1,"c-col",36),t.TgZ(2,"c-alert",37),t.TgZ(3,"strong"),t._uU(4,"Error(s) Found!"),t.qZA(),t._uU(5),t.qZA(),t.qZA(),t.qZA()),2&n){const e=t.oxw(2);t.xp6(5),t.hij(" ",e.error,"")}}function Et(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"c-col",36),t.TgZ(1,"app-agro-form-group",45,46),t.NdJ("onReturn",function(r){return t.CHM(e),t.oxw(4).handleReturn(r)})("onFocus",function(r){return t.CHM(e),t.oxw(4).keyFocus(r)})("onBlur",function(r){return t.CHM(e),t.oxw(4).keyBlur(r)})("onDirty",function(r){return t.CHM(e),t.oxw(4).onFormModified(r)})("onRevert",function(r){return t.CHM(e),t.oxw(4).revertItem(r)}),t.qZA(),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw(4);t.xp6(1),t.Q6J("disabled",!o.isEditable)("modified",o.isModified)("group",e)}}function Nt(n,a){1&n&&(t.TgZ(0,"c-alert",47),t._uU(1,"Please select a date to view form."),t.qZA())}function Rt(n,a){if(1&n&&(t.TgZ(0,"fieldset",40),t.TgZ(1,"legend"),t._uU(2),t.qZA(),t.TgZ(3,"c-row"),t.TgZ(4,"c-col",36),t.TgZ(5,"c-row"),t._UZ(6,"c-col",41),t.TgZ(7,"c-col",42),t._uU(8,"Value"),t.qZA(),t.TgZ(9,"c-col",42),t._uU(10,"Flag"),t.qZA(),t.qZA(),t.qZA(),t.YNc(11,Et,3,3,"c-col",43),t.qZA(),t.YNc(12,Nt,2,0,"c-alert",44),t.qZA()),2&n){const e=t.oxw().$implicit,o=t.oxw(2);t.s9C("formArrayName",e.field),t.xp6(2),t.hij(" ",e.title," "),t.xp6(9),t.Q6J("ngForOf",o.formGroups(e.field)),t.xp6(1),t.Q6J("ngIf",!o.formGroups(e.field).length)}}function Ut(n,a){if(1&n&&(t.TgZ(0,"c-col",38),t.YNc(1,Rt,13,4,"fieldset",39),t.qZA()),2&n){const e=a.$implicit,o=t.oxw(2);t.xp6(1),t.Q6J("ngIf",o.formGroups(e.field))}}function Pt(n,a){1&n&&t._UZ(0,"c-spinner",48)}const ft=function(n){return{"is-invalid":n}};function Jt(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"form",1),t.NdJ("ngSubmit",function(r){return t.CHM(e),t.oxw().onSubmit(r)})("keydown.enter",function(r){return t.CHM(e),t.oxw().onReturn(r)}),t.TgZ(1,"c-row"),t.TgZ(2,"c-col",2),t._UZ(3,"app-flag-legend"),t.qZA(),t.YNc(4,qt,2,0,"c-col",3),t.TgZ(5,"c-col",4),t.TgZ(6,"fieldset",5),t.TgZ(7,"legend"),t._uU(8,"Form Selector"),t.qZA(),t.TgZ(9,"c-row"),t.TgZ(10,"c-col",6),t.TgZ(11,"div",7),t.TgZ(12,"label",8),t._uU(13,"Station"),t.qZA(),t._UZ(14,"input",9),t.YNc(15,St,6,1,"div",10),t.YNc(16,Ot,1,0,"app-station-selection",11),t.YNc(17,Ht,2,1,"div",12),t.qZA(),t.qZA(),t.TgZ(18,"c-col",6),t.TgZ(19,"label",13),t._uU(20,"Year/Month/Day"),t.qZA(),t.TgZ(21,"c-input-group",14),t.TgZ(22,"span",15),t.O4$(),t._UZ(23,"svg",16),t.qZA(),t.kcU(),t._UZ(24,"input",17),t.TgZ(25,"input",18),t.NdJ("bsValueChange",function(r){return t.CHM(e),t.oxw().onDateSelection(r)}),t.qZA(),t.YNc(26,kt,3,0,"div",19),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.YNc(27,It,6,1,"c-row",20),t.TgZ(28,"c-row"),t.YNc(29,Ut,2,1,"c-col",21),t.qZA(),t._UZ(30,"hr",22),t.TgZ(31,"c-row"),t.TgZ(32,"c-col",23),t.TgZ(33,"button",24),t.YNc(34,Pt,1,0,"c-spinner",25),t._uU(35),t.qZA(),t.TgZ(36,"button",26),t.NdJ("click",function(){return t.CHM(e),t.oxw().onReset()}),t._uU(37," Reset "),t.qZA(),t.TgZ(38,"button",27),t.NdJ("click",function(){return t.CHM(e),t.oxw().onCancel()}),t._uU(39," Cancel "),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=t.oxw();t.Q6J("formGroup",e.form),t.xp6(4),t.Q6J("ngIf",e.loading),t.xp6(10),t.Q6J("ngClass",t.VKq(14,ft,(e.submitted||e.f.station.touched)&&e.f.station.invalid)),t.xp6(1),t.Q6J("ngIf",e.station),t.xp6(1),t.Q6J("ngIf",!e.station),t.xp6(1),t.Q6J("ngIf",e.f.station.errors),t.xp6(8),t.Q6J("bsConfig",e.bsConfig)("bsValue",e.monthYearValue)("ngClass",t.VKq(16,ft,e.submitted&&e.f.dayMonthYear.invalid)),t.xp6(1),t.Q6J("ngIf",e.submitted&&e.f.dayMonthYear.invalid),t.xp6(1),t.Q6J("ngIf",e.error),t.xp6(2),t.Q6J("ngForOf",e.fieldSets),t.xp6(5),t.Q6J("ngIf",e.loading),t.xp6(1),t.hij(" ",e.hasRecord?"Update":"Save"," ")}}const st={tempRH06GMT:[101,102,103,105,2,3,99],soilTemp05GMT:[72,73,74,554,75,76],soilTemp09GMT:[561,562,563],windrunRainfall:[513,5,504],sunshineEvap:[532,137,18,518],tempRH12GMT:[511,512,503,515],soilTemp13GMT:[564,565,566],tempRSoilMoist:[531,530,541,542]},Yt={val_101:{element:101,label:"Dry Bulb"},val_102:{element:102,label:"Wet Bulb"},val_103:{element:103,label:"Dew Point"},val_105:{element:105,label:"RH (%)"},val_002:{element:2,label:"TMax"},val_003:{element:3,label:"TMin"},val_099:{element:99,label:"Grass TMin"},val_072:{element:72,label:"005 cm"},val_073:{element:73,label:"010 cm"},val_074:{element:74,label:"020 cm"},val_554:{element:554,label:"030 cm"},val_075:{element:75,label:"050 cm"},val_076:{element:76,label:"100 cm"},val_561:{element:561,label:"005 cm"},val_562:{element:562,label:"010 cm"},val_563:{element:563,label:"020 cm"},val_513:{element:513,label:"Wind Run (km)"},val_005:{element:5,label:"Rain Amount (mm)"},val_504:{element:504,label:"Rain Duration (hrs)"},val_532:{element:532,label:"Sun Hrs"},val_137:{element:137,label:"Radiation"},val_018:{element:18,label:"Evap Pan1"},val_518:{element:518,label:"Evap Pan2"},val_511:{element:511,label:"Dry Bulb"},val_512:{element:512,label:"Wet Bulb"},val_503:{element:503,label:"Dew Point"},val_515:{element:515,label:"RH (%)"},val_564:{element:564,label:"005 cm"},val_565:{element:565,label:"010 cm"},val_566:{element:566,label:"020 cm"},val_531:{element:531,label:"TMax Reset"},val_530:{element:530,label:"TMin Reset"},val_541:{element:541,label:"Moisture @005cm"},val_542:{element:542,label:"Moisture @100cm"}};let Gt=(()=>{class n{constructor(e,o,r,i){this.modalService=e,this.responsiveSvc=o,this.dataEntryService=r,this.stationService=i,this.submitted=!1,this.loading=!1,this.error="",this.monthModified=!1,this.monthYearValue=new Date,this.bsConfig={isAnimated:!0,containerClass:"theme-blue",dateInputFormat:"DD/MM/YYYY"},this.hasRecord=!1,this.activeItem=0,this.fieldSets=[]}ngOnInit(){this.initForm(),this.responsiveSvc.screenSize.subscribe(e=>{console.log(e)}),this.fieldSets=[{field:"tempRH06GMT",title:"Temps & RH @ 06GMT"},{field:"soilTemp05GMT",title:"Soil Temps @ 0500GMT"},{field:"soilTemp09GMT",title:"Soil Temps @ 0900GMT"},{field:"windrunRainfall",title:"24 Hr Wind Run & Rainfall"},{field:"sunshineEvap",title:"Sunshine & Evaporation"},{field:"tempRH12GMT",title:"Temps & RH @ 12GMT"},{field:"soilTemp13GMT",title:"Soil Temps @ 1300GMT"},{field:"tempRSoilMoist",title:"Temp Reset & Soil Moisture"}],this.dataEntryService.agroState.pipe((0,w.b)(e=>this.loading=!!e),(0,m.h)(e=>!!e),(0,M.q)(1)).subscribe(e=>{console.log(e),this.setFormState(+e.station,new Date(`${e.month}-${e.day}-${e.year}`))})}get f(){return this.form.controls}get isEditable(){return!!this.station}get isModified(){return this.monthModified}get dirtyEntries(){return this.agroGroup.toArray().filter(e=>!!e.isDirty).length>0}get invalidEntries(){return this.agroGroup.toArray().filter(e=>!!e.isInvalid).length>0}onFormModified(e){this.monthModified=e}resetStation(){this.station=void 0,this.form.controls.station.reset()}onStationSelect(e){this.station=e,this.form.controls.station.setValue(e.station_id),this.loadAgroData()}onDateSelection(e){if(e){this.date=e;let o=g(e);this.year=o.year(),this.month=o.month()+1,this.day=o.date(),this.loadAgroData()}}onReset(){this.form.reset(),this.initForm()}onCancel(){}onReturn(e){e.preventDefault()}onSubmit(e){if(this.submitted=!0,!this.dirtyEntries)return void(this.error="The form has no inputs, please make some changes and try again.");if(this.form.invalid&&(!this.f.tempRH06GMT.invalid||!this.f.soilTemp05GMT.invalid||!this.f.soilTemp09GMT.invalid||!this.f.windrunRainfall.invalid||!this.f.sunshineEvap.invalid||!this.f.tempRH12GMT.invalid||!this.f.soilTemp13GMT.invalid||!this.f.tempRSoilMoist))return;if(this.invalidEntries)return void(this.error="The agro data contains some invalid entried, please fix the items and try again.");const o=this.buildPayload();this.hasRecord?this.update(o):this.save(o)}groupArray(e){return this.form.get(e)}formGroups(e){return this.groupArray(e).controls}keyFocus(e){this.activeItem=e}keyBlur(e){}handleReturn(e){e<this.agroGroup.toArray().length-1&&this.agroGroup.toArray()[e+1].focusValue()}getFieldsetGroupArray(e){return this.form.get(e)}getFieldsetGroupControls(e){return this.getFieldsetGroupArray(e).controls}revertItem(e){this.modalService.show(q.S,{initialState:{title:"Confirm Revert",message:"Are you sure you want to revert to original values?",confirm:"Go Ahead",cancel:"Cancel"}}).content.onClose.subscribe(i=>{if(i){const s=this.agroGroup.filter(v=>v.group.value.index===e).map(v=>v.group.value)[0],p=st[s.group].indexOf(s.element);if(this.hasRecord){const v=this.agroGroup.filter(dt=>dt.group.value.index===e).map(dt=>dt.group.value)[0],I=this.raw[`val_elem${this.formatEl(v.element)}`],ir=this.raw[`flag${this.formatEl(v.element)}`];this.getFieldsetGroupControls(v.group)[p]=this.getElementGroup(v.group,e,v.element,v.label,I,ir)}else this.getFieldsetGroupControls(s.group)[p]=this.getElementGroup(s.group,e,s.element,s.label,0,u.N)}})}getElementGroup(e,o,r,i,s,p){return new l.cw({group:new l.NI(e),index:new l.NI(o),element:new l.NI(r),label:new l.NI(i),value:new l.NI(s),flag:new l.NI(p||u.N)})}initForm(){this.form=new l.cw({station:new l.NI(null,l.kI.required),dayMonthYear:new l.NI(new Date,l.kI.required)}),this.initFieldsets()}initFieldsets(){this.form.controls.tempRH06GMT=new l.Oe([]),this.form.controls.tempRH12GMT=new l.Oe([]),this.form.controls.soilTemp05GMT=new l.Oe([]),this.form.controls.soilTemp09GMT=new l.Oe([]),this.form.controls.soilTemp13GMT=new l.Oe([]),this.form.controls.sunshineEvap=new l.Oe([]),this.form.controls.windrunRainfall=new l.Oe([]),this.form.controls.tempRSoilMoist=new l.Oe([]);let e=0;Object.keys(st).forEach(o=>{st[o].forEach(r=>{const i=Yt[`val_${this.formatEl(r)}`];this.groupArray(o).push(this.getElementGroup(o,e,r,i.label,null,u.N)),e++})})}setFormState(e,o){this.monthYearValue=o,this.stationService.getStation(e).subscribe(r=>{var i;this.station=r.result[0],this.form.controls.station.setValue(null===(i=this.station)||void 0===i?void 0:i.station_id),this.loadAgroData()})}loadAgroData(){this.initFieldsets(),console.log(this.station,this.year,this.month,this.day),this.station&&this.year&&this.month&&this.day&&(this.loading=!0,this.dataEntryService.getAgroEntry(this.station.station_id,this.year,this.month,this.day).pipe((0,f.K)(e=>(this.loading=!1,(0,O.of)(e))),(0,w.b)(e=>{this.hasRecord=e.result&&e.result.length>0}),(0,m.h)(e=>e.result&&e.result.length),(0,C.U)(e=>e.result[0])).subscribe(e=>{console.log(e),this.raw=Object.assign({},e),this.patchForm(e),this.loading=!1,this.focusFirst()}))}patchForm(e){this.agroGroup.forEach((o,r)=>{const i=Object.assign({},o.group.value),s={index:r,value:e[`val_elem${this.formatEl(i.element)}`],flag:e[`flag${this.formatEl(i.element)}`]};o.group.patchValue(Object.assign({},s))})}save(e){e.mm&&(e.mm=e.mm+1),e.entry_datetime=new Date,console.log(e),this.dataEntryService.addAgroEntry(e).subscribe(o=>{console.log(o),this.form.markAsPristine()})}update(e){console.log(e);const o=g(this.date),r=o.year(),i=o.month()+1,s=o.date();console.log(r,i,s),delete e.dd,delete e.mm,delete e.yyyy,this.station&&this.date&&this.dataEntryService.updateAgroEntry(this.station.station_id,r,i,s,e).subscribe(p=>{console.log(p),this.form.markAsPristine()})}formatEl(e){return e<10?`00${e}`:e<100?`0${e}`:`${e}`}buildPayload(){var e;const o=g(this.date),r={station_id:null===(e=this.station)||void 0===e?void 0:e.station_id,yyyy:o.year(),mm:o.month(),dd:o.date(),signature:"",entry_datetime:new Date};return this.agroGroup.forEach(i=>{const s=Object.assign({},i.group.value);r[`val_elem${this.formatEl(s.element)}`]=s.value,r[`flag${this.formatEl(s.element)}`]=s.flag}),Object.assign({},r)}focusFirst(){(0,O.of)(!0).pipe((0,h.g)(100)).subscribe(()=>{this.agroGroup.toArray()[0].focusValue()})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(x.tT),t.Y36(D.k),t.Y36(U),t.Y36(V.v))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-form-agro1"]],viewQuery:function(e,o){if(1&e&&t.Gf(Mt,5),2&e){let r;t.iGM(r=t.CRH())&&(o.agroGroup=r)}},decls:4,vars:1,consts:[["novalidate","",3,"formGroup","ngSubmit","keydown.enter",4,"ngIf"],["novalidate","",3,"formGroup","ngSubmit","keydown.enter"],["sm","12",1,"text-end"],["sm","12","class","text-end",4,"ngIf"],["sm","12"],[1,"form-group","p-3","mt-2"],["xs","12","md","6","xl","3"],[1,"mb-2"],["cLabel","","for","station"],["id","station","type","hidden","formControlName","station","aria-label","default input","cFormControl","",3,"ngClass"],["class","typeahead-selection theme form-group",4,"ngIf"],[3,"onSelection",4,"ngIf"],["col","12","class","invalid-feedback",4,"ngIf"],["cLabel","","for","yymmdd"],[1,"mb-3"],["cInputGroupText","","id","basic-addon1"],["cIcon","","name","cilCalendar"],["id","yymmdd","type","hidden","formControlName","dayMonthYear","aria-label","default input","cFormControl","","placeholder","Select Date"],["name","dayMonthYear","placeholder","Select Year & Month","cFormControl","","bsDatepicker","","autocomplete","off",3,"bsConfig","bsValue","ngClass","bsValueChange"],["sm","12","class","invalid-feedback",4,"ngIf"],[4,"ngIf"],["sm","12","md","12","lg","6","xl","4","class","text-end",4,"ngFor","ngForOf"],[1,"my-4"],["xs","12 py-4"],["type","submit","cButton","","color","dark",1,"px-3"],["aria-hidden","true","size","sm",4,"ngIf"],["type","button","cButton","","color","dark",1,"px-3","mx-1",3,"click"],["type","button","cButton","","color","dark",1,"px-3",3,"click"],[1,"typeahead-selection","theme","form-group"],[1,"typeahead-selection-inner"],[1,"btn",3,"click"],["cIcon","","name","cilX"],[3,"onSelection"],["col","12",1,"invalid-feedback"],["cIcon","","name","cilXCircle"],["sm","12",1,"invalid-feedback"],["md","12"],["color","danger"],["sm","12","md","12","lg","6","xl","4",1,"text-end"],["class","form-group group-fieldset p-3 mt-4",3,"formArrayName",4,"ngIf"],[1,"form-group","group-fieldset","p-3","mt-4",3,"formArrayName"],["md","8"],["md","2",1,"item-header","px-1"],["md","12",4,"ngFor","ngForOf"],["color","info","class","mt-4",4,"ngIf"],[3,"disabled","modified","group","onReturn","onFocus","onBlur","onDirty","onRevert"],["agroGroup",""],["color","info",1,"mt-4"],["aria-hidden","true","size","sm"]],template:function(e,o){1&e&&(t.TgZ(0,"h5"),t._uU(1," Kenya Agromet Data "),t.qZA(),t._UZ(2,"hr"),t.YNc(3,Jt,40,18,"form",0)),2&e&&(t.xp6(3),t.Q6J("ngIf",o.form))},directives:[_.O5,l._Y,l.JL,l.sg,c.iok,c.Yp0,P,c.eFW,l.Fj,c.oHf,l.JJ,l.u,_.mk,c.g8K,c.jOm,J.ar,k.Y5,k.Np,_.sg,c.Hq3,j.$,Y.n,c.wxo,l.CE,At,c.ORR],styles:[".item-header[_ngcontent-%COMP%]{font-size:.8rem;text-align:left}fieldset.group-fieldset[_ngcontent-%COMP%]:nth-child(-n+3){min-height:400px}fieldset.group-fieldset[_ngcontent-%COMP%]:nth-last-child(-n+5){min-height:300px}"]}),n})();const $t=["inputValue"];let gt=(()=>{class n{constructor(e){this.ref=e,this.modified=!1,this.group=new l.cw({index:new l.NI(0),element:new l.NI(0),key:new l.NI(""),label:new l.NI(""),value:new l.NI(null,l.kI.required),flag:new l.NI(null)}),this.disabled=!1,this.onDirty=new t.vpe,this.onRevert=new t.vpe,this.onFocus=new t.vpe,this.onBlur=new t.vpe,this.onReturn=new t.vpe,this.valFocus=!1,this.hasFocus=!1}ngOnInit(){this.group.valueChanges.pipe((0,m.h)(e=>!this.modified)).subscribe(e=>{this.onDirty.emit(!0)})}ngAfterViewInit(){(0,Q.R)(this.ref.nativeElement,"keyup").pipe((0,m.h)(e=>13===e.keyCode&&this.valFocus)).subscribe(e=>{this.onValRetunKey()})}ngOnChanges(e){this.disabled?this.group.disable():this.group.enable()}selectFlag(e){this.group.controls.flag.setValue(e)}focusValue(){this.txtVal.nativeElement.focus()}get fg(){return this.group.controls}get isDirty(){return this.fg.value.dirty||this.fg.flag.dirty}get isInvalid(){return this.fg.value.dirty&&this.fg.value.value&&this.fg.flag.value===u.M}get styles(){const e={"has-focus":this.hasFocus};return this.isDirty&&(e["is-dirty"]=!0),this.isInvalid&&(e["is-dirty"]=!1,e["is-invalid"]=!0),e}onValRetunKey(){(!this.fg.value.value||0==+this.fg.value.value)&&this.fg.flag.setValue(u.M),this.onReturn.emit(+this.fg.index.value)}onValueFocus(){this.hasFocus=!0,this.onFocus.emit(this.fg.key.value),this.valFocus=!0}onValueBlur(e){this.hasFocus=!1;const o=this.fg.value.value;this.pristine&&this.pristine.value===o&&""!==o&&this.fg.value.markAsPristine(),""===o&&this.fg.flag.value!==u.M&&this.selectFlag(u.M),""!==o&&this.fg.flag.value===u.M&&this.selectFlag(u.N),this.onBlur.emit(this.fg.key.value),this.valFocus=!1}revert(){this.onRevert.emit(+this.fg.index.value)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(t.SBq))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-synoptic-form-group"]],viewQuery:function(e,o){if(1&e&&t.Gf($t,5),2&e){let r;t.iGM(r=t.CRH())&&(o.txtVal=r.first)}},inputs:{modified:"modified",group:"group",disabled:"disabled"},outputs:{onDirty:"onDirty",onRevert:"onRevert",onFocus:"onFocus",onBlur:"onBlur",onReturn:"onReturn"},features:[t.TTD],decls:10,vars:5,consts:[[1,"synoptic-data-row",3,"ngClass","formGroup"],["md","7",1,"py-2","label"],["md","3",1,"py-1"],["formControlName","value","aria-label","value","cFormControl","",3,"focus","blur"],["inputValue",""],["md","2",1,"py-1","text-center"],["type","hidden","formControlName","flag","aria-label","flag","cFormControl",""],[3,"flag","disabled","onSelect"]],template:function(e,o){1&e&&(t.TgZ(0,"c-row",0),t.TgZ(1,"c-col",1),t.TgZ(2,"span"),t._uU(3),t.qZA(),t.qZA(),t.TgZ(4,"c-col",2),t.TgZ(5,"input",3,4),t.NdJ("focus",function(){return o.onValueFocus()})("blur",function(i){return o.onValueBlur(i)}),t.qZA(),t.qZA(),t.TgZ(7,"c-col",5),t._UZ(8,"input",6),t.TgZ(9,"app-flag-picker",7),t.NdJ("onSelect",function(i){return o.selectFlag(i)}),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.Q6J("ngClass",o.styles)("formGroup",o.group),t.xp6(3),t.Oqu(o.fg.label.value),t.xp6(6),t.Q6J("flag",o.fg.flag.value)("disabled",o.disabled))},directives:[c.iok,_.mk,l.JL,l.sg,c.Yp0,l.Fj,c.oHf,l.JJ,l.u,L],styles:[".synoptic-data-row[_ngcontent-%COMP%]{padding:.1rem .3rem;margin:.2rem 0;background-color:#e5ecf2;border:1px solid #cdd4da;border-radius:.2rem}.synoptic-data-row[_ngcontent-%COMP%]   c-col[_ngcontent-%COMP%]{padding:0 .2rem}.synoptic-data-row.has-error[_ngcontent-%COMP%]{background-color:#ffe2e2;border:1px solid #dd6868}.synoptic-data-row.is-invalid[_ngcontent-%COMP%]{background-color:#ffe2e2;border:1px solid #dd6868}.synoptic-data-row.is-dirty[_ngcontent-%COMP%]{background-color:#a3e8fd;border:1px solid #8cc9db}.synoptic-data-row.has-focus[_ngcontent-%COMP%]{background-color:#e2e7ec;border:1px solid #9dacb9;box-shadow:#00000040 1px 1px 0 1px}.synoptic-data-row[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:disabled{cursor:not-allowed}"]}),n})();const Vt=["synopticGroup"];function Qt(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",32),t.TgZ(1,"div",33),t.TgZ(2,"span"),t._uU(3),t.qZA(),t.TgZ(4,"a",34),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).resetStation()}),t.O4$(),t._UZ(5,"svg",35),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(3),t.Oqu(e.station.station_name)}}function Lt(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"app-station-selection",36),t.NdJ("onSelection",function(r){return t.CHM(e),t.oxw(2).onStationSelect(r)}),t.qZA()}}function Bt(n,a){1&n&&(t.TgZ(0,"div"),t.O4$(),t._UZ(1,"svg",39),t._uU(2," Station selection required."),t.qZA())}function Wt(n,a){if(1&n&&(t.TgZ(0,"div",37),t.YNc(1,Bt,3,0,"div",38),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.f.station.errors.required)}}function Kt(n,a){1&n&&(t.TgZ(0,"div",40),t.O4$(),t._UZ(1,"svg",39),t._uU(2," Year and Month is required "),t.qZA())}function jt(n,a){if(1&n&&(t.TgZ(0,"option",41),t._uU(1),t.qZA()),2&n){const e=a.$implicit,o=t.oxw(2);t.Q6J("value",e),t.xp6(1),t.Oqu(o.getHoursValue(e))}}function zt(n,a){1&n&&(t.TgZ(0,"div"),t.O4$(),t._UZ(1,"svg",39),t._uU(2," Hour selection is required."),t.qZA())}function Xt(n,a){if(1&n&&(t.TgZ(0,"div",37),t.YNc(1,zt,3,0,"div",38),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.f.hour.errors.required)}}function te(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"c-col",45),t.TgZ(1,"app-synoptic-form-group",46,47),t.NdJ("onReturn",function(r){return t.CHM(e),t.oxw(3).handleReturn(r)})("onFocus",function(r){return t.CHM(e),t.oxw(3).keyFocus(r)})("onBlur",function(r){return t.CHM(e),t.oxw(3).keyBlur(r)})("onDirty",function(r){return t.CHM(e),t.oxw(3).onFormModified(r)})("onRevert",function(r){return t.CHM(e),t.oxw(3).revertItem(r)}),t.qZA(),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw(3);t.xp6(1),t.Q6J("disabled",!o.isEditable)("modified",o.isModified)("group",e)}}function ee(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"c-col",45),t.TgZ(1,"app-synoptic-form-group",46,47),t.NdJ("onReturn",function(r){return t.CHM(e),t.oxw(3).handleReturn(r)})("onFocus",function(r){return t.CHM(e),t.oxw(3).keyFocus(r)})("onBlur",function(r){return t.CHM(e),t.oxw(3).keyBlur(r)})("onDirty",function(r){return t.CHM(e),t.oxw(3).onFormModified(r)})("onRevert",function(r){return t.CHM(e),t.oxw(3).revertItem(r)}),t.qZA(),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw(3);t.xp6(1),t.Q6J("disabled",!o.isEditable)("modified",o.isModified)("group",e)}}function oe(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"c-col",45),t.TgZ(1,"app-synoptic-form-group",46,47),t.NdJ("onReturn",function(r){return t.CHM(e),t.oxw(3).handleReturn(r)})("onFocus",function(r){return t.CHM(e),t.oxw(3).keyFocus(r)})("onBlur",function(r){return t.CHM(e),t.oxw(3).keyBlur(r)})("onDirty",function(r){return t.CHM(e),t.oxw(3).onFormModified(r)})("onRevert",function(r){return t.CHM(e),t.oxw(3).revertItem(r)}),t.qZA(),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw(3);t.xp6(1),t.Q6J("disabled",!o.isEditable)("modified",o.isModified)("group",e)}}function ne(n,a){if(1&n&&(t.TgZ(0,"c-row",42),t.TgZ(1,"c-col",43),t.TgZ(2,"c-row"),t.YNc(3,te,3,3,"c-col",44),t.ALo(4,"slice"),t.qZA(),t.qZA(),t.TgZ(5,"c-col",43),t.TgZ(6,"c-row"),t.YNc(7,ee,3,3,"c-col",44),t.ALo(8,"slice"),t.qZA(),t.qZA(),t.TgZ(9,"c-col",43),t.TgZ(10,"c-row"),t.YNc(11,oe,3,3,"c-col",44),t.ALo(12,"slice"),t.qZA(),t.qZA(),t.qZA()),2&n){const e=t.oxw(2);t.xp6(3),t.Q6J("ngForOf",t.Dn7(4,3,e.formGroups,0,12)),t.xp6(4),t.Q6J("ngForOf",t.Dn7(8,7,e.formGroups,12,24)),t.xp6(4),t.Q6J("ngForOf",t.Dn7(12,11,e.formGroups,24,33))}}function re(n,a){1&n&&(t.TgZ(0,"c-alert",48),t._uU(1,"Please select a date to view form."),t.qZA())}function ie(n,a){1&n&&t._UZ(0,"c-spinner",49)}const ct=function(n){return{"is-invalid":n}};function le(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"form",1),t.NdJ("ngSubmit",function(r){return t.CHM(e),t.oxw().onSubmit(r)})("keydown.enter",function(r){return t.CHM(e),t.oxw().onReturn(r)}),t.TgZ(1,"c-row"),t.TgZ(2,"c-col",2),t._UZ(3,"app-flag-legend"),t.qZA(),t.TgZ(4,"c-col",3),t.TgZ(5,"fieldset",4),t.TgZ(6,"legend"),t._uU(7,"Form Selector"),t.qZA(),t.TgZ(8,"c-row"),t.TgZ(9,"c-col",5),t.TgZ(10,"div",6),t.TgZ(11,"label",7),t._uU(12,"Station"),t.qZA(),t._UZ(13,"input",8),t.YNc(14,Qt,6,1,"div",9),t.YNc(15,Lt,1,0,"app-station-selection",10),t.YNc(16,Wt,2,1,"div",11),t.qZA(),t.qZA(),t.TgZ(17,"c-col",5),t.TgZ(18,"label",12),t._uU(19,"Year/Month/Day"),t.qZA(),t.TgZ(20,"c-input-group",13),t.TgZ(21,"span",14),t.O4$(),t._UZ(22,"svg",15),t.qZA(),t.kcU(),t._UZ(23,"input",16),t.TgZ(24,"input",17),t.NdJ("bsValueChange",function(r){return t.CHM(e),t.oxw().onDateSelection(r)}),t.qZA(),t.YNc(25,Kt,3,0,"div",18),t.qZA(),t.qZA(),t.TgZ(26,"c-col",5),t.TgZ(27,"div",6),t.TgZ(28,"label",19),t._uU(29,"Hour"),t.qZA(),t.TgZ(30,"select",20),t.NdJ("change",function(r){return t.CHM(e),t.oxw().onHourSelect(r.target)}),t.TgZ(31,"option",21),t._uU(32,"Select Hour"),t.qZA(),t.YNc(33,jt,2,2,"option",22),t.qZA(),t.YNc(34,Xt,2,1,"div",11),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(35,"fieldset",23),t.TgZ(36,"legend"),t._uU(37," Carribiean Synoptic Data "),t.qZA(),t.YNc(38,ne,13,15,"c-row",24),t.YNc(39,re,2,0,"c-alert",25),t.qZA(),t._UZ(40,"hr",26),t.TgZ(41,"c-row"),t.TgZ(42,"c-col",27),t.TgZ(43,"button",28),t.YNc(44,ie,1,0,"c-spinner",29),t._uU(45," Submit "),t.qZA(),t.TgZ(46,"button",30),t.NdJ("click",function(){return t.CHM(e),t.oxw().onReset()}),t._uU(47," Reset "),t.qZA(),t.TgZ(48,"button",31),t.NdJ("click",function(){return t.CHM(e),t.oxw().onCancel()}),t._uU(49," Cancel "),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=t.oxw();t.Q6J("formGroup",e.form),t.xp6(13),t.Q6J("ngClass",t.VKq(15,ct,(e.submitted||e.f.station.touched)&&e.f.station.invalid)),t.xp6(1),t.Q6J("ngIf",e.station),t.xp6(1),t.Q6J("ngIf",!e.station),t.xp6(1),t.Q6J("ngIf",e.f.station.errors),t.xp6(8),t.Q6J("bsConfig",e.bsConfig)("bsValue",e.monthYearValue)("ngClass",t.VKq(17,ct,e.submitted&&e.f.dayMonthYear.invalid)),t.xp6(1),t.Q6J("ngIf",e.submitted&&e.f.dayMonthYear.invalid),t.xp6(5),t.Q6J("ngClass",t.VKq(19,ct,(e.submitted||e.f.hour.touched)&&e.f.hour.invalid)),t.xp6(3),t.Q6J("ngForOf",e.hoursList),t.xp6(1),t.Q6J("ngIf",e.f.hour.errors),t.xp6(4),t.Q6J("ngIf",e.formGroups.length),t.xp6(1),t.Q6J("ngIf",!e.formGroups.length),t.xp6(5),t.Q6J("ngIf",e.loading)}}const X=[{element:192,key:"cloudHeight",label:"Height of Cloud"},{element:110,key:"visibility",label:"Visibility"},{element:114,key:"cloudCover",label:"Total Cloud Cover"},{element:112,key:"windDirection",label:"Wind Direction"},{element:111,key:"windSpeed",label:"Wind Speed"},{element:101,key:"dryBulb",label:"Dry Bulb"},{element:102,key:"wetBulb",label:"Wet Bulb"},{element:103,key:"dewPoint",label:"Dew Point"},{element:105,key:"relativeHum",label:"Relative Humidity"},{element:106,key:"stnLevelPress",label:"Station Level Pressure"},{element:107,key:"seaLevelPress",label:"Height of cloud"},{element:0,key:"rainFall",label:"Rain Fall"},{element:167,key:"presentWx",label:"Present WX"},{element:0,key:"pastWx1",label:"Past WX 1"},{element:0,key:"pastWx2",label:"Past WX 2"},{element:0,key:"nh",label:"Nh"},{element:0,key:"cl",label:"Cl"},{element:193,key:"cm",label:"Cm"},{element:0,key:"ch",label:"Ch"},{element:3,key:"tmin",label:"Temperature Min"},{element:0,key:"gmin",label:"G Min"},{element:116,key:"cldAmtLvl1",label:"Cloud Amt Level 1"},{element:117,key:"cldTpLvl1",label:"Cloud Type Level 1"},{element:118,key:"cldHtLvl1",label:"Cloud Height Level 1"},{element:120,key:"cldAmtLvl2",label:"Cloud Amt Level 2"},{element:121,key:"cldTpLvl2",label:"Cloud Type Level 2"},{element:122,key:"cldHtLvl2",label:"Cloud Height Level 2"},{element:124,key:"cldAmtLvl3",label:"Cloud Amt Level 3"},{element:125,key:"cldTpLvl3",label:"Cloud Type Level 3"},{element:126,key:"cldHtLvl3",label:"Cloud Height Level 3"},{element:128,key:"cldAmtLvl4",label:"Cloud Amt Level 4"},{element:129,key:"cldTpLvl4",label:"Cloud Type Level 4"},{element:130,key:"cldHtLvl4",label:"Cloud Height Level 4"}];let ae=(()=>{class n{constructor(e,o,r){this.modalService=e,this.responsiveSvc=o,this.dataEntryService=r,this.submitted=!1,this.loading=!1,this.error="",this.monthModified=!1,this.monthYearValue=new Date,this.bsConfig={isAnimated:!0,containerClass:"theme-blue",dateInputFormat:"DD/MM/YYYY"},this.hasRecord=!1,this.activeItem=0,this.hoursList=[24,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]}ngOnInit(){this.initForm(),this.responsiveSvc.screenSize.subscribe(e=>{console.log(e)})}get f(){return this.form.controls}get isEditable(){return!!this.station}get isModified(){return this.monthModified}onFormModified(e){this.monthModified=e}resetStation(){this.station=void 0,this.form.controls.station.reset()}onStationSelect(e){this.station=e,this.form.controls.station.setValue(e.station_id),this.loadSynopData()}onDateSelection(e){if(e){this.date=e;let o=g(e);this.year=o.year(),this.month=o.month()+1,this.day=o.date(),this.loadSynopData()}}getHoursValue(e){return g().set("hours",e).startOf("hour").format("HH:mm")}onReset(){this.form.reset(),this.initForm()}onCancel(){}onReturn(e){e.preventDefault()}onHourSelect(e){this.hour=this.f.hour.value,this.loadSynopData()}onSubmit(e){this.submitted=!0}get groupArray(){return this.form.get("tags")}get formGroups(){return this.groupArray.controls}keyFocus(e){this.activeItem=e}keyBlur(e){}handleReturn(e){e<this.synopticGroup.toArray().length-1&&this.synopticGroup.toArray()[+e+1].focusValue()}revertItem(e){this.modalService.show(q.S,{initialState:{title:"Confirm Revert",message:"Are you sure you want to revert to original values?",confirm:"Go Ahead",cancel:"Cancel"}}).content.onClose.subscribe(i=>{})}getTagGroup(e,o,r,i,s,p){return new l.cw({index:new l.NI(e),element:new l.NI(o),key:new l.NI(r),label:new l.NI(i),value:new l.NI(s),flag:new l.NI(p||u.N)})}initForm(){this.form=new l.cw({station:new l.NI(null,l.kI.required),dayMonthYear:new l.NI(new Date,l.kI.required),hour:new l.NI(6,[l.kI.min(0),l.kI.max(24)]),tags:new l.Oe([])});for(let e=0;e<X.length;e++)this.groupArray.push(this.getTagGroup(e,X[e].element,X[e].key,X[e].label,0))}loadSynopData(){console.log(this.station,this.year,this.month,this.day),this.station&&this.year&&this.month&&this.day&&this.hour&&this.dataEntryService.getSynopticEntry(this.station.station_id,this.year,this.month,this.day,this.hour).pipe((0,w.b)(e=>{this.hasRecord=e.result.length>0}),(0,m.h)(e=>e.result.length),(0,C.U)(e=>e.result[0])).subscribe(e=>{console.log(e),this.hasRecord=!0,this.patchForm(e)})}patchForm(e){this.formGroups.forEach((o,r)=>{const i=r+1<10?`0${r+1}`:r+1;o.patchValue(Object.assign({},{day:r+1,value:e[`day${i}`],flag:e[`flag${i}`]}))})}addRecord(){var e;let o={station_id:null===(e=this.station)||void 0===e?void 0:e.station_id,yyyy:this.year,mm:this.month,dd:this.day,hh:this.hour};this.formGroups.forEach((r,i)=>{const s=i+1<10?`0${i+1}`:i+1;o[`day${s}`]=r.controls.value.value,o[`flag${s}`]=r.controls.flag.value,o[`period${s}`]=r.controls.period.value}),o.entry_datetime=(new Date).toISOString(),console.log(o)}updateRecord(){}save(e){e.mm&&(e.mm=e.mm+1),e.entry_datetime=new Date,console.log(e),this.dataEntryService.addSynopticEntry(e).subscribe(o=>{console.log(o),this.form.markAsPristine()})}update(e){console.log(e);const o=g(this.date),r=o.year(),i=o.month()+1,s=o.date();console.log(r,i,s),delete e.dd,delete e.mm,delete e.yyyy,this.station&&this.date&&this.dataEntryService.updateSynopEntry(this.station.station_id,r,i,s,this.hour,e).subscribe(p=>{console.log(p),this.form.markAsPristine()})}formatEl(e){return e<10?`00${e}`:e<100?`0${e}`:`${e}`}buildPayload(){var e;const o=g(this.date),r={station_id:null===(e=this.station)||void 0===e?void 0:e.station_id,yyyy:o.year(),mm:o.month(),dd:o.date(),hh:this.hour,total:0,signature:"",entry_datetime:new Date};return this.synopticGroup.forEach(i=>{const s=Object.assign({},i.group.value);r[`val_elem${this.formatEl(s.element)}`]=s.value,r[`flag${this.formatEl(s.element)}`]=s.flag}),r}focusFirst(){(0,O.of)(!0).pipe((0,h.g)(100)).subscribe(()=>{this.synopticGroup.toArray()[0].focusValue()})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(x.tT),t.Y36(D.k),t.Y36(U))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-form-synoptic2-caribbean"]],viewQuery:function(e,o){if(1&e&&t.Gf(Vt,5),2&e){let r;t.iGM(r=t.CRH())&&(o.synopticGroup=r)}},decls:4,vars:1,consts:[["novalidate","",3,"formGroup","ngSubmit","keydown.enter",4,"ngIf"],["novalidate","",3,"formGroup","ngSubmit","keydown.enter"],["sm","12",1,"text-end"],["sm","12"],[1,"form-group","p-3","mt-2"],["xs","12","md","6","xl","3"],[1,"mb-2"],["cLabel","","for","station"],["id","station","type","hidden","formControlName","station","aria-label","default input","cFormControl","",3,"ngClass"],["class","typeahead-selection theme form-group",4,"ngIf"],[3,"onSelection",4,"ngIf"],["col","12","class","invalid-feedback",4,"ngIf"],["cLabel","","for","yymmdd"],[1,"mb-3"],["cInputGroupText","","id","basic-addon1"],["cIcon","","name","cilCalendar"],["id","yymmdd","type","hidden","formControlName","dayMonthYear","aria-label","default input","cFormControl","","placeholder","Select Date"],["name","dayMonthYear","placeholder","Select Year & Month","cFormControl","","bsDatepicker","","autocomplete","off",3,"bsConfig","bsValue","ngClass","bsValueChange"],["sm","12","class","invalid-feedback",4,"ngIf"],["cLabel","","for","hoursValue"],["formControlName","hour","aria-label","Hour","cSelect","",3,"ngClass","change"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"form-group","p-3","mt-4"],["formArrayName","tags",4,"ngIf"],["color","info","class","mt-4",4,"ngIf"],[1,"my-4"],["xs","12 py-4"],["type","submit","cButton","","color","dark",1,"px-3"],["aria-hidden","true","size","sm",4,"ngIf"],["type","button","cButton","","color","dark",1,"px-3","mx-1",3,"click"],["type","button","cButton","","color","dark",1,"px-3",3,"click"],[1,"typeahead-selection","theme","form-group"],[1,"typeahead-selection-inner"],[1,"btn",3,"click"],["cIcon","","name","cilX"],[3,"onSelection"],["col","12",1,"invalid-feedback"],[4,"ngIf"],["cIcon","","name","cilXCircle"],["sm","12",1,"invalid-feedback"],[3,"value"],["formArrayName","tags"],["md","12","lg","4"],["md","12",4,"ngFor","ngForOf"],["md","12"],[3,"disabled","modified","group","onReturn","onFocus","onBlur","onDirty","onRevert"],["synopticGroup",""],["color","info",1,"mt-4"],["aria-hidden","true","size","sm"]],template:function(e,o){1&e&&(t.TgZ(0,"h5"),t._uU(1," Carribean Synoptic Data "),t.qZA(),t._UZ(2,"hr"),t.YNc(3,le,50,21,"form",0)),2&e&&(t.xp6(3),t.Q6J("ngIf",o.form))},directives:[_.O5,l._Y,l.JL,l.sg,c.iok,c.Yp0,P,c.eFW,l.Fj,c.oHf,l.JJ,l.u,_.mk,c.g8K,c.jOm,J.ar,k.Y5,k.Np,l.EJ,c.nqR,l.YN,l.Kr,_.sg,c.Hq3,Y.n,l.CE,gt,c.wxo,c.ORR],pipes:[_.OU],styles:[""]}),n})();var tt=d(3067),_t=d(74);function se(n,a){if(1&n&&(t.TgZ(0,"option",5),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}let ce=(()=>{class n{constructor(){this.disabled=!1,this.tabIndex=0,this.value=(new Date).getFullYear(),this.start=(new Date).getFullYear()-30,this.end=(new Date).getFullYear(),this.onSelect=new t.vpe,this.years=[]}ngOnInit(){this.formControl=new l.NI(this.value);for(let e=this.end;e>this.start;e--)this.years.push(e);this.subscription=this.formControl.valueChanges.subscribe(e=>{this.onSelect.emit(e)})}ngOnDestroy(){this.subscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-year-selector"]],inputs:{disabled:"disabled",tabIndex:"tabIndex",value:"value",start:"start",end:"end"},outputs:{onSelect:"onSelect"},decls:8,vars:2,consts:[["cLabel","","for","element"],[1,"mb-3"],["cSelect","","sizing","md",1,"mb-3",3,"formControl"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,o){1&e&&(t.ynx(0),t.TgZ(1,"label",0),t._uU(2,"Year"),t.qZA(),t.TgZ(3,"c-input-group",1),t.TgZ(4,"select",2),t.TgZ(5,"option",3),t._uU(6,"Select Year"),t.qZA(),t.YNc(7,se,2,2,"option",4),t.qZA(),t.qZA(),t.BQk()),2&e&&(t.xp6(4),t.Q6J("formControl",o.formControl),t.xp6(3),t.Q6J("ngForOf",o.years))},directives:[c.eFW,c.g8K,c.nqR,l.EJ,l.JJ,l.oH,l.YN,l.Kr,_.sg],styles:[""]}),n})();var ut=d(6566);const _e=["inputValue"];function ue(n,a){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Oqu(e.fg.month.value)}}function me(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"button",13),t.NdJ("click",function(){return t.CHM(e),t.oxw().revert()}),t._uU(1),t.qZA()}if(2&n){const e=t.oxw();t.xp6(1),t.Oqu(e.fg.month.value)}}let pe=(()=>{class n{constructor(e){this.ref=e,this.modified=!1,this.group=new l.cw({month:new l.NI(""),value:new l.NI(null),flag:new l.NI(null),priod:new l.NI("")}),this.disabled=!1,this.onDirty=new t.vpe,this.onRevert=new t.vpe,this.onFocus=new t.vpe,this.onBlur=new t.vpe,this.onReturn=new t.vpe,this.valFocus=!1,this.hasFocus=!1}ngOnInit(){this.group.valueChanges.pipe((0,m.h)(e=>!this.modified)).subscribe(e=>{console.log(e),this.onDirty.emit(!0)})}ngAfterViewInit(){(0,Q.R)(this.ref.nativeElement,"keyup").pipe((0,m.h)(e=>13===e.keyCode&&this.valFocus)).subscribe(e=>{this.onValRetunKey()})}ngOnChanges(e){this.disabled?this.group.disable():this.group.enable()}get isDirty(){return this.fg.value.dirty||this.fg.flag.dirty||this.fg.period.dirty}get isInvalid(){const e=this.fg.value.value;if(e){if(!/^\d+$/.test(e))return!0;if(this.limits)return+e<this.limits.lower||+e>this.limits.upper}return this.fg.value.dirty&&""!==this.fg.value.value&&this.fg.flag.value===u.M}get styles(){const e={"has-focus":this.hasFocus};return this.isDirty&&(e["is-dirty"]=!0),this.isInvalid&&(e["is-dirty"]=!1,e["is-invalid"]=!0),e}monthVal(e){return e&&e<10?`0${e}`:`${e}`}selectFlag(e){this.group.controls.flag.setValue(e)}focusValue(){this.txtVal.nativeElement.focus()}get fg(){return this.group.controls}onValRetunKey(){(!this.fg.value.value||0==+this.fg.value.value)&&this.fg.flag.setValue(u.M);const e=+g().month(this.fg.month.value).format("M");this.onReturn.emit(+e)}onValueFocus(){this.hasFocus=!0,this.onFocus.emit(this.fg.month.value),this.valFocus=!0}onValueBlur(e){this.hasFocus=!1;const o=this.fg.value.value;this.pristine&&this.pristine.value===o&&""!==o&&this.fg.value.markAsPristine(),""===o&&this.fg.flag.value!==u.M&&this.selectFlag(u.M),""!==o&&this.fg.flag.value===u.M&&this.selectFlag(u.N),this.onBlur.emit(this.fg.month.value),this.valFocus=!1}revert(){const e=+g().month(this.fg.month.value).format("M");this.onRevert.emit(e)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(t.SBq))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-month-form-group"]],viewQuery:function(e,o){if(1&e&&t.Gf(_e,5),2&e){let r;t.iGM(r=t.CRH())&&(o.txtVal=r.first)}},inputs:{modified:"modified",limits:"limits",group:"group",disabled:"disabled"},outputs:{onDirty:"onDirty",onRevert:"onRevert",onFocus:"onFocus",onBlur:"onBlur",onReturn:"onReturn"},features:[t.TTD],decls:13,vars:6,consts:[[1,"monthly-data-row",3,"ngClass","formGroup"],["md","5",1,"py-2","label"],[4,"ngIf"],["type","button","cButton","","color","dark","shape","rounded-pill",3,"click",4,"ngIf"],["md","2",1,"py-1"],["formControlName","value","aria-label","value","cFormControl","",3,"focus","blur"],["inputValue",""],["md","2",1,"py-1","text-center"],["type","hidden","formControlName","flag","aria-label","flag","cFormControl",""],[3,"flag","disabled","onSelect"],["md","3",1,"py-1","text-center"],["type","hidden","formControlName","period","aria-label","flag","cFormControl",""],["formControlName","period","aria-label","period","cFormControl",""],["type","button","cButton","","color","dark","shape","rounded-pill",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"c-row",0),t.TgZ(1,"c-col",1),t.YNc(2,ue,2,1,"span",2),t.YNc(3,me,2,1,"button",3),t.qZA(),t.TgZ(4,"c-col",4),t.TgZ(5,"input",5,6),t.NdJ("focus",function(){return o.onValueFocus()})("blur",function(i){return o.onValueBlur(i)}),t.qZA(),t.qZA(),t.TgZ(7,"c-col",7),t._UZ(8,"input",8),t.TgZ(9,"app-flag-picker",9),t.NdJ("onSelect",function(i){return o.selectFlag(i)}),t.qZA(),t.qZA(),t.TgZ(10,"c-col",10),t._UZ(11,"input",11),t._UZ(12,"input",12),t.qZA(),t.qZA()),2&e&&(t.Q6J("ngClass",o.styles)("formGroup",o.group),t.xp6(2),t.Q6J("ngIf",!o.isDirty),t.xp6(1),t.Q6J("ngIf",o.isDirty),t.xp6(6),t.Q6J("flag",o.fg.flag.value)("disabled",o.disabled))},directives:[c.iok,_.mk,l.JL,l.sg,c.Yp0,_.O5,l.Fj,c.oHf,l.JJ,l.u,L,c.Hq3],styles:[".monthly-data-row[_ngcontent-%COMP%]{padding:.1rem .3rem;margin:.2rem 0;background-color:#e5ecf2;border:1px solid #cdd4da;border-radius:.2rem}.monthly-data-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{text-align:center}.monthly-data-row[_ngcontent-%COMP%]   c-col[_ngcontent-%COMP%]{padding:0 .2rem}.monthly-data-row.has-error[_ngcontent-%COMP%]{background-color:#ffe2e2;border:1px solid #dd6868}.monthly-data-row.is-invalid[_ngcontent-%COMP%]{background-color:#ffe2e2;border:1px solid #dd6868}.monthly-data-row.is-dirty[_ngcontent-%COMP%]{background-color:#a3e8fd;border:1px solid #8cc9db}.monthly-data-row.has-focus[_ngcontent-%COMP%]{background-color:#e2e7ec;border:1px solid #9dacb9;box-shadow:#00000040 1px 1px 0 1px}.monthly-data-row[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:disabled{cursor:not-allowed}.monthly-data-row[_ngcontent-%COMP%]   .btn.rounded-pill[_ngcontent-%COMP%]{padding:.1rem .4rem;font-size:.9rem}"]}),n})();const de=["monthlyGroup"];function fe(n,a){1&n&&(t.TgZ(0,"c-col",2),t._UZ(1,"app-infinite-loading"),t.qZA())}function ge(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",30),t.TgZ(1,"div",31),t.TgZ(2,"span"),t._uU(3),t.qZA(),t.TgZ(4,"a",32),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).resetStation()}),t.O4$(),t._UZ(5,"svg",33),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(3),t.Oqu(e.station.station_name)}}function he(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"app-station-selection",34),t.NdJ("onSelection",function(r){return t.CHM(e),t.oxw(2).onStationSelect(r)}),t.qZA()}}function ye(n,a){1&n&&(t.TgZ(0,"div"),t.O4$(),t._UZ(1,"svg",36),t._uU(2," Station selection required."),t.qZA())}function ve(n,a){if(1&n&&(t.TgZ(0,"div",35),t.YNc(1,ye,3,0,"div",16),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.f.station.errors.required)}}function Ce(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",30),t.TgZ(1,"div",31),t.TgZ(2,"span"),t._uU(3),t.qZA(),t.TgZ(4,"a",32),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).resetElement()}),t.O4$(),t._UZ(5,"svg",33),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(3),t.Oqu(e.element.element_name)}}function Ze(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"app-element-selection",34),t.NdJ("onSelection",function(r){return t.CHM(e),t.oxw(2).onElementSelect(r)}),t.qZA()}}function be(n,a){1&n&&(t.TgZ(0,"div"),t.O4$(),t._UZ(1,"svg",36),t._uU(2," Element selection is required."),t.qZA())}function xe(n,a){if(1&n&&(t.TgZ(0,"div",35),t.YNc(1,be,3,0,"div",16),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.f.element.errors.required)}}function Te(n,a){if(1&n&&(t.TgZ(0,"c-row"),t.TgZ(1,"c-col",37),t.TgZ(2,"c-alert",38),t.TgZ(3,"strong"),t._uU(4,"Error(s) Found!"),t.qZA(),t._uU(5),t.qZA(),t.qZA(),t.qZA()),2&n){const e=t.oxw(2);t.xp6(5),t.hij(" ",e.error,"")}}function we(n,a){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.hij("for ",e.getDateText(),"")}}function Fe(n,a){if(1&n&&(t.TgZ(0,"p"),t._uU(1," Values must be between "),t.TgZ(2,"strong"),t._uU(3),t.ALo(4,"number"),t.qZA(),t._uU(5," and "),t.TgZ(6,"strong"),t._uU(7),t.ALo(8,"number"),t.qZA(),t.qZA()),2&n){const e=t.oxw(3);t.xp6(3),t.hij(" ",t.lcZ(4,2,e.element.lower_limit)," "),t.xp6(4),t.hij("",t.lcZ(8,4,e.element.upper_limit)," ")}}function Ae(n,a){1&n&&t._UZ(0,"p")}function Me(n,a){if(1&n&&(t.TgZ(0,"c-row"),t.TgZ(1,"c-col",39),t.TgZ(2,"div",40),t._UZ(3,"img",41),t.TgZ(4,"h5"),t._uU(5,"Please use the following information for data entry"),t.qZA(),t.YNc(6,Fe,9,6,"p",16),t.YNc(7,Ae,1,0,"p",16),t.qZA(),t.qZA(),t.qZA()),2&n){const e=t.oxw(2);t.xp6(6),t.Q6J("ngIf",e.element.lower_limit&&e.element.upper_limit),t.xp6(1),t.Q6J("ngIf",!e.element.lower_limit||!e.element.upper_limit)}}function qe(n,a){1&n&&(t.TgZ(0,"c-row",42),t.TgZ(1,"c-col",43),t.TgZ(2,"c-row",44),t.TgZ(3,"c-col",45),t._uU(4,"Month"),t.qZA(),t.TgZ(5,"c-col",46),t._uU(6,"Value"),t.qZA(),t.TgZ(7,"c-col",46),t._uU(8,"Flag"),t.qZA(),t.TgZ(9,"c-col",47),t._uU(10,"Period"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(11,"c-col",48),t.TgZ(12,"c-row",44),t.TgZ(13,"c-col",45),t._uU(14,"Month"),t.qZA(),t.TgZ(15,"c-col",46),t._uU(16,"Value"),t.qZA(),t.TgZ(17,"c-col",46),t._uU(18,"Flag"),t.qZA(),t.TgZ(19,"c-col",47),t._uU(20,"Period"),t.qZA(),t.qZA(),t.qZA(),t.qZA())}function Se(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"c-col",50),t.TgZ(1,"app-month-form-group",51,52),t.NdJ("onReturn",function(r){return t.CHM(e),t.oxw(3).handleReturn(r)})("onFocus",function(r){return t.CHM(e),t.oxw(3).monthFocus(r)})("onBlur",function(r){return t.CHM(e),t.oxw(3).monthBlur(r)})("onDirty",function(r){return t.CHM(e),t.oxw(3).onFormModified(r)})("onRevert",function(r){return t.CHM(e),t.oxw(3).revertMonth(r)}),t.qZA(),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw(3);t.xp6(1),t.Q6J("disabled",!o.isEditable)("modified",o.isModified)("limits",o.limits)("group",e)}}function Oe(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"c-col",50),t.TgZ(1,"app-month-form-group",51,52),t.NdJ("onReturn",function(r){return t.CHM(e),t.oxw(3).handleReturn(r)})("onFocus",function(r){return t.CHM(e),t.oxw(3).monthFocus(r)})("onBlur",function(r){return t.CHM(e),t.oxw(3).monthBlur(r)})("onDirty",function(r){return t.CHM(e),t.oxw(3).onFormModified(r)})("onRevert",function(r){return t.CHM(e),t.oxw(3).revertMonth(r)}),t.qZA(),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw(3);t.xp6(1),t.Q6J("disabled",!o.isEditable)("modified",o.isModified)("limits",o.limits)("group",e)}}function De(n,a){if(1&n&&(t.TgZ(0,"c-row",42),t.TgZ(1,"c-col",43),t.TgZ(2,"c-row"),t.YNc(3,Se,3,4,"c-col",49),t.ALo(4,"slice"),t.qZA(),t.qZA(),t.TgZ(5,"c-col",43),t.TgZ(6,"c-row"),t.YNc(7,Oe,3,4,"c-col",49),t.ALo(8,"slice"),t.qZA(),t.qZA(),t.qZA()),2&n){const e=t.oxw(2);t.xp6(3),t.Q6J("ngForOf",t.Dn7(4,2,e.formMonthGroups,0,6)),t.xp6(4),t.Q6J("ngForOf",t.Dn7(8,6,e.formMonthGroups,6,12))}}function He(n,a){1&n&&(t.TgZ(0,"c-alert",53),t._uU(1,"Please select a date to view form."),t.qZA())}function ke(n,a){1&n&&t._UZ(0,"c-spinner",54)}const ht=function(n){return{"is-invalid":n}},Ie=function(n,a){return{"is-valid":n,"is-invalid":a}};function Ee(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"form",1),t.NdJ("ngSubmit",function(r){return t.CHM(e),t.oxw().onSubmit(r)})("keydown.enter",function(r){return t.CHM(e),t.oxw().onReturn(r)}),t.TgZ(1,"c-row"),t.TgZ(2,"c-col",2),t._UZ(3,"app-flag-legend"),t.qZA(),t.YNc(4,fe,2,0,"c-col",3),t.TgZ(5,"c-col",4),t.TgZ(6,"fieldset",5),t.TgZ(7,"legend"),t._uU(8,"Form Selector"),t.qZA(),t.TgZ(9,"c-row"),t.TgZ(10,"c-col",6),t.TgZ(11,"div",7),t.TgZ(12,"label",8),t._uU(13,"Station"),t.qZA(),t._UZ(14,"input",9),t.YNc(15,ge,6,1,"div",10),t.YNc(16,he,1,0,"app-station-selection",11),t.YNc(17,ve,2,1,"div",12),t.qZA(),t.qZA(),t.TgZ(18,"c-col",6),t.TgZ(19,"div",7),t.TgZ(20,"label",13),t._uU(21,"Element"),t.qZA(),t._UZ(22,"input",14),t.YNc(23,Ce,6,1,"div",10),t.YNc(24,Ze,1,0,"app-element-selection",11),t.YNc(25,xe,2,1,"div",12),t.qZA(),t.qZA(),t.TgZ(26,"c-col",6),t.TgZ(27,"app-year-selector",15),t.NdJ("onSelect",function(r){return t.CHM(e),t.oxw().yearSelect(r)}),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.YNc(28,Te,6,1,"c-row",16),t.TgZ(29,"fieldset",17),t.TgZ(30,"legend"),t._uU(31,"Monthly Data "),t.YNc(32,we,2,1,"span",16),t.qZA(),t.YNc(33,Me,8,2,"c-row",16),t.YNc(34,qe,21,0,"c-row",18),t.YNc(35,De,9,10,"c-row",18),t.TgZ(36,"c-row",19),t.TgZ(37,"c-col",20),t.TgZ(38,"div",7),t.TgZ(39,"label",21),t._uU(40,"Total"),t.qZA(),t._UZ(41,"input",22),t.qZA(),t.qZA(),t.qZA(),t.YNc(42,He,2,0,"c-alert",23),t.qZA(),t._UZ(43,"hr",24),t.TgZ(44,"c-row"),t.TgZ(45,"c-col",25),t.TgZ(46,"button",26),t.YNc(47,ke,1,0,"c-spinner",27),t._uU(48),t.qZA(),t.TgZ(49,"button",28),t.NdJ("click",function(){return t.CHM(e),t.oxw().onReset()}),t._uU(50," Reset "),t.qZA(),t.TgZ(51,"button",29),t.NdJ("click",function(){return t.CHM(e),t.oxw().onCancel()}),t._uU(52," Cancel "),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=t.oxw();t.Q6J("formGroup",e.form),t.xp6(4),t.Q6J("ngIf",e.loading),t.xp6(10),t.Q6J("ngClass",t.VKq(20,ht,(e.submitted||e.f.station.touched)&&e.f.station.invalid)),t.xp6(1),t.Q6J("ngIf",e.station),t.xp6(1),t.Q6J("ngIf",!e.station),t.xp6(1),t.Q6J("ngIf",e.f.station.errors),t.xp6(5),t.Q6J("ngClass",t.VKq(22,ht,(e.submitted||e.f.element.touched)&&e.f.element.invalid)),t.xp6(1),t.Q6J("ngIf",e.element),t.xp6(1),t.Q6J("ngIf",!e.element),t.xp6(1),t.Q6J("ngIf",e.f.element.errors),t.xp6(2),t.Q6J("value",e.yearValue),t.xp6(1),t.Q6J("ngIf",e.error),t.xp6(4),t.Q6J("ngIf",e.date),t.xp6(1),t.Q6J("ngIf",e.element&&e.formMonthGroups.length),t.xp6(1),t.Q6J("ngIf",e.formMonthGroups.length),t.xp6(1),t.Q6J("ngIf",e.formMonthGroups.length),t.xp6(6),t.Q6J("ngClass",t.WLB(24,Ie,e.f.total.value===e.calcTotal,e.f.total.value!==e.calcTotal)),t.xp6(1),t.Q6J("ngIf",!e.formMonthGroups.length),t.xp6(5),t.Q6J("ngIf",e.loading),t.xp6(1),t.hij(" ",e.hasRecord?"Update":"Save"," ")}}let Ne=(()=>{class n{constructor(e,o,r,i,s,p){this.router=e,this.modalService=o,this.responsiveSvc=r,this.dataEntryService=i,this.stationService=s,this.elementService=p,this.submitted=!1,this.loading=!1,this.error="",this.monthModified=!1,this.yearValue=(new Date).getFullYear(),this.bsConfig={isAnimated:!0,containerClass:"theme-blue",dateInputFormat:"YYYY"},this.monthsList=[1,2,3,4,5,6,7,8,9,10,11,12],this.hasRecord=!1,this.month=0}ngOnInit(){this.initForm(),this.dataEntryService.monthlyState.pipe((0,w.b)(e=>this.loading=!!e),(0,m.h)(e=>!!e),(0,M.q)(1)).subscribe(e=>{this.initForm(new Date(e.year).getFullYear()),this.setFormState(+e.station,+e.element,new Date(e.year).getFullYear())}),this.renderFormMonths(this.yearValue)}get f(){return this.form.controls}get isEditable(){return!!this.station&&!!this.element}get isModified(){return this.monthModified}get hasChanges(){return this.monthlyGroup.toArray().filter(e=>!0===e.isDirty).length>0}get invalidEntries(){return this.monthlyGroup.toArray().filter(e=>!!e.isInvalid).length>0}onFormModified(e){this.monthModified=e}resetStation(){this.station=void 0,this.form.controls.station.reset()}onStationSelect(e){this.station=e,this.form.controls.station.setValue(e.station_id),this.loadMonthlyData()}resetElement(){this.element=void 0,this.form.controls.element.reset(),this.limits=null}onElementSelect(e){this.element=e,this.form.controls.element.setValue(e.element_id),this.limits=e.lower_limit&&e.upper_limit?{lower:+e.lower_limit,upper:+e.upper_limit}:null,this.loadMonthlyData()}onSubmit(e){if(this.submitted=!0,!this.form.invalid||this.f.months.invalid){if(this.invalidEntries)return void(this.error="The monthly data contains some invalid entries, please fix the items and try again.");if(console.log(+this.f.total.value,this.calcTotal,+this.f.total.value===this.calcTotal),+this.f.total.value!==this.calcTotal)return void(this.error="The days based data total does not match with the total provided, please check the values and try again.");this.error="",this.hasRecord?this.updateRecord():this.addRecord()}}yearSelect(e){this.f.yyyy.setValue(e),this.renderFormMonths(e),this.loadMonthlyData()}onReset(){this.form.reset(),this.initForm()}onCancel(){}onReturn(e){e.preventDefault()}getDateText(){return g(this.date).format("YYYY")}get monthsArray(){return this.form.get("months")}get formMonthGroups(){return this.monthsArray.controls}get calcTotal(){return this.monthlyGroup?this.monthlyGroup.toArray().reduce((e,o)=>(o.group.value.value?+o.group.value.value:0)+e,0):0}monthFocus(e){this.month=e}monthBlur(e){}handleReturn(e){+e<this.monthlyGroup.toArray().length&&this.monthlyGroup.toArray()[+e].focusValue()}revertMonth(e){console.log(e),this.modalService.show(q.S,{initialState:{title:"Confirm Revert",message:"Are you sure you want to revert to original values?",confirm:"Go Ahead",cancel:"Cancel"}}).content.onClose.subscribe(i=>{if(i)if(this.hasRecord){const s=(e<10?"0":"")+e;this.formMonthGroups[e-1]=this.getMonthGroup({month:e,value:this.raw[`mm_${s}`],flag:this.raw[`flag${s}`],period:this.raw[`period${s}`]})}else this.formMonthGroups[e-1]=this.getMonthGroup({})})}getMonthGroup(e){const o=new l.cw({month:new l.NI(null),value:new l.NI(null,[l.kI.min(0),l.kI.max(70)]),flag:new l.NI(null),period:new l.NI(null)});return e&&o.patchValue(e),o}renderFormMonths(e){const r=g(`${e}`).year();this.resetMonths();for(let i of this.monthsList){const s=g(`${r}-${i}}`,"YYYY-MM").daysInMonth(),p=g(`${r}-${i}`,"YYYY-MM").format("MMMM");this.monthsArray.push(this.getMonthGroup({month:p,value:null,flag:u.M,period:s}))}}resetMonths(){this.form.controls.months=new l.Oe([])}initForm(e=(new Date).getFullYear()){this.form=new l.cw({station:new l.NI(null,l.kI.required),element:new l.NI(null,l.kI.required),yyyy:new l.NI(e,l.kI.required),months:new l.Oe([]),total:new l.NI(0)})}setFormState(e,o,r){this.stationService.getStation(e).pipe((0,w.b)(i=>{this.station=i.result[0]}),(0,tt.w)(i=>this.elementService.getElement(o))).subscribe(i=>{this.element=i.result[0],this.f.station.setValue(e),this.f.element.setValue(o),this.f.yyyy.setValue(r),this.yearValue=+r,this.loadMonthlyData()})}loadMonthlyData(){this.station&&this.element&&this.yearValue&&(this.loading=!0,this.dataEntryService.getMonthlyEntry(this.station.station_id,this.element.element_id,this.f.yyyy.value).subscribe(e=>{console.log(e),this.hasRecord=e.result.length>0,e.result.length?(this.raw=e.result[0],this.renderFormMonths(this.yearValue),this.patchForm(e.result[0])):(this.resetMonths(),this.renderFormMonths(this.yearValue),this.f.total.setValue(0),this.focusFirst()),this.loading=!1}))}patchForm(e){let o=0;this.formMonthGroups.forEach((r,i)=>{const s=i+1<10?`0${i+1}`:i+1,v={month:g(`${this.yearValue}-${i+1}`,"YYYY-MM").format("MMMM"),value:e[`mm_${s}`],flag:e[`flag${s}`]||u.N,period:e[`period${s}`]};r.patchValue(Object.assign({},v)),o+=+e[`mm_${s}`]}),this.f.total.setValue(o||0),this.focusFirst()}addRecord(){let e=this.buildPayload();console.log(e),this.hasChanges||alert("You must enter a few values"),this.dataEntryService.addMonthlyEntry(e).subscribe()}updateRecord(){var e,o;let r=this.buildPayload();console.log(r),this.hasChanges||alert("You must enter a few values"),this.dataEntryService.updateMonthlyEntry(null===(e=this.station)||void 0===e?void 0:e.station_id,null===(o=this.element)||void 0===o?void 0:o.element_id,this.f.yyyy.value,r).subscribe()}buildPayload(){var e,o;const r={stationId:null===(e=this.station)||void 0===e?void 0:e.station_id,elementId:null===(o=this.element)||void 0===o?void 0:o.element_id,yyyy:+this.f.yyyy.value,signature:"",entry_datetime:new Date},i=this.form.value;console.log(i),i.months=this.formMonthGroups.map(p=>Object.assign(Object.assign({},p.value),{flag:p.value.flag||null}));let s=1;for(let p of i.months){const v=s<10?`0${s}`:`${s}`;r[`mm_${v}`]=p.value,r[`flag${v}`]=p.flag||null,r[`period${v}`]=p.period,s++}return r}focusFirst(){(0,O.of)(!0).pipe((0,h.g)(100)).subscribe(()=>{this.monthlyGroup.toArray()[0].focusValue()})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(Z.F0),t.Y36(x.tT),t.Y36(D.k),t.Y36(U),t.Y36(V.v),t.Y36(_t.d))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-form-monthly"]],viewQuery:function(e,o){if(1&e&&t.Gf(de,5),2&e){let r;t.iGM(r=t.CRH())&&(o.monthlyGroup=r)}},decls:4,vars:1,consts:[["novalidate","",3,"formGroup","ngSubmit","keydown.enter",4,"ngIf"],["novalidate","",3,"formGroup","ngSubmit","keydown.enter"],["sm","12",1,"text-end"],["sm","12","class","text-end",4,"ngIf"],["sm","12"],[1,"form-group","p-3","mt-4"],["xs","12","md","4","xl","3"],[1,"mb-2"],["cLabel","","for","station"],["id","station","type","hidden","formControlName","station","aria-label","default input","cFormControl","",3,"ngClass"],["class","typeahead-selection theme form-group",4,"ngIf"],[3,"onSelection",4,"ngIf"],["col","12","class","invalid-feedback",4,"ngIf"],["cLabel","","for","element"],["id","element","type","hidden","formControlName","element","aria-label","default input","cFormControl","",3,"ngClass"],[3,"value","onSelect"],[4,"ngIf"],[1,"form-group","p-3","mt-2"],["formArrayName","months",4,"ngIf"],[1,"mt-3"],["sm","12","md","6","lg","4","xl","3"],["cLabel","","for","total"],["type","number","formControlName","total","aria-label","total","placeholder","Total","cFormControl","",1,"txt-total",3,"ngClass"],["color","info","class","mt-4",4,"ngIf"],[1,"my-4"],["xs","12 py-4"],["type","submit","cButton","","color","dark",1,"px-3"],["aria-hidden","true","size","sm",4,"ngIf"],["type","button","cButton","","color","dark",1,"px-3","mx-1",3,"click"],["type","button","cButton","","color","dark",1,"px-3",3,"click"],[1,"typeahead-selection","theme","form-group"],[1,"typeahead-selection-inner"],[1,"btn",3,"click"],["cIcon","","name","cilX"],[3,"onSelection"],["col","12",1,"invalid-feedback"],["cIcon","","name","cilXCircle"],["md","12",1,"mt-3"],["color","danger"],["md","12 mt-3 mb-3"],[1,"form-info"],["src","./assets/img/icons/info.png","alt",""],["formArrayName","months"],["xs","12","sm","12","md","6","lg","6","xl","5"],[1,"hourly-header"],["xs","5",1,"py-1"],["xs","2",1,"py-1"],["xs","3",1,"py-1"],["xs","12","sm","12","md","6","lg","6","xl","5",1,"d-none","d-md-block"],["md","12",4,"ngFor","ngForOf"],["md","12"],[3,"disabled","modified","limits","group","onReturn","onFocus","onBlur","onDirty","onRevert"],["monthlyGroup",""],["color","info",1,"mt-4"],["aria-hidden","true","size","sm"]],template:function(e,o){1&e&&(t.TgZ(0,"h5"),t._uU(1," Monthly data for selected year "),t.qZA(),t._UZ(2,"hr"),t.YNc(3,Ee,53,27,"form",0)),2&e&&(t.xp6(3),t.Q6J("ngIf",o.form))},directives:[_.O5,l._Y,l.JL,l.sg,c.iok,c.Yp0,P,c.eFW,l.Fj,c.oHf,l.JJ,l.u,_.mk,ce,l.wV,c.Hq3,j.$,J.ar,Y.n,ut.Y,c.wxo,l.CE,_.sg,pe,c.ORR],pipes:[_.JJ,_.OU],styles:[".form-info[_ngcontent-%COMP%]{position:relative;padding:1rem .8rem .2rem 5rem;background-color:#d6ebff;border:1px solid #c2e0ff;border-radius:.25rem;color:#333;box-shadow:0 3px 10px #0003}.form-info[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{position:absolute;top:1rem;left:.8rem;width:4rem}.form-info[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-size:1.1rem}.form-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;margin-top:.5rem}"]}),n})();const Re=["ddffValue"],Ue=["ddValue"],Pe=["ffValue"];function Je(n,a){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Oqu(e.hourVal(e.fg.hour.value))}}function Ye(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"button",12),t.NdJ("click",function(){return t.CHM(e),t.oxw().revert()}),t._uU(1),t.qZA()}if(2&n){const e=t.oxw();t.xp6(1),t.Oqu(e.hourVal(e.fg.hour.value))}}const Ge=function(n){return{"is-invalid":n}};let $e=(()=>{class n{constructor(e){this.ref=e,this.modified=!1,this.disabled=!1,this.group=new l.cw({hour:new l.NI(1),ddff:new l.NI(null,l.kI.required),dd:new l.NI(null,l.kI.required),ff:new l.NI(null,l.kI.required),flag:new l.NI(u.N)}),this.onDirty=new t.vpe,this.onRevert=new t.vpe,this.onFocus=new t.vpe,this.onBlur=new t.vpe,this.onReturn=new t.vpe,this.ddffFocus=!1,this.hasFocus=!1}ngOnInit(){this.group.valueChanges.pipe((0,m.h)(e=>!this.modified)).subscribe(e=>{this.onDirty.emit(!0)})}ngOnChanges(e){this.disabled?this.group.disable():this.group.enable()}ngAfterViewInit(){(0,Q.R)(this.ref.nativeElement,"keyup").pipe((0,m.h)(e=>13===e.keyCode&&this.ddffFocus)).subscribe(e=>{this.onValRetunKey()})}get ddffRegex(){if(this.config)switch(this.config.dd+this.config.ff){case 2:return/\b\d{2}\b/g;case 3:return/\b\d{3}\b/g;case 4:return/\b\d{4}\b/g;case 5:return/\b\d{5}\b/g;default:return/\b\d{6}\b/g}}get fg(){return this.group.controls}get isDirty(){return this.fg.ddff.dirty||this.fg.flag.dirty}get isInvalid(){return this.ddffInvalid||this.fg.ddff.dirty&&""!==this.fg.ddff.value&&this.fg.flag.value===u.M}get ddffInvalid(){return this.fg.ddff.dirty&&this.fg.ddff.value&&!this.ddffRegex.test(this.fg.ddff.value)}get styles(){const e={"has-focus":this.hasFocus};return this.isDirty&&(e["is-dirty"]=!0),this.isInvalid&&(e["is-dirty"]=!1,e["is-invalid"]=!0),e}hourVal(e){return e?e&&e<10?`0${e}`:`${e}`:"00"}focusValue(){this.ddffValue.nativeElement.focus()}selectFlag(e){this.group.controls.flag.setValue(e)}onValRetunKey(){""===this.fg.ddff.value&&this.fg.flag.setValue(u.M),this.onReturn.emit(+this.fg.hour.value)}onValFocus(e){this.hasFocus=!0,this.ddffFocus=!0,this.onFocus.emit(this.fg.hour.value)}onValBlur(){this.hasFocus=!1;const e=this.fg.ddff.value;if(""!==e){if(""!==e&&this.fg.flag.value===u.M&&this.selectFlag(u.N),!this.ddffInvalid&&+e){const o=e.slice(0,this.config.dd),r=e.slice(this.config.dd,this.config.dd+this.config.ff);this.fg.dd.setValue(o),this.fg.ff.setValue(r),this.fg.ddff.markAsPristine()}this.onBlur.emit(this.fg.hour.value),this.ddffFocus=!1}else this.fg.flag.value!==u.M&&this.selectFlag(u.M)}revert(){this.onRevert.emit(+this.fg.hour.value)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(t.SBq))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-hourly-wind-form-group"]],viewQuery:function(e,o){if(1&e&&(t.Gf(Re,5),t.Gf(Ue,5),t.Gf(Pe,5)),2&e){let r;t.iGM(r=t.CRH())&&(o.ddffValue=r.first),t.iGM(r=t.CRH())&&(o.ddValue=r.first),t.iGM(r=t.CRH())&&(o.ffValue=r.first)}},inputs:{modified:"modified",disabled:"disabled",config:"config",group:"group"},outputs:{onDirty:"onDirty",onRevert:"onRevert",onFocus:"onFocus",onBlur:"onBlur",onReturn:"onReturn"},features:[t.TTD],decls:16,vars:11,consts:[[1,"hourly-data-row",3,"ngClass","formGroup"],["sm","2",1,"py-2","label"],[4,"ngIf"],["type","button","cButton","","color","dark","shape","rounded-pill",3,"click",4,"ngIf"],["sm","4",1,"py-1"],["formControlName","ddff","aria-label","ddff","cFormControl","",3,"ngClass","focus","blur"],["ddffValue",""],["sm","2",1,"py-1"],[1,"text-label"],["sm","2",1,"py-1","text-center"],["type","hidden","formControlName","flag","aria-label","flag","cFormControl",""],[3,"flag","disabled","onSelect"],["type","button","cButton","","color","dark","shape","rounded-pill",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"c-row",0),t.TgZ(1,"c-col",1),t.YNc(2,Je,2,1,"span",2),t.YNc(3,Ye,2,1,"button",3),t.qZA(),t.TgZ(4,"c-col",4),t.TgZ(5,"input",5,6),t.NdJ("focus",function(){return o.onValFocus("ddff")})("blur",function(){return o.onValBlur()}),t.qZA(),t.qZA(),t.TgZ(7,"c-col",7),t.TgZ(8,"div",8),t._uU(9),t.qZA(),t.qZA(),t.TgZ(10,"c-col",7),t.TgZ(11,"div",8),t._uU(12),t.qZA(),t.qZA(),t.TgZ(13,"c-col",9),t._UZ(14,"input",10),t.TgZ(15,"app-flag-picker",11),t.NdJ("onSelect",function(i){return o.selectFlag(i)}),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.Q6J("ngClass",o.styles)("formGroup",o.group),t.xp6(2),t.Q6J("ngIf",!o.isDirty),t.xp6(1),t.Q6J("ngIf",o.isDirty),t.xp6(2),t.Q6J("ngClass",t.VKq(9,Ge,o.ddffInvalid)),t.xp6(4),t.Oqu(o.fg.dd.value),t.xp6(3),t.Oqu(o.fg.ff.value),t.xp6(3),t.Q6J("flag",o.fg.flag.value)("disabled",o.disabled))},directives:[c.iok,_.mk,l.JL,l.sg,c.Yp0,_.O5,l.Fj,c.oHf,l.JJ,l.u,L,c.Hq3],styles:[".hourly-data-row[_ngcontent-%COMP%]{padding:.1rem .3rem;margin:.2rem 0;background-color:#e5ecf2;border:1px solid #cdd4da;border-radius:.2rem}.hourly-data-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{text-align:center}.hourly-data-row[_ngcontent-%COMP%]   c-col[_ngcontent-%COMP%]{padding:0 .2rem}.hourly-data-row.has-error[_ngcontent-%COMP%]{background-color:#ffe2e2;border:1px solid #dd6868}.hourly-data-row.is-invalid[_ngcontent-%COMP%]{background-color:#ffe2e2;border:1px solid #dd6868}.hourly-data-row.is-dirty[_ngcontent-%COMP%]{background-color:#a3e8fd;border:1px solid #8cc9db}.hourly-data-row.has-focus[_ngcontent-%COMP%]{background-color:#e2e7ec;border:1px solid #9dacb9;box-shadow:#00000040 1px 1px 0 1px}.hourly-data-row[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:disabled{cursor:not-allowed}.hourly-data-row[_ngcontent-%COMP%]   .btn.rounded-pill[_ngcontent-%COMP%]{padding:.1rem .4rem;font-size:.9rem}.hourly-data-row[_ngcontent-%COMP%]   .text-label[_ngcontent-%COMP%]{padding:.375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;text-align:center;border-radius:.25rem;border:1px solid #8cc9db}"]}),n})();const Ve=["hourlyWindGroup"];function Qe(n,a){1&n&&(t.TgZ(0,"c-col",2),t._UZ(1,"app-infinite-loading"),t.qZA())}function Le(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",30),t.TgZ(1,"div",31),t.TgZ(2,"span"),t._uU(3),t.qZA(),t.TgZ(4,"a",32),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).resetStation()}),t.O4$(),t._UZ(5,"svg",33),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(3),t.Oqu(e.station.station_name)}}function Be(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"app-station-selection",34),t.NdJ("onSelection",function(r){return t.CHM(e),t.oxw(2).onStationSelect(r)}),t.qZA()}}function We(n,a){1&n&&(t.TgZ(0,"div"),t.O4$(),t._UZ(1,"svg",36),t._uU(2," Station selection required."),t.qZA())}function Ke(n,a){if(1&n&&(t.TgZ(0,"div",35),t.YNc(1,We,3,0,"div",20),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.f.station.errors.required)}}function je(n,a){1&n&&(t.TgZ(0,"div",37),t.O4$(),t._UZ(1,"svg",36),t._uU(2," Year and Month is required "),t.qZA())}function ze(n,a){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.hij("for ",e.getDateText(),"")}}function Xe(n,a){if(1&n&&(t.TgZ(0,"c-row"),t.TgZ(1,"c-col",38),t.TgZ(2,"c-alert",39),t.TgZ(3,"strong"),t._uU(4,"Error(s) Found!"),t.qZA(),t._uU(5),t.qZA(),t.qZA(),t.qZA()),2&n){const e=t.oxw(2);t.xp6(5),t.hij(" ",e.error,"")}}function to(n,a){1&n&&(t.TgZ(0,"c-row",40),t.TgZ(1,"c-col",41),t.TgZ(2,"c-row",42),t.TgZ(3,"c-col",43),t._uU(4,"Hour"),t.qZA(),t.TgZ(5,"c-col",44),t._uU(6,"DDFF"),t.qZA(),t.TgZ(7,"c-col",43),t._uU(8,"DD"),t.qZA(),t.TgZ(9,"c-col",43),t._uU(10,"FF"),t.qZA(),t.TgZ(11,"c-col",43),t._uU(12,"Flag"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(13,"c-col",45),t.TgZ(14,"c-row",42),t.TgZ(15,"c-col",43),t._uU(16,"Hour"),t.qZA(),t.TgZ(17,"c-col",44),t._uU(18,"DDFF"),t.qZA(),t.TgZ(19,"c-col",43),t._uU(20,"DD"),t.qZA(),t.TgZ(21,"c-col",43),t._uU(22,"FF"),t.qZA(),t.TgZ(23,"c-col",43),t._uU(24,"Flag"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(25,"c-col",46),t.TgZ(26,"c-row",42),t.TgZ(27,"c-col",43),t._uU(28,"Hour"),t.qZA(),t.TgZ(29,"c-col",44),t._uU(30,"DDFF"),t.qZA(),t.TgZ(31,"c-col",43),t._uU(32,"DD"),t.qZA(),t.TgZ(33,"c-col",43),t._uU(34,"FF"),t.qZA(),t.TgZ(35,"c-col",43),t._uU(36,"Flag"),t.qZA(),t.qZA(),t.qZA(),t.qZA())}function eo(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"c-col",38),t.TgZ(1,"app-hourly-wind-form-group",48,49),t.NdJ("onDirty",function(r){return t.CHM(e),t.oxw(3).onFormModified(r)})("onReturn",function(r){return t.CHM(e),t.oxw(3).handleReturn(r)})("onFocus",function(r){return t.CHM(e),t.oxw(3).hourFocus(r)})("onBlur",function(r){return t.CHM(e),t.oxw(3).hourBlur(r)})("onDirty",function(r){return t.CHM(e),t.oxw(3).onFormModified(r)})("onRevert",function(r){return t.CHM(e),t.oxw(3).revertHour(r)}),t.qZA(),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw(3);t.xp6(1),t.Q6J("config",o.ddffConfig)("disabled",!o.isEditable)("modified",o.isModified)("group",e)}}function oo(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"c-col",38),t.TgZ(1,"app-hourly-wind-form-group",48,49),t.NdJ("onDirty",function(r){return t.CHM(e),t.oxw(3).onFormModified(r)})("onReturn",function(r){return t.CHM(e),t.oxw(3).handleReturn(r)})("onFocus",function(r){return t.CHM(e),t.oxw(3).hourFocus(r)})("onBlur",function(r){return t.CHM(e),t.oxw(3).hourBlur(r)})("onDirty",function(r){return t.CHM(e),t.oxw(3).onFormModified(r)})("onRevert",function(r){return t.CHM(e),t.oxw(3).revertHour(r)}),t.qZA(),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw(3);t.xp6(1),t.Q6J("config",o.ddffConfig)("disabled",!o.isEditable)("modified",o.isModified)("group",e)}}function no(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"c-col",38),t.TgZ(1,"app-hourly-wind-form-group",48,49),t.NdJ("onDirty",function(r){return t.CHM(e),t.oxw(3).onFormModified(r)})("onReturn",function(r){return t.CHM(e),t.oxw(3).handleReturn(r)})("onFocus",function(r){return t.CHM(e),t.oxw(3).hourFocus(r)})("onBlur",function(r){return t.CHM(e),t.oxw(3).hourBlur(r)})("onDirty",function(r){return t.CHM(e),t.oxw(3).onFormModified(r)})("onRevert",function(r){return t.CHM(e),t.oxw(3).revertHour(r)}),t.qZA(),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw(3);t.xp6(1),t.Q6J("config",o.ddffConfig)("disabled",!o.isEditable)("modified",o.isModified)("group",e)}}function ro(n,a){if(1&n&&(t.TgZ(0,"c-row",40),t.TgZ(1,"c-col",41),t.TgZ(2,"c-row"),t.YNc(3,eo,3,4,"c-col",47),t.ALo(4,"slice"),t.qZA(),t.qZA(),t.TgZ(5,"c-col",41),t.TgZ(6,"c-row"),t.YNc(7,oo,3,4,"c-col",47),t.ALo(8,"slice"),t.qZA(),t.qZA(),t.TgZ(9,"c-col",41),t.TgZ(10,"c-row"),t.YNc(11,no,3,4,"c-col",47),t.ALo(12,"slice"),t.qZA(),t.qZA(),t.qZA()),2&n){const e=t.oxw(2);t.xp6(3),t.Q6J("ngForOf",t.Dn7(4,3,e.formHoursGroups,0,8)),t.xp6(4),t.Q6J("ngForOf",t.Dn7(8,7,e.formHoursGroups,8,16)),t.xp6(4),t.Q6J("ngForOf",t.Dn7(12,11,e.formHoursGroups,16,24))}}const io=function(n,a){return{"is-valid":n,"is-invalid":a}};function lo(n,a){if(1&n&&(t.TgZ(0,"c-row",50),t.TgZ(1,"c-col",51),t.TgZ(2,"div",7),t.TgZ(3,"label",52),t._uU(4,"Total [FF]"),t.qZA(),t._UZ(5,"input",53),t.qZA(),t.qZA(),t.qZA()),2&n){const e=t.oxw(2);t.xp6(5),t.Q6J("ngClass",t.WLB(1,io,e.f.total.value===e.calcTotal,e.f.total.value!==e.calcTotal))}}function ao(n,a){1&n&&(t.TgZ(0,"c-alert",54),t._uU(1,"Please select a date to view form."),t.qZA())}function so(n,a){1&n&&t._UZ(0,"c-spinner",55)}const yt=function(n){return{"is-invalid":n}};function co(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"form",1),t.NdJ("ngSubmit",function(r){return t.CHM(e),t.oxw().onSubmit(r)})("keydown.enter",function(r){return t.CHM(e),t.oxw().onReturn(r)}),t.TgZ(1,"c-row"),t.TgZ(2,"c-col",2),t._UZ(3,"app-flag-legend"),t.qZA(),t.YNc(4,Qe,2,0,"c-col",3),t.TgZ(5,"c-col",4),t.TgZ(6,"fieldset",5),t.TgZ(7,"legend"),t._uU(8,"Form Selector"),t.qZA(),t.TgZ(9,"c-row"),t.TgZ(10,"c-col",6),t.TgZ(11,"div",7),t.TgZ(12,"label",8),t._uU(13,"Station"),t.qZA(),t._UZ(14,"input",9),t.YNc(15,Le,6,1,"div",10),t.YNc(16,Be,1,0,"app-station-selection",11),t.YNc(17,Ke,2,1,"div",12),t.qZA(),t.qZA(),t.TgZ(18,"c-col",6),t.TgZ(19,"label",13),t._uU(20,"Day/Month/Year"),t.qZA(),t.TgZ(21,"c-input-group",14),t.TgZ(22,"span",15),t.O4$(),t._UZ(23,"svg",16),t.qZA(),t.kcU(),t._UZ(24,"input",17),t.TgZ(25,"input",18),t.NdJ("bsValueChange",function(r){return t.CHM(e),t.oxw().onDateSelection(r)})("onShown",function(r){return t.CHM(e),t.oxw().onOpenCalendar(r)}),t.qZA(),t.YNc(26,je,3,0,"div",19),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(27,"fieldset",5),t.TgZ(28,"legend"),t._uU(29,"Hourly Data "),t.YNc(30,ze,2,1,"span",20),t.qZA(),t.YNc(31,Xe,6,1,"c-row",20),t.YNc(32,to,37,0,"c-row",21),t.YNc(33,ro,13,15,"c-row",21),t.YNc(34,lo,6,4,"c-row",22),t.YNc(35,ao,2,0,"c-alert",23),t.qZA(),t._UZ(36,"hr",24),t.TgZ(37,"c-row"),t.TgZ(38,"c-col",25),t.TgZ(39,"button",26),t.YNc(40,so,1,0,"c-spinner",27),t._uU(41),t.qZA(),t.TgZ(42,"button",28),t.NdJ("click",function(){return t.CHM(e),t.oxw().onReset()}),t._uU(43," Reset "),t.qZA(),t.TgZ(44,"button",29),t.NdJ("click",function(){return t.CHM(e),t.oxw().onCancel()}),t._uU(45," Cancel "),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=t.oxw();t.Q6J("formGroup",e.form),t.xp6(4),t.Q6J("ngIf",e.loading),t.xp6(10),t.Q6J("ngClass",t.VKq(18,yt,(e.submitted||e.f.station.touched)&&e.f.station.invalid)),t.xp6(1),t.Q6J("ngIf",e.station),t.xp6(1),t.Q6J("ngIf",!e.station),t.xp6(1),t.Q6J("ngIf",e.f.station.errors),t.xp6(8),t.Q6J("bsConfig",e.bsConfig)("bsValue",e.monthYearValue)("ngClass",t.VKq(20,yt,e.submitted&&e.f.date.invalid)),t.xp6(1),t.Q6J("ngIf",e.submitted&&e.f.date.invalid),t.xp6(4),t.Q6J("ngIf",e.date),t.xp6(1),t.Q6J("ngIf",e.error),t.xp6(1),t.Q6J("ngIf",e.formHoursGroups.length),t.xp6(1),t.Q6J("ngIf",e.formHoursGroups.length),t.xp6(1),t.Q6J("ngIf",e.formHoursGroups.length),t.xp6(1),t.Q6J("ngIf",!e.formHoursGroups.length),t.xp6(5),t.Q6J("ngIf",e.loading),t.xp6(1),t.hij(" ",e.hasRecord?"Update":"Save"," ")}}let _o=(()=>{class n{constructor(e,o,r,i,s){this.router=e,this.modalService=o,this.responsiveSvc=r,this.dataEntryService=i,this.stationService=s,this.submitted=!1,this.loading=!1,this.error="",this.monthModified=!1,this.monthYearValue=new Date,this.bsConfig={isAnimated:!0,containerClass:"theme-blue",dateInputFormat:"DD/MM/YYYY"},this.hasRecord=!1,this.activeHour=0,this.hoursList=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],this.config={elem_111:{},elem_112:{}},this.initConfig()}ngOnInit(){this.initForm(),this.responsiveSvc.screenSize.subscribe(e=>{console.log(e)}),this.dataEntryService.hourlyWindState.pipe((0,w.b)(e=>this.loading=!!e),(0,m.h)(e=>!!e),(0,M.q)(1)).subscribe(e=>{console.log(e),this.setFormState(+e.station,new Date(e.date))})}get f(){return this.form.controls}get isEditable(){return!!this.station}get isModified(){return this.monthModified}get hasChanges(){return this.hourlyWindGroup.toArray().filter(e=>!0===e.isDirty).length>0}get invalidEntries(){return this.hourlyWindGroup.toArray().filter(e=>!!e.isInvalid).length>0}get ddffConfig(){return{dd:this.config.elem_112.key_value,ff:this.config.elem_111.key_value}}onFormModified(e){this.monthModified=e}resetStation(){this.station=void 0,this.form.controls.station.reset()}onStationSelect(e){this.station=e,this.form.controls.station.setValue(e.station_id),this.loadHourlyWindData()}onSubmit(e){if(this.submitted=!0,this.form.invalid&&!this.f.hours.invalid)return;if(this.invalidEntries)return void(this.error="The hourly wind data contains some invalid entried, please fix the items and try again.");if(console.log(+this.f.total.value,this.calcTotal,+this.f.total.value===this.calcTotal),+this.f.total.value!==this.calcTotal)return void(this.error="The hours based data total does not match with the total provided, please check the values and try again.");const o=this.buildPayload();this.error="",this.hasRecord?this.update(o):this.save(o)}onDateSelection(e){e&&(this.date=new Date(e),this.renderFormHours(e),this.loadHourlyWindData())}getHoursValue(e){return g().set("hours",e).startOf("hour").format("HH:mm")}onReset(){this.form.reset(),this.initForm()}onCancel(){}onReturn(e){e.preventDefault()}onOpenCalendar(e){e.monthSelectHandler=o=>{e._store.dispatch(e._actions.select(o.date))}}getDateText(){return g(this.date).format("DD MMM YYYYY")}get calcTotal(){return this.hourlyWindGroup?this.hourlyWindGroup.toArray().reduce((e,o)=>(o.group.value.ff?+o.group.value.ff:0)+e,0):0}get hoursArray(){return this.form.get("hours")}get formHoursGroups(){return this.hoursArray.controls}handleReturn(e){e<this.hourlyWindGroup.toArray().length-1&&this.hourlyWindGroup.toArray()[+e+1].focusValue()}revertHour(e){console.log(e),this.modalService.show(q.S,{initialState:{title:"Confirm Revert",message:"Are you sure you want to revert to original values?",confirm:"Go Ahead",cancel:"Cancel"}}).content.onClose.subscribe(i=>{if(i)if(this.hasRecord){const s=(e<10?"0":"")+e;this.formHoursGroups[e]=this.getHourGroup({hour:e,ddff:0,dd:this.raw[`elem_111_${s}`],ff:this.raw[`elem_112_${s}`],flag:this.raw[`ddflag${s}`]||u.N})}else this.formHoursGroups[e]=this.getHourGroup({hour:e,ddff:0,dd:0,ff:0,flag:u.N})})}hourFocus(e){this.activeHour=e}hourBlur(e){}getHourGroup(e){const o=new l.cw({hour:new l.NI(null),ddff:new l.NI(null),dd:new l.NI(null),ff:new l.NI(null),flag:new l.NI(null)});return e&&o.patchValue(e),o}renderFormHours(e){this.resetHours();for(let o=0;o<this.hoursList.length;o++)this.hoursArray.push(this.getHourGroup({hour:o,ddff:0,dd:0,ff:0,flag:u.N}))}resetHours(){this.form.controls.hours=new l.Oe([])}initForm(){this.form=new l.cw({station:new l.NI(null,l.kI.required),date:new l.NI(new Date,l.kI.required),hours:new l.Oe([]),total:new l.NI(null)})}setFormState(e,o){this.monthYearValue=o,this.stationService.getStation(e).subscribe(r=>{var i;this.station=r.result[0],this.form.controls.station.setValue(null===(i=this.station)||void 0===i?void 0:i.station_id),this.renderFormHours(o),this.loadHourlyWindData()})}loadHourlyWindData(){if(console.log(this.monthYearValue),console.log(this.date),this.station&&this.date){const e=g(this.date),o=e.year(),r=e.month()+1,i=e.date();console.log(o,r,i),this.loading=!0,this.dataEntryService.getHourlyWindEntry(this.station.station_id,o,r,i).subscribe(s=>{console.log(s),this.hasRecord=s.result.length>0,s.result.length?(this.raw=s.result[0],this.patchForm(s.result[0]),this.focusFirst()):(this.renderFormHours(this.monthYearValue),this.f.total.setValue(0),this.focusFirst()),this.loading=!1})}}patchForm(e){let o=0;this.formHoursGroups.forEach((r,i)=>{const s=i<10?`0${i}`:i;r.patchValue(Object.assign({},{hour:i,ddff:`${e[`elem_111_${s}`]}${e[`elem_112_${s}`]}`,dd:e[`elem_111_${s}`],ff:e[`elem_112_${s}`],flag:e[`ddflag${s}`]||u.N})),o+=+e[`hh_${s}`]}),this.f.total.setValue(o||0)}save(e){console.log(e),e.mm=e.mm+1,this.dataEntryService.addHourlyWindEntry(e).subscribe(o=>{console.log(o),this.form.markAsPristine()})}update(e){console.log(e);const o=g(this.date),r=o.year(),i=o.month()+1,s=o.date();this.station&&this.date&&this.dataEntryService.updateHourlyWindEntry(this.station.station_id,r,i,s,e).subscribe(p=>{console.log(p),this.form.markAsPristine()})}buildPayload(){var e;const o=g(this.date),r={station_id:null===(e=this.station)||void 0===e?void 0:e.station_id,yyyy:o.year(),mm:o.month(),dd:o.date(),total:0,signature:"",entry_datetime:new Date},i=this.form.value;i.hours=this.formHoursGroups.map(p=>Object.assign(Object.assign({},p.value),{flag:p.value.flag||null}));for(let p of i.hours){const v=p.hour<10?`0${p.hour}`:`${p.hour}`;r[`elem_111_${v}`]=p.dd,r[`elem_112_${v}`]=p.ff,r[`ddflag${v}`]=p.flag||null}return Object.assign({},r)}focusFirst(){(0,O.of)(!0).pipe((0,h.g)(100)).subscribe(()=>{this.hourlyWindGroup.toArray()[0].focusValue()})}initConfig(){this.dataEntryService.elementLookup(554).pipe((0,C.U)(e=>e.result[0])).subscribe(e=>console.log(e)),this.dataEntryService.elementLookup(111).pipe((0,w.b)(e=>{const o=e.result[0];this.config.elem_111={element_id:o.element_id,element_name:o.element_name,element_scale:o.element_scale}}),(0,tt.w)(e=>this.dataEntryService.elementLookup(112))).subscribe(e=>{const o=e.result[0];this.config.elem_112={element_id:o.element_id,element_name:o.element_name,element_scale:o.element_scale},this.initKeys()})}initKeys(){this.dataEntryService.getRegKeys().pipe((0,C.U)(e=>e.result.filter(o=>["key05","key06"].includes(o.key_name)).map(o=>Object.assign(Object.assign({},o),{key_value:+o.key_value})))).subscribe(e=>{this.config.elem_111=Object.assign(Object.assign({},this.config.elem_111),e[1]),this.config.elem_112=Object.assign(Object.assign({},this.config.elem_112),e[0]),console.log(this.config)})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(Z.F0),t.Y36(x.tT),t.Y36(D.k),t.Y36(U),t.Y36(V.v))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-form-hourly-wind"]],viewQuery:function(e,o){if(1&e&&t.Gf(Ve,5),2&e){let r;t.iGM(r=t.CRH())&&(o.hourlyWindGroup=r)}},decls:4,vars:1,consts:[["novalidate","",3,"formGroup","ngSubmit","keydown.enter",4,"ngIf"],["novalidate","",3,"formGroup","ngSubmit","keydown.enter"],["sm","12",1,"text-end"],["sm","12","class","text-end",4,"ngIf"],["sm","12"],[1,"form-group","p-3","mt-4"],["xs","12","md","6","xl","3"],[1,"mb-2"],["cLabel","","for","station"],["id","station","type","hidden","formControlName","station","aria-label","default input","cFormControl","",3,"ngClass"],["class","typeahead-selection theme form-group",4,"ngIf"],[3,"onSelection",4,"ngIf"],["col","12","class","invalid-feedback",4,"ngIf"],["cLabel","","for","element"],[1,"mb-3"],["cInputGroupText","","id","basic-addon1"],["cIcon","","name","cilCalendar"],["id","element","type","hidden","formControlName","date","aria-label","default input","cFormControl","","placeholder","Station Name"],["name","monthYear","placeholder","Select Year & Month","cFormControl","","bsDatepicker","","autocomplete","off",3,"bsConfig","bsValue","ngClass","bsValueChange","onShown"],["sm","12","class","invalid-feedback",4,"ngIf"],[4,"ngIf"],["formArrayName","hours",4,"ngIf"],["class","mt-3",4,"ngIf"],["color","info","class","mt-4",4,"ngIf"],[1,"my-4"],["xs","12 py-4"],["type","submit","cButton","","color","dark",1,"px-3"],["aria-hidden","true","size","sm",4,"ngIf"],["type","button","cButton","","color","dark",1,"px-3","mx-1",3,"click"],["type","button","cButton","","color","dark",1,"px-3",3,"click"],[1,"typeahead-selection","theme","form-group"],[1,"typeahead-selection-inner"],[1,"btn",3,"click"],["cIcon","","name","cilX"],[3,"onSelection"],["col","12",1,"invalid-feedback"],["cIcon","","name","cilXCircle"],["sm","12",1,"invalid-feedback"],["md","12"],["color","danger"],["formArrayName","hours"],["sm","12","md","6","lg","4"],[1,"hourly-header"],["sm","2",1,"py-1"],["sm","4",1,"py-1"],["sm","12","md","6","lg","4",1,"d-none","d-md-block"],["sm","12","md","6","lg","4",1,"d-none","d-lg-block"],["md","12",4,"ngFor","ngForOf"],[3,"config","disabled","modified","group","onDirty","onReturn","onFocus","onBlur","onRevert"],["hourlyWindGroup",""],[1,"mt-3"],["sm","12","md","6","lg","4","xl","3"],["cLabel","","for","total"],["type","number","formControlName","total","aria-label","total","placeholder","Total","cFormControl","",1,"txt-total",3,"ngClass"],["color","info",1,"mt-4"],["aria-hidden","true","size","sm"]],template:function(e,o){1&e&&(t.TgZ(0,"h5"),t._uU(1," Hourly Wind data for selected date "),t.qZA(),t._UZ(2,"hr"),t.YNc(3,co,46,22,"form",0)),2&e&&(t.xp6(3),t.Q6J("ngIf",o.form))},directives:[_.O5,l._Y,l.JL,l.sg,c.iok,c.Yp0,P,c.eFW,l.Fj,c.oHf,l.JJ,l.u,_.mk,c.g8K,c.jOm,J.ar,k.Y5,k.Np,c.Hq3,j.$,Y.n,c.wxo,l.CE,_.sg,$e,l.wV,c.ORR],pipes:[_.OU],styles:[".hourly-header[_ngcontent-%COMP%]   c-col[_ngcontent-%COMP%]{text-align:center;font-size:.9rem;padding-left:.3rem}.hourly-header[_ngcontent-%COMP%]   c-col[_ngcontent-%COMP%]:first-child{padding-left:2%}.form-info[_ngcontent-%COMP%]{position:relative;padding:1rem .8rem .2rem 5rem;background-color:#d6ebff;border:1px solid #c2e0ff;border-radius:.25rem;color:#333}.form-info[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{position:absolute;top:1rem;left:.8rem;width:4rem}.form-info[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-size:1.1rem}.form-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;margin-top:.5rem}"]}),n})();const uo=["inputValue"];function mo(n,a){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Oqu(e.hourVal(e.fg.hour.value))}}function po(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"button",10),t.NdJ("click",function(){return t.CHM(e),t.oxw().revert()}),t._uU(1),t.qZA()}if(2&n){const e=t.oxw();t.xp6(1),t.Oqu(e.fg.hour.value)}}let fo=(()=>{class n{constructor(e){this.ref=e,this.modified=!1,this.group=new l.cw({hour:new l.NI(1),value:new l.NI(null,l.kI.required),flag:new l.NI(u.N)}),this.disabled=!1,this.onDirty=new t.vpe,this.onRevert=new t.vpe,this.onFocus=new t.vpe,this.onBlur=new t.vpe,this.onReturn=new t.vpe,this.valFocus=!1,this.hasFocus=!1}ngOnInit(){this.group.valueChanges.pipe((0,m.h)(e=>!this.modified)).subscribe(e=>{this.onDirty.emit(!0)})}ngAfterViewInit(){(0,Q.R)(this.ref.nativeElement,"keyup").pipe((0,m.h)(e=>13===e.keyCode&&this.valFocus)).subscribe(e=>{this.onValRetunKey()})}ngOnChanges(e){this.disabled?this.group.disable():this.group.enable()}get fg(){return this.group.controls}get isDirty(){return this.fg.value.dirty||this.fg.flag.dirty}get isInvalid(){const e=this.fg.value.value;return!(!e||/^\d+$/.test(e))||(this.limits&&e?e<this.limits.lower||e>this.limits.upper:this.fg.value.dirty&&""!==this.fg.value.value&&this.fg.flag.value===u.M)}get styles(){const e={"has-focus":this.hasFocus};return this.isDirty&&(e["is-dirty"]=!0),this.isInvalid&&(e["is-dirty"]=!1,e["is-invalid"]=!0),e}hourVal(e){return e?e&&e<10?`0${e}`:`${e}`:"00"}selectFlag(e){this.group.controls.flag.setValue(e)}focusValue(){this.txtVal.nativeElement.focus()}onValRetunKey(){(!this.fg.value.value||0==+this.fg.value.value)&&this.fg.flag.setValue(u.M),this.onReturn.emit(+this.fg.hour.value)}onValueFocus(){this.hasFocus=!0,this.onFocus.emit(this.fg.hour.value),this.valFocus=!0}onValueBlur(e){this.hasFocus=!1;const o=this.fg.value.value;this.pristine&&this.pristine.value===o&&""!==o&&this.fg.value.markAsPristine(),""===o&&this.fg.flag.value!==u.M&&this.selectFlag(u.M),""!==o&&this.fg.flag.value===u.M&&this.selectFlag(u.N),this.onBlur.emit(this.fg.hour.value),this.valFocus=!1}revert(){this.onRevert.emit(+this.fg.hour.value)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(t.SBq))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-hourly-form-group"]],viewQuery:function(e,o){if(1&e&&t.Gf(uo,5),2&e){let r;t.iGM(r=t.CRH())&&(o.txtVal=r.first)}},inputs:{modified:"modified",limits:"limits",group:"group",disabled:"disabled"},outputs:{onDirty:"onDirty",onRevert:"onRevert",onFocus:"onFocus",onBlur:"onBlur",onReturn:"onReturn"},features:[t.TTD],decls:10,vars:6,consts:[[1,"hourly-data-row",3,"ngClass","formGroup"],[1,"py-2","label"],[4,"ngIf"],["type","button","cButton","","color","dark","shape","rounded-pill",3,"click",4,"ngIf"],[1,"py-1"],["formControlName","value","aria-label","value","cFormControl","",3,"focus","blur"],["inputValue",""],[1,"py-1","text-center"],["type","hidden","formControlName","flag","aria-label","flag","cFormControl",""],[3,"flag","disabled","onSelect"],["type","button","cButton","","color","dark","shape","rounded-pill",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"c-row",0),t.TgZ(1,"c-col",1),t.YNc(2,mo,2,1,"span",2),t.YNc(3,po,2,1,"button",3),t.qZA(),t.TgZ(4,"c-col",4),t.TgZ(5,"input",5,6),t.NdJ("focus",function(){return o.onValueFocus()})("blur",function(i){return o.onValueBlur(i)}),t.qZA(),t.qZA(),t.TgZ(7,"c-col",7),t._UZ(8,"input",8),t.TgZ(9,"app-flag-picker",9),t.NdJ("onSelect",function(i){return o.selectFlag(i)}),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.Q6J("ngClass",o.styles)("formGroup",o.group),t.xp6(2),t.Q6J("ngIf",!o.isDirty),t.xp6(1),t.Q6J("ngIf",o.isDirty),t.xp6(6),t.Q6J("flag",o.fg.flag.value)("disabled",o.disabled))},directives:[c.iok,_.mk,l.JL,l.sg,c.Yp0,_.O5,l.Fj,c.oHf,l.JJ,l.u,L,c.Hq3],styles:[".hourly-data-row[_ngcontent-%COMP%]{padding:.1rem .3rem;margin:.2rem 0;background-color:#e5ecf2;border:1px solid #cdd4da;border-radius:.2rem}.hourly-data-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{text-align:center}.hourly-data-row[_ngcontent-%COMP%]   c-col[_ngcontent-%COMP%]{padding:0 .2rem}.hourly-data-row.has-error[_ngcontent-%COMP%]{background-color:#ffe2e2;border:1px solid #dd6868}.hourly-data-row.is-invalid[_ngcontent-%COMP%]{background-color:#ffe2e2;border:1px solid #dd6868}.hourly-data-row.is-dirty[_ngcontent-%COMP%]{background-color:#a3e8fd;border:1px solid #8cc9db}.hourly-data-row.has-focus[_ngcontent-%COMP%]{background-color:#e2e7ec;border:1px solid #9dacb9;box-shadow:#00000040 1px 1px 0 1px}.hourly-data-row[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:disabled{cursor:not-allowed}.hourly-data-row[_ngcontent-%COMP%]   .btn.rounded-pill[_ngcontent-%COMP%]{padding:.1rem .4rem;font-size:.9rem}"]}),n})();const go=["hourlyGroup"];function ho(n,a){1&n&&(t.TgZ(0,"c-col",2),t._UZ(1,"app-infinite-loading"),t.qZA())}function yo(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",32),t.TgZ(1,"div",33),t.TgZ(2,"span"),t._uU(3),t.qZA(),t.TgZ(4,"a",34),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).resetStation()}),t.O4$(),t._UZ(5,"svg",35),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(3),t.Oqu(e.station.station_name)}}function vo(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"app-station-selection",36),t.NdJ("onSelection",function(r){return t.CHM(e),t.oxw(2).onStationSelect(r)}),t.qZA()}}function Co(n,a){1&n&&(t.TgZ(0,"div"),t.O4$(),t._UZ(1,"svg",38),t._uU(2," Station selection required."),t.qZA())}function Zo(n,a){if(1&n&&(t.TgZ(0,"div",37),t.YNc(1,Co,3,0,"div",22),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.f.station.errors.required)}}function bo(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",32),t.TgZ(1,"div",33),t.TgZ(2,"span"),t._uU(3),t.qZA(),t.TgZ(4,"a",34),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).resetElement()}),t.O4$(),t._UZ(5,"svg",35),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(3),t.Oqu(e.element.element_name)}}function xo(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"app-element-selection",36),t.NdJ("onSelection",function(r){return t.CHM(e),t.oxw(2).onElementSelect(r)}),t.qZA()}}function To(n,a){1&n&&(t.TgZ(0,"div"),t.O4$(),t._UZ(1,"svg",38),t._uU(2," Element selection is required."),t.qZA())}function wo(n,a){if(1&n&&(t.TgZ(0,"div",37),t.YNc(1,To,3,0,"div",22),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.f.element.errors.required)}}function Fo(n,a){1&n&&(t.TgZ(0,"div",39),t.O4$(),t._UZ(1,"svg",38),t._uU(2," Year and Month is required "),t.qZA())}function Ao(n,a){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.hij("for ",e.dateText,"")}}function Mo(n,a){if(1&n&&(t.TgZ(0,"p"),t._uU(1," Values must be between "),t.TgZ(2,"strong"),t._uU(3),t.ALo(4,"number"),t.qZA(),t._uU(5," and "),t.TgZ(6,"strong"),t._uU(7),t.ALo(8,"number"),t.qZA(),t.qZA()),2&n){const e=t.oxw(3);t.xp6(3),t.hij(" ",t.lcZ(4,2,e.element.lower_limit)," "),t.xp6(4),t.hij("",t.lcZ(8,4,e.element.upper_limit)," ")}}function qo(n,a){1&n&&t._UZ(0,"p")}function So(n,a){if(1&n&&(t.TgZ(0,"c-row"),t.TgZ(1,"c-col",40),t.TgZ(2,"div",41),t._UZ(3,"img",42),t.TgZ(4,"h5"),t._uU(5,"Please use the following information for data entry"),t.qZA(),t.YNc(6,Mo,9,6,"p",22),t.YNc(7,qo,1,0,"p",22),t.qZA(),t.qZA(),t.qZA()),2&n){const e=t.oxw(2);t.xp6(6),t.Q6J("ngIf",e.element.lower_limit&&e.element.upper_limit),t.xp6(1),t.Q6J("ngIf",!e.element.lower_limit||!e.element.upper_limit)}}function Oo(n,a){if(1&n&&(t.TgZ(0,"c-row"),t.TgZ(1,"c-col",43),t.TgZ(2,"c-alert",44),t.TgZ(3,"strong"),t._uU(4,"Error(s) Found!"),t.qZA(),t._uU(5),t.qZA(),t.qZA(),t.qZA()),2&n){const e=t.oxw(2);t.xp6(5),t.hij(" ",e.error,"")}}function Do(n,a){1&n&&(t.TgZ(0,"c-row",45),t.TgZ(1,"c-col",46),t.TgZ(2,"c-row",47),t.TgZ(3,"c-col",48),t._uU(4,"Hour"),t.qZA(),t.TgZ(5,"c-col",48),t._uU(6,"Value"),t.qZA(),t.TgZ(7,"c-col",48),t._uU(8,"Flag"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(9,"c-col",49),t.TgZ(10,"c-row",47),t.TgZ(11,"c-col",48),t._uU(12,"Hour"),t.qZA(),t.TgZ(13,"c-col",48),t._uU(14,"Value"),t.qZA(),t.TgZ(15,"c-col",48),t._uU(16,"Flag"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(17,"c-col",50),t.TgZ(18,"c-row",47),t.TgZ(19,"c-col",48),t._uU(20,"Hour"),t.qZA(),t.TgZ(21,"c-col",48),t._uU(22,"Value"),t.qZA(),t.TgZ(23,"c-col",48),t._uU(24,"Flag"),t.qZA(),t.qZA(),t.qZA(),t.qZA())}function Ho(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"c-col",43),t.TgZ(1,"app-hourly-form-group",52,53),t.NdJ("onReturn",function(r){return t.CHM(e),t.oxw(3).handleReturn(r)})("onFocus",function(r){return t.CHM(e),t.oxw(3).hourFocus(r)})("onBlur",function(r){return t.CHM(e),t.oxw(3).hourBlur(r)})("onDirty",function(r){return t.CHM(e),t.oxw(3).onFormModified(r)})("onRevert",function(r){return t.CHM(e),t.oxw(3).revertDay(r)}),t.qZA(),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw(3);t.xp6(1),t.Q6J("disabled",!o.isEditable)("modified",o.isModified)("limits",o.limits)("group",e)}}function ko(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"c-col",43),t.TgZ(1,"app-hourly-form-group",52,53),t.NdJ("onReturn",function(r){return t.CHM(e),t.oxw(3).handleReturn(r)})("onFocus",function(r){return t.CHM(e),t.oxw(3).hourFocus(r)})("onBlur",function(r){return t.CHM(e),t.oxw(3).hourBlur(r)})("onDirty",function(r){return t.CHM(e),t.oxw(3).onFormModified(r)})("onRevert",function(r){return t.CHM(e),t.oxw(3).revertDay(r)}),t.qZA(),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw(3);t.xp6(1),t.Q6J("disabled",!o.isEditable)("modified",o.isModified)("limits",o.limits)("group",e)}}function Io(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"c-col",43),t.TgZ(1,"app-hourly-form-group",52,53),t.NdJ("onReturn",function(r){return t.CHM(e),t.oxw(3).handleReturn(r)})("onFocus",function(r){return t.CHM(e),t.oxw(3).hourFocus(r)})("onBlur",function(r){return t.CHM(e),t.oxw(3).hourBlur(r)})("onDirty",function(r){return t.CHM(e),t.oxw(3).onFormModified(r)})("onRevert",function(r){return t.CHM(e),t.oxw(3).revertDay(r)}),t.qZA(),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw(3);t.xp6(1),t.Q6J("disabled",!o.isEditable)("modified",o.isModified)("limits",o.limits)("group",e)}}function Eo(n,a){if(1&n&&(t.TgZ(0,"c-row",45),t.TgZ(1,"c-col",46),t.TgZ(2,"c-row"),t.YNc(3,Ho,3,4,"c-col",51),t.ALo(4,"slice"),t.qZA(),t.qZA(),t.TgZ(5,"c-col",46),t.TgZ(6,"c-row"),t.YNc(7,ko,3,4,"c-col",51),t.ALo(8,"slice"),t.qZA(),t.qZA(),t.TgZ(9,"c-col",46),t.TgZ(10,"c-row"),t.YNc(11,Io,3,4,"c-col",51),t.ALo(12,"slice"),t.qZA(),t.qZA(),t.qZA()),2&n){const e=t.oxw(2);t.xp6(3),t.Q6J("ngForOf",t.Dn7(4,3,e.formHoursGroups,0,8)),t.xp6(4),t.Q6J("ngForOf",t.Dn7(8,7,e.formHoursGroups,8,16)),t.xp6(4),t.Q6J("ngForOf",t.Dn7(12,11,e.formHoursGroups,16,24))}}const No=function(n,a){return{"is-valid":n,"is-invalid":a}};function Ro(n,a){if(1&n&&(t.TgZ(0,"c-row",54),t.TgZ(1,"c-col",46),t.TgZ(2,"div",7),t.TgZ(3,"label",55),t._uU(4,"Total"),t.qZA(),t._UZ(5,"input",56),t.qZA(),t.qZA(),t.qZA()),2&n){const e=t.oxw(2);t.xp6(5),t.Q6J("ngClass",t.WLB(1,No,e.f.total.value===e.calcTotal,e.f.total.value!==e.calcTotal))}}function Uo(n,a){1&n&&(t.TgZ(0,"c-alert",57),t._uU(1,"Please select a date to view form."),t.qZA())}function Po(n,a){1&n&&t._UZ(0,"c-spinner",58)}const mt=function(n){return{"is-invalid":n}};function Jo(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"form",1),t.NdJ("ngSubmit",function(r){return t.CHM(e),t.oxw().onSubmit(r)})("keydown.enter",function(r){return t.CHM(e),t.oxw().onReturn(r)}),t.TgZ(1,"c-row"),t.TgZ(2,"c-col",2),t._UZ(3,"app-flag-legend"),t.qZA(),t.YNc(4,ho,2,0,"c-col",3),t.TgZ(5,"c-col",4),t.TgZ(6,"fieldset",5),t.TgZ(7,"legend"),t._uU(8,"Form Selector"),t.qZA(),t.TgZ(9,"c-row"),t.TgZ(10,"c-col",6),t.TgZ(11,"div",7),t.TgZ(12,"label",8),t._uU(13,"Station"),t.qZA(),t._UZ(14,"input",9),t.YNc(15,yo,6,1,"div",10),t.YNc(16,vo,1,0,"app-station-selection",11),t.YNc(17,Zo,2,1,"div",12),t.qZA(),t.qZA(),t.TgZ(18,"c-col",6),t.TgZ(19,"div",7),t.TgZ(20,"label",13),t._uU(21,"Element"),t.qZA(),t._UZ(22,"input",14),t.YNc(23,bo,6,1,"div",10),t.YNc(24,xo,1,0,"app-element-selection",11),t.YNc(25,wo,2,1,"div",12),t.qZA(),t.qZA(),t.TgZ(26,"c-col",6),t.TgZ(27,"label",13),t._uU(28,"Day/Month/Year"),t.qZA(),t.TgZ(29,"c-input-group",15),t.TgZ(30,"span",16),t.O4$(),t._UZ(31,"svg",17),t.qZA(),t.kcU(),t._UZ(32,"input",18),t.TgZ(33,"input",19),t.NdJ("bsValueChange",function(r){return t.CHM(e),t.oxw().onDateSelection(r)})("onShown",function(r){return t.CHM(e),t.oxw().onOpenCalendar(r)}),t.qZA(),t.YNc(34,Fo,3,0,"div",20),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(35,"fieldset",21),t.TgZ(36,"legend"),t._uU(37,"Hourly Data "),t.YNc(38,Ao,2,1,"span",22),t.qZA(),t.YNc(39,So,8,2,"c-row",22),t.YNc(40,Oo,6,1,"c-row",22),t.YNc(41,Do,25,0,"c-row",23),t.YNc(42,Eo,13,15,"c-row",23),t.YNc(43,Ro,6,4,"c-row",24),t.YNc(44,Uo,2,0,"c-alert",25),t.qZA(),t._UZ(45,"hr",26),t.TgZ(46,"c-row"),t.TgZ(47,"c-col",27),t.TgZ(48,"button",28),t.YNc(49,Po,1,0,"c-spinner",29),t._uU(50),t.qZA(),t.TgZ(51,"button",30),t.NdJ("click",function(){return t.CHM(e),t.oxw().onReset()}),t._uU(52," Reset "),t.qZA(),t.TgZ(53,"button",31),t.NdJ("click",function(){return t.CHM(e),t.oxw().onCancel()}),t._uU(54," Cancel "),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=t.oxw();t.Q6J("formGroup",e.form),t.xp6(4),t.Q6J("ngIf",e.loading),t.xp6(10),t.Q6J("ngClass",t.VKq(23,mt,(e.submitted||e.f.station.touched)&&e.f.station.invalid)),t.xp6(1),t.Q6J("ngIf",e.station),t.xp6(1),t.Q6J("ngIf",!e.station),t.xp6(1),t.Q6J("ngIf",e.f.station.errors),t.xp6(5),t.Q6J("ngClass",t.VKq(25,mt,(e.submitted||e.f.element.touched)&&e.f.element.invalid)),t.xp6(1),t.Q6J("ngIf",e.element),t.xp6(1),t.Q6J("ngIf",!e.element),t.xp6(1),t.Q6J("ngIf",e.f.element.errors),t.xp6(8),t.Q6J("bsConfig",e.bsConfig)("bsValue",e.monthYearValue)("ngClass",t.VKq(27,mt,e.submitted&&e.f.date.invalid)),t.xp6(1),t.Q6J("ngIf",e.submitted&&e.f.date.invalid),t.xp6(4),t.Q6J("ngIf",e.date),t.xp6(1),t.Q6J("ngIf",e.element&&e.formHoursGroups.length),t.xp6(1),t.Q6J("ngIf",e.error),t.xp6(1),t.Q6J("ngIf",e.formHoursGroups.length),t.xp6(1),t.Q6J("ngIf",e.formHoursGroups.length),t.xp6(1),t.Q6J("ngIf",e.formHoursGroups.length),t.xp6(1),t.Q6J("ngIf",!e.formHoursGroups.length),t.xp6(5),t.Q6J("ngIf",e.loading),t.xp6(1),t.hij(" ",e.hasRecord?"Update":"Save"," ")}}let Yo=(()=>{class n{constructor(e,o,r,i,s,p){this.router=e,this.modalService=o,this.responsiveSvc=r,this.dataEntryService=i,this.stationService=s,this.elementService=p,this.submitted=!1,this.loading=!1,this.error="",this.monthModified=!1,this.monthYearValue=new Date,this.bsConfig={isAnimated:!0,containerClass:"theme-blue",dateInputFormat:"DD/MM/YYYY"},this.hasRecord=!1,this.activeHour=0,this.hoursList=[24,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]}ngOnInit(){this.initForm(),this.responsiveSvc.screenSize.subscribe(e=>{console.log(e)}),this.dataEntryService.hourlyState.pipe((0,w.b)(e=>this.loading=!!e),(0,m.h)(e=>!!e),(0,M.q)(1)).subscribe(e=>{this.setFormState(+e.station,+e.element,g(e.date).toDate())})}get f(){return this.form.controls}get isEditable(){return!!this.station&&!!this.element}get isModified(){return this.monthModified}get hasChanges(){return this.hourlyGroup.toArray().filter(e=>!0===e.isDirty).length>0}get invalidEntries(){return this.hourlyGroup.toArray().filter(e=>!!e.isInvalid).length>0}onFormModified(e){this.monthModified=e}resetStation(){this.station=void 0,this.form.controls.station.reset()}onStationSelect(e){this.station=e,this.form.controls.station.setValue(e.station_id),this.loadHourlyData()}resetElement(){this.element=void 0,this.form.controls.element.reset(),this.limits=null}onElementSelect(e){this.element=e,this.form.controls.element.setValue(e.element_id),this.limits=e.lower_limit&&e.upper_limit?{lower:+e.lower_limit,upper:+e.upper_limit}:null,this.loadHourlyData()}onDateSelection(e){e&&(this.date=e,this.date=new Date(e),this.loadHourlyData())}getHoursValue(e){return g().set("hours",e).startOf("hour").format("HH:mm")}onOpenCalendar(e){e.monthSelectHandler=o=>{e._store.dispatch(e._actions.select(o.date))}}onSubmit(e){if(this.submitted=!0,this.form.invalid&&!this.f.hours.invalid)return;if(this.invalidEntries)return void(this.error="The monthly data contains some invalid entried, please fix the items and try again.");if(console.log(+this.f.total.value,this.calcTotal,+this.f.total.value===this.calcTotal),+this.f.total.value!==this.calcTotal)return void(this.error="The days based data total does not match with the total provided, please check the values and try again.");const o=this.buildPayload();this.error="",this.hasRecord?this.update(o):this.save(o)}onReset(){this.form.reset(),this.initForm()}onCancel(){}onReturn(e){e.preventDefault()}get dateText(){return g(this.date).format("DD MMM YYYYY")}get calcTotal(){return this.hourlyGroup?this.hourlyGroup.toArray().reduce((e,o)=>(o.group.value.value?+o.group.value.value:0)+e,0):0}get hoursArray(){return this.form.get("hours")}get formHoursGroups(){return this.hoursArray.controls}getHourGroup(e){const o=new l.cw({hour:new l.NI(null),value:new l.NI(null,[l.kI.min(0),l.kI.max(70)]),flag:new l.NI(u.N)});return e&&o.patchValue(e),o}renderFormHours(){this.resetHours();for(let e=0;e<this.hoursList.length;e++)this.hoursArray.push(this.getHourGroup({hour:e,value:"",flag:u.N}))}hourFocus(e){this.activeHour=e}hourBlur(e){}handleReturn(e){e<this.hourlyGroup.toArray().length-1&&this.hourlyGroup.toArray()[+e+1].focusValue()}revertDay(e){this.modalService.show(q.S,{initialState:{title:"Confirm Revert",message:"Are you sure you want to revert to original values?",confirm:"Go Ahead",cancel:"Cancel"}}).content.onClose.subscribe(i=>{if(i)if(this.hasRecord){this.formHoursGroups[e]=this.getHourGroup({hour:e,value:+this.raw[`hh_${(e<10?"0":"")+e}`],flag:u.N})}else this.formHoursGroups[e]=this.getHourGroup({hour:e,value:"",flag:u.N})})}resetHours(){this.form.controls.hours=new l.Oe([])}initForm(){this.form=new l.cw({station:new l.NI(null,l.kI.required),element:new l.NI(null,l.kI.required),date:new l.NI(new Date,l.kI.required),hours:new l.Oe([]),total:new l.NI(null)})}setFormState(e,o,r){this.monthYearValue=g(r).toDate(),this.stationService.getStation(e).pipe((0,w.b)(i=>{var s;this.station=i.result[0],this.form.controls.station.setValue(null===(s=this.station)||void 0===s?void 0:s.station_id)}),(0,tt.w)(i=>this.elementService.getElement(o))).subscribe(i=>{var s;this.element=i.result[0],this.form.controls.element.setValue(null===(s=this.element)||void 0===s?void 0:s.element_id),this.renderFormHours(),this.loadHourlyData()})}loadHourlyData(){if(console.log(this.monthYearValue),console.log(this.date),this.station&&this.element&&this.date){const e=g(this.date),o=e.year(),r=e.month()+1,i=e.date();console.log(o,r,i),this.loading=!0,this.dataEntryService.getHourlyEntry(this.station.station_id,this.element.element_id,o,r,i).subscribe(s=>{console.log(s),this.hasRecord=s.result.length>0,s.result.length?(this.raw=s.result[0],this.patchForm(s.result[0]),this.focusFirst()):(this.renderFormHours(),this.f.total.setValue(0),this.focusFirst()),this.loading=!1})}}patchForm(e){let o=0;this.formHoursGroups.forEach((r,i)=>{const s=i<10?`0${i}`:i;r.patchValue(Object.assign({},{hour:i,value:e[`hh_${s}`],flag:e[`flag${s}`]||u.N})),o+=+e[`hh_${s}`]}),this.f.total.setValue(o||0)}save(e){console.log(e),e.mm=e.mm+1,this.dataEntryService.addHourlyEntry(e).subscribe(o=>{console.log(o),this.form.markAsPristine()})}update(e){console.log(e);const o=g(this.date),r=o.year(),i=o.month()+1,s=o.date();console.log(r,i,s),this.station&&this.element&&this.date&&this.dataEntryService.updateHourlyEntry(this.station.station_id,this.element.element_id,r,i,s,e).subscribe(p=>{console.log(p),this.form.markAsPristine()})}buildPayload(){var e,o;const r=g(this.date),i={station_id:null===(e=this.station)||void 0===e?void 0:e.station_id,element_id:null===(o=this.element)||void 0===o?void 0:o.element_id,yyyy:r.year(),mm:r.month(),dd:r.date(),total:0,signature:"",entry_datetime:new Date},s=this.form.value;s.hours=this.formHoursGroups.map(p=>Object.assign(Object.assign({},p.value),{flag:p.value.flag||null}));for(let p of s.hours){const v=p.hour<10?`0${p.hour}`:`${p.hour}`;i[`hh_${v}`]=p.value,i[`flag${v}`]=p.flag||null}return i}focusFirst(){(0,O.of)(!0).pipe((0,h.g)(100)).subscribe(()=>{this.hourlyGroup.toArray()[0].focusValue()})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(Z.F0),t.Y36(x.tT),t.Y36(D.k),t.Y36(U),t.Y36(V.v),t.Y36(_t.d))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-form-hourly"]],viewQuery:function(e,o){if(1&e&&t.Gf(go,5),2&e){let r;t.iGM(r=t.CRH())&&(o.hourlyGroup=r)}},decls:4,vars:1,consts:[["novalidate","",3,"formGroup","ngSubmit","keydown.enter",4,"ngIf"],["novalidate","",3,"formGroup","ngSubmit","keydown.enter"],["sm","12",1,"text-end"],["sm","12","class","text-end",4,"ngIf"],["sm","12"],[1,"form-group","p-3","mt-4"],["xs","12","md","6","xl","3"],[1,"mb-2"],["cLabel","","for","station"],["id","station","type","hidden","formControlName","station","aria-label","default input","cFormControl","",3,"ngClass"],["class","typeahead-selection theme form-group",4,"ngIf"],[3,"onSelection",4,"ngIf"],["col","12","class","invalid-feedback",4,"ngIf"],["cLabel","","for","element"],["id","element","type","hidden","formControlName","element","aria-label","default input","cFormControl","",3,"ngClass"],[1,"mb-3"],["cInputGroupText","","id","basic-addon1"],["cIcon","","name","cilCalendar"],["id","element","type","hidden","formControlName","date","aria-label","default input","cFormControl","","placeholder","Station Name"],["name","monthYear","placeholder","Select Year & Month","cFormControl","","bsDatepicker","","autocomplete","off",3,"bsConfig","bsValue","ngClass","bsValueChange","onShown"],["sm","12","class","invalid-feedback",4,"ngIf"],[1,"form-group","p-3","mt-2"],[4,"ngIf"],["formArrayName","hours",4,"ngIf"],["class","mt-3",4,"ngIf"],["color","info","class","mt-4",4,"ngIf"],[1,"my-4"],["xs","12 py-4"],["type","submit","cButton","","color","dark",1,"px-3"],["aria-hidden","true","size","sm",4,"ngIf"],["type","button","cButton","","color","dark",1,"px-3","mx-1",3,"click"],["type","button","cButton","","color","dark",1,"px-3",3,"click"],[1,"typeahead-selection","theme","form-group"],[1,"typeahead-selection-inner"],[1,"btn",3,"click"],["cIcon","","name","cilX"],[3,"onSelection"],["col","12",1,"invalid-feedback"],["cIcon","","name","cilXCircle"],["sm","12",1,"invalid-feedback"],["md","12 mt-3 mb-3"],[1,"form-info"],["src","./assets/img/icons/info.png","alt",""],["md","12"],["color","danger"],["formArrayName","hours"],["sm","12","md","6","lg","4","xl","3"],[1,"hourly-header"],[1,"py-1"],["sm","12","md","6","lg","4","xl","3",1,"d-none","d-md-block"],["sm","12","md","6","lg","4","xl","3",1,"d-none","d-lg-block"],["md","12",4,"ngFor","ngForOf"],[3,"disabled","modified","limits","group","onReturn","onFocus","onBlur","onDirty","onRevert"],["hourlyGroup",""],[1,"mt-3"],["cLabel","","for","total"],["type","number","formControlName","total","aria-label","total","placeholder","Total","cFormControl","",1,"txt-total",3,"ngClass"],["color","info",1,"mt-4"],["aria-hidden","true","size","sm"]],template:function(e,o){1&e&&(t.TgZ(0,"h5"),t._uU(1," Hourly data for selected date "),t.qZA(),t._UZ(2,"hr"),t.YNc(3,Jo,55,29,"form",0)),2&e&&(t.xp6(3),t.Q6J("ngIf",o.form))},directives:[_.O5,l._Y,l.JL,l.sg,c.iok,c.Yp0,P,c.eFW,l.Fj,c.oHf,l.JJ,l.u,_.mk,c.g8K,c.jOm,J.ar,k.Y5,k.Np,c.Hq3,j.$,Y.n,ut.Y,c.wxo,l.CE,_.sg,fo,l.wV,c.ORR],pipes:[_.JJ,_.OU],styles:[".hourly-header[_ngcontent-%COMP%]   c-col[_ngcontent-%COMP%]{text-align:center;font-size:.9rem;padding-left:.3rem}.hourly-header[_ngcontent-%COMP%]   c-col[_ngcontent-%COMP%]:first-child{padding-left:2%}.form-info[_ngcontent-%COMP%]{position:relative;padding:1rem .8rem .2rem 5rem;background-color:#d6ebff;border:1px solid #c2e0ff;border-radius:.25rem;color:#333;box-shadow:0 3px 10px #0003}.form-info[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{position:absolute;top:1rem;left:.8rem;width:4rem}.form-info[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-size:1.1rem}.form-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;margin-top:.5rem}.txt-total[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:bold}.txt-total.is-valid[_ngcontent-%COMP%]{background-color:#d3eebc;color:#0c971e}.txt-total.is-invalid[_ngcontent-%COMP%]{background-color:#f0cdcd;color:#ff2f2f}"]}),n})();var z=(()=>{return(n=z||(z={})).Celsius="Degree Celcius",n.DegreeF="Degree Fahrenheit",z;var n})(),B=(()=>{return(n=B||(B={})).mm="Millimeters",n.cm="Centimeters",n.in="Inches",B;var n})(),W=(()=>{return(n=W||(W={})).Foot="Feet",n.Metre="Metre",n.Kilometres="Kilometres",W;var n})(),K=(()=>{return(n=K||(K={})).Metres="Metres",n.Kilometres="Kilometres",n.StatuteMiles="Statute Miles",K;var n})();const Lo={temperature:[{key:"DEGREE CELSIUS",value:z.Celsius,symbol:"\xb0C"},{key:"DEGREE FAHRENHEIT",value:z.DegreeF,symbol:"\xb0F"}],precipitation:[{key:"MILIMETER",value:B.mm,symbol:"mm"},{key:"CENTIMETER",value:B.cm,symbol:"mm"},{key:"INCHE",value:B.in,symbol:"in"}],cloudHeight:[{key:"FEET",value:W.Foot,symbol:"ft"},{key:"METRE",value:W.Metre,symbol:"M"},{key:"KILOMETERS",value:W.Kilometres,symbol:"M"}],visibility:[{key:"METRES",value:K.Metres,symbol:"M"},{key:"KILOMETRES",value:K.Kilometres,symbol:"Km"},{key:"STATUTE MILES",value:K.StatuteMiles,symbol:"M"}]},Bo=["inputValue"];function Wo(n,a){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Oqu(e.fg.day.value)}}function Ko(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"button",11),t.NdJ("click",function(){return t.CHM(e),t.oxw().revert()}),t._uU(1),t.qZA()}if(2&n){const e=t.oxw();t.xp6(1),t.Oqu(e.fg.day.value)}}let jo=(()=>{class n{constructor(e){this.ref=e,this.modified=!1,this.group=new l.cw({day:new l.NI(1),value:new l.NI(null,l.kI.required),flag:new l.NI(null),period:new l.NI(null)}),this.disabled=!1,this.onDirty=new t.vpe,this.onRevert=new t.vpe,this.onFocus=new t.vpe,this.onBlur=new t.vpe,this.onReturn=new t.vpe,this.valFocus=!1,this.hasFocus=!1}ngOnInit(){this.group.valueChanges.pipe((0,m.h)(e=>!this.modified)).subscribe(e=>{this.onDirty.emit(!0)})}ngOnChanges(e){this.disabled?this.group.disable():this.group.enable()}ngAfterViewInit(){(0,O.of)(!0).pipe((0,h.g)(500)).subscribe(()=>{this.pristine=this.group.value}),(0,Q.R)(this.ref.nativeElement,"keyup").pipe((0,m.h)(e=>13===e.keyCode&&this.valFocus)).subscribe(e=>{this.onValRetunKey()})}selectFlag(e){this.fg.flag.value!==e&&(this.fg.flag.setValue(e),this.fg.flag.markAsDirty())}focusValue(){this.txtVal.nativeElement.focus()}onValRetunKey(){this.fg.value.value&&0!=+this.fg.value.value?(console.log("111111"),this.fg.flag.setValue(u.N)):this.fg.flag.setValue(u.M),this.onReturn.emit(+this.fg.day.value)}onValueFocus(){this.hasFocus=!0,this.onFocus.emit(this.fg.day.value),this.valFocus=!0}onValueBlur(e){this.hasFocus=!1;const o=this.fg.value.value;this.pristine.value===o&&""!==o&&this.fg.value.markAsPristine(),(null===o||""===o)&&this.fg.flag.value!==u.M&&this.selectFlag(u.M),this.onBlur.emit(this.fg.day.value),this.valFocus=!1}get fg(){return this.group.controls}get isDirty(){return this.fg.value.dirty||this.fg.flag.dirty||this.fg.period.dirty}get isInvalid(){const e=this.fg.value.value;return!(!e||/^\d+$/.test(e))||(this.limits&&e?e<this.limits.lower||e>this.limits.upper:this.fg.value.dirty&&""!==this.fg.value.value&&this.fg.flag.value===u.M)}get styles(){const e={"has-focus":this.hasFocus};return this.isDirty&&(e["is-dirty"]=!0),this.isInvalid&&(e["is-dirty"]=!1,e["is-invalid"]=!0),e}revert(){this.onRevert.emit(+this.fg.day.value)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(t.SBq))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-daily-day-form-group"]],viewQuery:function(e,o){if(1&e&&t.Gf(Bo,5),2&e){let r;t.iGM(r=t.CRH())&&(o.txtVal=r.first)}},inputs:{limits:"limits",modified:"modified",group:"group",disabled:"disabled"},outputs:{onDirty:"onDirty",onRevert:"onRevert",onFocus:"onFocus",onBlur:"onBlur",onReturn:"onReturn"},features:[t.TTD],decls:12,vars:6,consts:[[1,"daily-data-row",3,"ngClass","formGroup"],[1,"py-2","label"],[4,"ngIf"],["type","button","cButton","","color","dark","shape","rounded-pill",3,"click",4,"ngIf"],[1,"py-1"],["formControlName","value","aria-label","value","cFormControl","",3,"focus","blur"],["inputValue",""],[1,"py-1","text-center"],["type","hidden","formControlName","flag","aria-label","flag","cFormControl",""],[3,"flag","disabled","onSelect"],["formControlName","period","aria-label","period","cFormControl",""],["type","button","cButton","","color","dark","shape","rounded-pill",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"c-row",0),t.TgZ(1,"c-col",1),t.YNc(2,Wo,2,1,"span",2),t.YNc(3,Ko,2,1,"button",3),t.qZA(),t.TgZ(4,"c-col",4),t.TgZ(5,"input",5,6),t.NdJ("focus",function(){return o.onValueFocus()})("blur",function(i){return o.onValueBlur(i)}),t.qZA(),t.qZA(),t.TgZ(7,"c-col",7),t._UZ(8,"input",8),t.TgZ(9,"app-flag-picker",9),t.NdJ("onSelect",function(i){return o.selectFlag(i)}),t.qZA(),t.qZA(),t.TgZ(10,"c-col",4),t._UZ(11,"input",10),t.qZA(),t.qZA()),2&e&&(t.Q6J("ngClass",o.styles)("formGroup",o.group),t.xp6(2),t.Q6J("ngIf",!o.isDirty),t.xp6(1),t.Q6J("ngIf",o.isDirty),t.xp6(6),t.Q6J("flag",o.fg.flag.value)("disabled",o.disabled))},directives:[c.iok,_.mk,l.JL,l.sg,c.Yp0,_.O5,l.Fj,c.oHf,l.JJ,l.u,L,c.Hq3],styles:[".daily-data-row[_ngcontent-%COMP%]{padding:.1rem .3rem;margin:.2rem 0;background-color:#e5ecf2;border:1px solid #cdd4da;border-radius:.2rem}.daily-data-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{text-align:center}.daily-data-row[_ngcontent-%COMP%]   c-col[_ngcontent-%COMP%]{padding:0 .2rem}.daily-data-row.is-invalid[_ngcontent-%COMP%]{background-color:#ffe2e2;border:1px solid #dd6868}.daily-data-row.is-dirty[_ngcontent-%COMP%]{background-color:#a3e8fd;border:1px solid #8cc9db}.daily-data-row.has-focus[_ngcontent-%COMP%]{background-color:#e2e7ec;border:1px solid #9dacb9;box-shadow:#00000040 1px 1px 0 1px}.daily-data-row[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:disabled{cursor:not-allowed}.daily-data-row[_ngcontent-%COMP%]   .btn.rounded-pill[_ngcontent-%COMP%]{padding:.1rem .4rem;font-size:.9rem}"]}),n})();const zo=["dailyGroup"];function Xo(n,a){1&n&&(t.TgZ(0,"c-col",2),t._UZ(1,"app-infinite-loading"),t.qZA())}function tn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",46),t.TgZ(1,"div",47),t.TgZ(2,"span"),t._uU(3),t.qZA(),t.TgZ(4,"a",48),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).resetStation()}),t.O4$(),t._UZ(5,"svg",49),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(3),t.Oqu(e.station.station_name)}}function en(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"app-station-selection",50),t.NdJ("onSelection",function(r){return t.CHM(e),t.oxw(2).onStationSelect(r)}),t.qZA()}}function on(n,a){1&n&&(t.TgZ(0,"div"),t.O4$(),t._UZ(1,"svg",52),t._uU(2," Station selection required."),t.qZA())}function nn(n,a){if(1&n&&(t.TgZ(0,"div",51),t.YNc(1,on,3,0,"div",34),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.f.station.errors.required)}}function rn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",46),t.TgZ(1,"div",47),t.TgZ(2,"span"),t._uU(3),t.qZA(),t.TgZ(4,"a",48),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).resetElement()}),t.O4$(),t._UZ(5,"svg",49),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(3),t.Oqu(e.element.element_name)}}function ln(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"app-element-selection",50),t.NdJ("onSelection",function(r){return t.CHM(e),t.oxw(2).onElementSelect(r)}),t.qZA()}}function an(n,a){1&n&&(t.TgZ(0,"div"),t.O4$(),t._UZ(1,"svg",52),t._uU(2," Element selection is required."),t.qZA())}function sn(n,a){if(1&n&&(t.TgZ(0,"div",51),t.YNc(1,an,3,0,"div",34),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.f.element.errors.required)}}function cn(n,a){1&n&&(t.TgZ(0,"div",53),t.O4$(),t._UZ(1,"svg",52),t._uU(2," Year and Month is required "),t.qZA())}function _n(n,a){if(1&n&&(t.TgZ(0,"option",54),t._uU(1),t.qZA()),2&n){const e=a.$implicit,o=t.oxw(2);t.Q6J("value",e),t.xp6(1),t.Oqu(o.getHoursValue(e))}}function un(n,a){1&n&&(t.TgZ(0,"div"),t.O4$(),t._UZ(1,"svg",52),t._uU(2," Hour selection is required."),t.qZA())}function mn(n,a){if(1&n&&(t.TgZ(0,"div",51),t.YNc(1,un,3,0,"div",34),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.f.dayHour.errors.required)}}function pn(n,a){if(1&n&&(t.TgZ(0,"option",54),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.key),t.xp6(1),t.Oqu(e.value)}}function dn(n,a){1&n&&(t.TgZ(0,"div"),t.O4$(),t._UZ(1,"svg",52),t._uU(2," Selection is required."),t.qZA())}function fn(n,a){if(1&n&&(t.TgZ(0,"div",51),t.YNc(1,dn,3,0,"div",34),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.f.temperature.errors.required)}}function gn(n,a){if(1&n&&(t.TgZ(0,"option",54),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.key),t.xp6(1),t.Oqu(e.value)}}function hn(n,a){1&n&&(t.TgZ(0,"div"),t.O4$(),t._UZ(1,"svg",52),t._uU(2," Selection is required."),t.qZA())}function yn(n,a){if(1&n&&(t.TgZ(0,"div",51),t.YNc(1,hn,3,0,"div",34),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.f.precip.errors.required)}}function vn(n,a){if(1&n&&(t.TgZ(0,"option",54),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.key),t.xp6(1),t.Oqu(e.value)}}function Cn(n,a){1&n&&(t.TgZ(0,"div"),t.O4$(),t._UZ(1,"svg",52),t._uU(2," Selection is required."),t.qZA())}function Zn(n,a){if(1&n&&(t.TgZ(0,"div",51),t.YNc(1,Cn,3,0,"div",34),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.f.cloud_height.errors.required)}}function bn(n,a){if(1&n&&(t.TgZ(0,"option",54),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.key),t.xp6(1),t.Oqu(e.value)}}function xn(n,a){1&n&&(t.TgZ(0,"div"),t.O4$(),t._UZ(1,"svg",52),t._uU(2," Selection is required."),t.qZA())}function Tn(n,a){if(1&n&&(t.TgZ(0,"div",51),t.YNc(1,xn,3,0,"div",34),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.f.visibility.errors.required)}}function wn(n,a){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.hij("for ",e.getDateText(e.year,e.month),"")}}function Fn(n,a){if(1&n&&(t.TgZ(0,"c-row"),t.TgZ(1,"c-col",55),t.TgZ(2,"c-alert",56),t.TgZ(3,"strong"),t._uU(4,"Error(s) Found!"),t.qZA(),t._uU(5),t.qZA(),t.qZA(),t.qZA()),2&n){const e=t.oxw(2);t.xp6(5),t.hij(" ",e.error,"")}}function An(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"p"),t._uU(1," Values must be between "),t.TgZ(2,"strong"),t._uU(3),t.ALo(4,"number"),t.qZA(),t._uU(5," and "),t.TgZ(6,"strong"),t._uU(7),t.ALo(8,"number"),t.qZA(),t.TgZ(9,"a",60),t.NdJ("click",function(){return t.CHM(e),t.oxw(3).moreInfo()}),t._uU(10," more... "),t.qZA(),t.qZA()}if(2&n){const e=t.oxw(3);t.xp6(3),t.hij(" ",t.lcZ(4,2,e.element.lower_limit)," "),t.xp6(4),t.hij("",t.lcZ(8,4,e.element.upper_limit)," ")}}function Mn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"p"),t._uU(1," No validation information available for the selected element. "),t.TgZ(2,"button",61),t.NdJ("click",function(){return t.CHM(e),t.oxw(3).moreInfo()}),t._uU(3," more... "),t.qZA(),t.qZA()}}function qn(n,a){if(1&n&&(t.TgZ(0,"c-row"),t.TgZ(1,"c-col",57),t.TgZ(2,"div",58),t._UZ(3,"img",59),t.TgZ(4,"h5"),t._uU(5,"Please use the following information for data entry"),t.qZA(),t.YNc(6,An,11,6,"p",34),t.YNc(7,Mn,4,0,"p",34),t.qZA(),t.qZA(),t.qZA()),2&n){const e=t.oxw(2);t.xp6(6),t.Q6J("ngIf",e.element.lower_limit&&e.element.upper_limit),t.xp6(1),t.Q6J("ngIf",!e.element.lower_limit||!e.element.upper_limit)}}function Sn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"c-col",55),t.TgZ(1,"app-daily-day-form-group",69,70),t.NdJ("onReturn",function(r){return t.CHM(e),t.oxw(3).handleReturn(r)})("onFocus",function(r){return t.CHM(e),t.oxw(3).dayFocus(r)})("onBlur",function(r){return t.CHM(e),t.oxw(3).dayBlur(r)})("onDirty",function(r){return t.CHM(e),t.oxw(3).onFormModified(r)})("onRevert",function(r){return t.CHM(e),t.oxw(3).revertDay(r)}),t.qZA(),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw(3);t.xp6(1),t.Q6J("disabled",!o.isEditable)("modified",o.isModified)("limits",o.limits)("group",e)}}function On(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"c-col",55),t.TgZ(1,"app-daily-day-form-group",69,70),t.NdJ("onReturn",function(r){return t.CHM(e),t.oxw(3).handleReturn(r)})("onFocus",function(r){return t.CHM(e),t.oxw(3).dayFocus(r)})("onBlur",function(r){return t.CHM(e),t.oxw(3).dayBlur(r)})("onDirty",function(r){return t.CHM(e),t.oxw(3).onFormModified(r)})("onRevert",function(r){return t.CHM(e),t.oxw(3).revertDay(r)}),t.qZA(),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw(3);t.xp6(1),t.Q6J("disabled",!o.isEditable)("modified",o.isModified)("limits",o.limits)("group",e)}}function Dn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"c-col",55),t.TgZ(1,"app-daily-day-form-group",69,70),t.NdJ("onReturn",function(r){return t.CHM(e),t.oxw(3).handleReturn(r)})("onFocus",function(r){return t.CHM(e),t.oxw(3).dayFocus(r)})("onBlur",function(r){return t.CHM(e),t.oxw(3).dayBlur(r)})("onDirty",function(r){return t.CHM(e),t.oxw(3).onFormModified(r)})("onRevert",function(r){return t.CHM(e),t.oxw(3).revertDay(r)}),t.qZA(),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw(3);t.xp6(1),t.Q6J("disabled",!o.isEditable)("modified",o.isModified)("limits",o.limits)("group",e)}}function Hn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"c-col",55),t.TgZ(1,"app-daily-day-form-group",69,70),t.NdJ("onReturn",function(r){return t.CHM(e),t.oxw(3).handleReturn(r)})("onFocus",function(r){return t.CHM(e),t.oxw(3).dayFocus(r)})("onBlur",function(r){return t.CHM(e),t.oxw(3).dayBlur(r)})("onDirty",function(r){return t.CHM(e),t.oxw(3).onFormModified(r)})("onRevert",function(r){return t.CHM(e),t.oxw(3).revertDay(r)}),t.qZA(),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw(3);t.xp6(1),t.Q6J("disabled",!o.isEditable)("modified",o.isModified)("limits",o.limits)("group",e)}}function kn(n,a){if(1&n&&(t.TgZ(0,"c-row",62),t.TgZ(1,"c-col",37),t.TgZ(2,"c-row",63),t.TgZ(3,"c-col",64),t._uU(4,"Day"),t.qZA(),t.TgZ(5,"c-col",64),t._uU(6,"Value"),t.qZA(),t.TgZ(7,"c-col",64),t._uU(8,"Flag"),t.qZA(),t.TgZ(9,"c-col",64),t._uU(10,"Period"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(11,"c-col",65),t.TgZ(12,"c-row",63),t.TgZ(13,"c-col",64),t._uU(14,"Day"),t.qZA(),t.TgZ(15,"c-col",64),t._uU(16,"Value"),t.qZA(),t.TgZ(17,"c-col",64),t._uU(18,"Flag"),t.qZA(),t.TgZ(19,"c-col",64),t._uU(20,"Period"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(21,"c-col",66),t.TgZ(22,"c-row",63),t.TgZ(23,"c-col",64),t._uU(24,"Day"),t.qZA(),t.TgZ(25,"c-col",64),t._uU(26,"Value"),t.qZA(),t.TgZ(27,"c-col",64),t._uU(28,"Flag"),t.qZA(),t.TgZ(29,"c-col",64),t._uU(30,"Period"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(31,"c-col",67),t.TgZ(32,"c-row",63),t.TgZ(33,"c-col",64),t._uU(34,"Day"),t.qZA(),t.TgZ(35,"c-col",64),t._uU(36,"Value"),t.qZA(),t.TgZ(37,"c-col",64),t._uU(38,"Flag"),t.qZA(),t.TgZ(39,"c-col",64),t._uU(40,"Period"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(41,"c-col",37),t.TgZ(42,"c-row"),t.YNc(43,Sn,3,4,"c-col",68),t.ALo(44,"slice"),t.qZA(),t.qZA(),t.TgZ(45,"c-col",37),t.TgZ(46,"c-row"),t.YNc(47,On,3,4,"c-col",68),t.ALo(48,"slice"),t.qZA(),t.qZA(),t.TgZ(49,"c-col",37),t.TgZ(50,"c-row"),t.YNc(51,Dn,3,4,"c-col",68),t.ALo(52,"slice"),t.qZA(),t.qZA(),t.TgZ(53,"c-col",37),t.TgZ(54,"c-row"),t.YNc(55,Hn,3,4,"c-col",68),t.ALo(56,"slice"),t.qZA(),t.qZA(),t.qZA()),2&n){const e=t.oxw(2);t.xp6(43),t.Q6J("ngForOf",t.Dn7(44,4,e.formDaysGroups,0,8)),t.xp6(4),t.Q6J("ngForOf",t.Dn7(48,8,e.formDaysGroups,8,16)),t.xp6(4),t.Q6J("ngForOf",t.Dn7(52,12,e.formDaysGroups,16,24)),t.xp6(4),t.Q6J("ngForOf",t.Dn7(56,16,e.formDaysGroups,24,31))}}function In(n,a){1&n&&t._UZ(0,"c-spinner",71)}const R=function(n){return{"is-invalid":n}},En=function(n,a){return{"is-valid":n,"is-invalid":a}};function Nn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"form",1),t.NdJ("ngSubmit",function(r){return t.CHM(e),t.oxw().onSubmit(r)})("keydown.enter",function(r){return t.CHM(e),t.oxw().onReturn(r)}),t.TgZ(1,"c-row"),t.TgZ(2,"c-col",2),t._UZ(3,"app-flag-legend"),t.qZA(),t.YNc(4,Xo,2,0,"c-col",3),t.TgZ(5,"c-col",4),t.TgZ(6,"fieldset",5),t.TgZ(7,"legend"),t._uU(8,"Form Selector"),t.qZA(),t.TgZ(9,"c-row"),t.TgZ(10,"c-col",6),t.TgZ(11,"div",7),t.TgZ(12,"label",8),t._uU(13,"Station"),t.qZA(),t._UZ(14,"input",9),t.YNc(15,tn,6,1,"div",10),t.YNc(16,en,1,0,"app-station-selection",11),t.YNc(17,nn,2,1,"div",12),t.qZA(),t.qZA(),t.TgZ(18,"c-col",6),t.TgZ(19,"div",7),t.TgZ(20,"label",13),t._uU(21,"Element"),t.qZA(),t._UZ(22,"input",14),t.YNc(23,rn,6,1,"div",10),t.YNc(24,ln,1,0,"app-element-selection",11),t.YNc(25,sn,2,1,"div",12),t.qZA(),t.qZA(),t.TgZ(26,"c-col",6),t.TgZ(27,"label",13),t._uU(28,"Month/Year"),t.qZA(),t.TgZ(29,"c-input-group",15),t.TgZ(30,"span",16),t.O4$(),t._UZ(31,"svg",17),t.qZA(),t.kcU(),t._UZ(32,"input",18),t.TgZ(33,"input",19),t.NdJ("bsValueChange",function(r){return t.CHM(e),t.oxw().onDateSelection(r)})("onShown",function(r){return t.CHM(e),t.oxw().onOpenCalendar(r)}),t.qZA(),t.YNc(34,cn,3,0,"div",20),t.qZA(),t.qZA(),t.TgZ(35,"c-col",6),t.TgZ(36,"div",7),t.TgZ(37,"label",21),t._uU(38,"Hour"),t.qZA(),t.TgZ(39,"select",22),t.NdJ("change",function(r){return t.CHM(e),t.oxw().onHourSelect(r.target)}),t.TgZ(40,"option",23),t._uU(41,"Select Hour"),t.qZA(),t.YNc(42,_n,2,2,"option",24),t.qZA(),t.YNc(43,mn,2,1,"div",12),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(44,"fieldset",25),t.TgZ(45,"legend"),t._uU(46,"Units"),t.qZA(),t.TgZ(47,"c-row"),t.TgZ(48,"c-col",26),t.TgZ(49,"div",7),t.TgZ(50,"label",21),t._uU(51,"Temperature"),t.qZA(),t.TgZ(52,"select",27),t.TgZ(53,"option",23),t._uU(54,"Please Select"),t.qZA(),t.YNc(55,pn,2,2,"option",24),t.qZA(),t.YNc(56,fn,2,1,"div",12),t.qZA(),t.qZA(),t.TgZ(57,"c-col",26),t.TgZ(58,"div",7),t.TgZ(59,"label",28),t._uU(60,"Precipitation"),t.qZA(),t.TgZ(61,"select",29),t.TgZ(62,"option",23),t._uU(63,"Please Select"),t.qZA(),t.YNc(64,gn,2,2,"option",24),t.qZA(),t.YNc(65,yn,2,1,"div",12),t.qZA(),t.qZA(),t.TgZ(66,"c-col",26),t.TgZ(67,"div",7),t.TgZ(68,"label",30),t._uU(69,"Cloud Height"),t.qZA(),t.TgZ(70,"select",31),t.TgZ(71,"option",23),t._uU(72,"Please Select"),t.qZA(),t.YNc(73,vn,2,2,"option",24),t.qZA(),t.YNc(74,Zn,2,1,"div",12),t.qZA(),t.qZA(),t.TgZ(75,"c-col",26),t.TgZ(76,"div",7),t.TgZ(77,"label",32),t._uU(78,"Visibility"),t.qZA(),t.TgZ(79,"select",33),t.TgZ(80,"option",23),t._uU(81,"Please Select"),t.qZA(),t.YNc(82,bn,2,2,"option",24),t.qZA(),t.YNc(83,Tn,2,1,"div",12),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(84,"fieldset",5),t.TgZ(85,"legend"),t._uU(86,"Daily Data "),t.YNc(87,wn,2,1,"span",34),t.qZA(),t.YNc(88,Fn,6,1,"c-row",34),t.YNc(89,qn,8,2,"c-row",34),t.YNc(90,kn,57,20,"c-row",35),t.TgZ(91,"c-row",36),t.TgZ(92,"c-col",37),t.TgZ(93,"div",7),t.TgZ(94,"label",38),t._uU(95,"Total"),t.qZA(),t._UZ(96,"input",39),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t._UZ(97,"hr",40),t.TgZ(98,"c-row"),t.TgZ(99,"c-col",41),t.TgZ(100,"button",42),t.YNc(101,In,1,0,"c-spinner",43),t._uU(102),t.qZA(),t.TgZ(103,"button",44),t.NdJ("click",function(){return t.CHM(e),t.oxw().onReset()}),t._uU(104," Reset "),t.qZA(),t.TgZ(105,"button",45),t.NdJ("click",function(){return t.CHM(e),t.oxw().onCancel()}),t._uU(106," Cancel "),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=t.oxw();t.Q6J("formGroup",e.form),t.xp6(4),t.Q6J("ngIf",e.loading),t.xp6(10),t.Q6J("ngClass",t.VKq(36,R,(e.submitted||e.f.station.touched)&&e.f.station.invalid)),t.xp6(1),t.Q6J("ngIf",e.station),t.xp6(1),t.Q6J("ngIf",!e.station),t.xp6(1),t.Q6J("ngIf",e.f.station.errors),t.xp6(5),t.Q6J("ngClass",t.VKq(38,R,(e.submitted||e.f.element.touched)&&e.f.element.invalid)),t.xp6(1),t.Q6J("ngIf",e.element),t.xp6(1),t.Q6J("ngIf",!e.element),t.xp6(1),t.Q6J("ngIf",e.f.element.errors),t.xp6(8),t.Q6J("bsConfig",e.bsConfig)("bsValue",e.monthYearValue)("ngClass",t.VKq(40,R,e.submitted&&e.f.monthYear.invalid)),t.xp6(1),t.Q6J("ngIf",e.submitted&&e.f.monthYear.invalid),t.xp6(5),t.Q6J("ngClass",t.VKq(42,R,(e.submitted||e.f.dayHour.touched)&&e.f.dayHour.invalid)),t.xp6(3),t.Q6J("ngForOf",e.hoursList),t.xp6(1),t.Q6J("ngIf",e.f.dayHour.errors),t.xp6(9),t.Q6J("ngClass",t.VKq(44,R,(e.submitted||e.f.temperature.touched)&&e.f.temperature.invalid)),t.xp6(3),t.Q6J("ngForOf",e.unitOptions.temperature),t.xp6(1),t.Q6J("ngIf",e.f.temperature.errors),t.xp6(5),t.Q6J("ngClass",t.VKq(46,R,(e.submitted||e.f.precip.touched)&&e.f.precip.invalid)),t.xp6(3),t.Q6J("ngForOf",e.unitOptions.precipitation),t.xp6(1),t.Q6J("ngIf",e.f.precip.errors),t.xp6(5),t.Q6J("ngClass",t.VKq(48,R,(e.submitted||e.f.cloud_height.touched)&&e.f.cloud_height.invalid)),t.xp6(3),t.Q6J("ngForOf",e.unitOptions.cloudHeight),t.xp6(1),t.Q6J("ngIf",e.f.cloud_height.errors),t.xp6(5),t.Q6J("ngClass",t.VKq(50,R,(e.submitted||e.f.visibility.touched)&&e.f.visibility.invalid)),t.xp6(3),t.Q6J("ngForOf",e.unitOptions.visibility),t.xp6(1),t.Q6J("ngIf",e.f.visibility.errors),t.xp6(4),t.Q6J("ngIf",e.year&&e.month),t.xp6(1),t.Q6J("ngIf",e.error),t.xp6(1),t.Q6J("ngIf",e.element&&e.formDaysGroups.length),t.xp6(1),t.Q6J("ngIf",e.formDaysGroups.length),t.xp6(6),t.Q6J("ngClass",t.WLB(52,En,e.f.total.value===e.calcTotal,e.f.total.value!==e.calcTotal)),t.xp6(5),t.Q6J("ngIf",e.loading),t.xp6(1),t.hij(" ",e.hasRecord?"Update":"Save"," ")}}let Rn=(()=>{class n{constructor(e,o,r,i,s,p){this.router=e,this.modalService=o,this.responsiveSvc=r,this.dataEntryService=i,this.stationService=s,this.elementService=p,this.submitted=!1,this.loading=!0,this.error="",this.monthModified=!1,this.monthYearValue=new Date,this.bsConfig={isAnimated:!0,containerClass:"theme-blue",dateInputFormat:"MM/YYYY"},this.hour=6,this.unitOptions=Lo,this.hoursList=[24,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],this.hasRecord=!1,this.day=0}ngOnInit(){this.initForm(),this.dataEntryService.dailyState.pipe((0,w.b)(e=>this.loading=!!e),(0,m.h)(e=>!!e),(0,M.q)(1)).subscribe(e=>{console.log(e),this.setFormState(+e.station,+e.element,e.monthYear,e.hour)})}canExit(){return!this.hasChanges||window.confirm("You have unsaved changes. Are you sure you want to leave the page?")}get f(){return this.form.controls}get isEditable(){return!!this.station&&!!this.element}get isModified(){return this.monthModified}get hasChanges(){return this.dailyGroup.toArray().filter(e=>!0===e.isDirty).length>0}get invalidEntries(){return this.dailyGroup.toArray().filter(e=>!!e.isInvalid).length>0}onFormModified(e){this.monthModified=e}resetStation(){this.station=void 0,this.form.controls.station.reset()}onStationSelect(e){this.station=e,this.form.controls.station.setValue(e.station_id),this.loadDailyData()}resetElement(){this.element=void 0,this.form.controls.element.reset(),this.limits=null}onElementSelect(e){this.element=e,this.form.controls.element.setValue(e.element_id),this.limits=e.lower_limit&&e.upper_limit?{lower:+e.lower_limit,upper:+e.upper_limit}:null,this.loadDailyData()}onSubmit(e){if(this.submitted=!0,!this.form.invalid||this.f.days.invalid){if(this.invalidEntries)return void(this.error="The monthly data contains some invalid entried, please fix the items and try again.");if(console.log(+this.f.total.value,this.calcTotal,+this.f.total.value===this.calcTotal),+this.f.total.value!==this.calcTotal)return void(this.error="The days based data total does not match with the total provided, please check the values and try again.");this.error="",this.hasRecord?this.updateRecord():this.addRecord()}}onDateSelection(e){e&&this.renderFormDays(e)}getHoursValue(e){return g().set("hours",e).startOf("hour").format("HH:mm")}onReset(){this.modalService.show(q.S,{initialState:{title:"Confirm Reset",message:"You have changes in the form below, are you sure you want to reset?",confirm:"Go Ahead",cancel:"Cancel"}}).content.onClose.subscribe(r=>{r&&(this.form.reset(),this.station=void 0,this.element=void 0,this.dataEntryService.resetDailyState(),this.initForm())})}onCancel(){this.router.navigateByUrl("/")}onReturn(e){e.preventDefault()}onOpenCalendar(e){e.monthSelectHandler=o=>{e._store.dispatch(e._actions.select(o.date))},e.setViewMode("month")}onHourSelect(e){this.hour=this.f.dayHour.value,this.loadDailyData()}getDateText(e,o){return`${["January","February","March","April","May","June","July","August","September","October","November","December"][o-1]} ${e}`}moreInfo(){console.log("more info")}get daysArray(){return this.form.get("days")}get formDaysGroups(){return this.daysArray.controls}get calcTotal(){return this.dailyGroup?this.dailyGroup.toArray().reduce((e,o)=>(o.group.value.value?+o.group.value.value:0)+e,0):0}dayFocus(e){this.day=e}dayBlur(e){}handleReturn(e){+e<this.dailyGroup.toArray().length&&this.dailyGroup.toArray()[+e].focusValue()}revertDay(e){this.modalService.show(q.S,{initialState:{title:"Confirm Revert",message:"Are you sure you want to revert to original values?",confirm:"Go Ahead",cancel:"Cancel"}}).content.onClose.subscribe(i=>{if(i)if(this.hasRecord){const s=(e<10?"0":"")+e;this.formDaysGroups[e-1]=this.getDayGroup(e,this.raw[`day${s}`],this.raw[`flag${s}`],this.raw[`period${s}`])}else this.formDaysGroups[e-1]=this.getDayGroup(e)})}resetDays(){this.form.controls.days=new l.Oe([])}getDayGroup(e,o,r,i){return new l.cw({day:new l.NI(e),value:new l.NI(o,[l.kI.min(0),l.kI.max(70)]),flag:new l.NI(r||u.N),period:new l.NI(i)})}renderFormDays(e,o=!0){const r=g(e);this.year=r.year(),this.month=r.month()+1;const i=g(`${this.year}-${this.month}`,"YYYY-MM").daysInMonth();this.resetDays();for(let s=1;s<=i;s++)this.daysArray.push(this.getDayGroup(s));o&&this.loadDailyData()}initForm(){this.form=new l.cw({station:new l.NI(null,l.kI.required),element:new l.NI(null,l.kI.required),element_seq:new l.NI(!1),monthYear:new l.NI(new Date,l.kI.required),dayHour:new l.NI(6,[l.kI.min(0),l.kI.max(24)]),temperature:new l.NI(null),precip:new l.NI(null),cloud_height:new l.NI(null),visibility:new l.NI(null),days:new l.Oe([]),total:new l.NI(null)})}setFormState(e,o,r,i){this.stationService.getStation(e).pipe((0,w.b)(s=>{this.station=s.result[0]}),(0,tt.w)(s=>this.elementService.getElement(o))).subscribe(s=>{this.element=s.result[0],this.loadDailyData()}),this.f.station.setValue(e),this.f.element.setValue(o),this.f.monthYear.setValue(r),this.monthYearValue=new Date(r),this.f.dayHour.setValue(i)}loadDailyData(){this.station&&this.element&&this.year&&this.month&&this.hour&&(this.loading=!0,this.dataEntryService.getDailyEntry(this.station.station_id,this.element.element_id,this.year,this.month,this.hour).subscribe(e=>{console.log(e),this.hasRecord=e.result.length>0,e.result.length?(this.raw=e.result[0],this.patchForm(e.result[0]),this.focusFirst()):(this.resetDays(),this.renderFormDays(new Date(`${this.month}-1-${this.year}`),!1),this.f.total.setValue(""),this.focusFirst()),this.loading=!1}))}patchForm(e){this.f.temperature.setValue(e.temperature_units||""),this.f.precip.setValue(e.precip_units||""),this.f.cloud_height.setValue(e.cloud_height_units||""),this.f.visibility.setValue(e.vis_units||"");let o=0;this.formDaysGroups.forEach((r,i)=>{const s=i+1<10?`0${i+1}`:i+1;r.patchValue(Object.assign({},{day:i+1,value:e[`day${s}`],flag:e[`flag${s}`]||u.N,period:e[`period${s}`]})),o+=+e[`day${s}`]}),this.f.total.setValue(o||0)}addRecord(){var e,o;let r={station_id:null===(e=this.station)||void 0===e?void 0:e.station_id,element_id:null===(o=this.element)||void 0===o?void 0:o.element_id,yyyy:this.year,mm:this.month,hh:this.hour,temperature:this.form.value.temperature,precip_units:this.form.value.precip,vis_units:this.form.value.visibility,cloud_height_units:this.form.value.cloud_height};this.hasChanges||alert("You must enter a few values"),this.formDaysGroups.forEach((i,s)=>{const p=s+1<10?`0${s+1}`:s+1;r[`day${p}`]=i.controls.value.value,r[`flag${p}`]=i.controls.flag.value,r[`period${p}`]=i.controls.period.value}),r.entry_datetime=(new Date).toISOString(),r.temperature_units=this.f.temperature.value,r.precip_units=this.f.precip.value,r.cloud_height_units=this.f.cloud_height.value,r.vis_units=this.f.visibility.value,this.dailyGroup.toArray().forEach(i=>{const s=i.group.value,p=`${s.day<10?"0":""}${s.day}`;r[`day${p}`]=+s.value,r[`flag${p}`]="N"===s.flag?null:s.flag,r[`period${p}`]=s.period}),this.dataEntryService.addDailyEntry(r).subscribe(i=>{console.log(i),this.form.markAsPristine()})}updateRecord(){var e,o,r,i;if(!this.hasChanges)return;let s={station_id:null===(e=this.station)||void 0===e?void 0:e.station_id,element_id:null===(o=this.element)||void 0===o?void 0:o.element_id,yyyy:this.year,mm:this.month,hh:this.hour,temperature_units:this.form.value.temperature,precip_units:this.form.value.precip,vis_units:this.form.value.visibility,cloud_height_units:this.form.value.cloud_height};this.dailyGroup.toArray().forEach(p=>{const v=p.group.value,I=`${v.day<10?"0":""}${v.day}`;s[`day${I}`]=+v.value,s[`flag${I}`]="N"===v.flag?null:v.flag,s[`period${I}`]=v.period}),this.dataEntryService.updateDailyEntry(null===(r=this.station)||void 0===r?void 0:r.station_id,null===(i=this.element)||void 0===i?void 0:i.element_id,this.year,this.month,this.hour,s).subscribe(p=>{this.form.markAsPristine()})}focusFirst(){(0,O.of)(!0).pipe((0,h.g)(100)).subscribe(()=>{this.dailyGroup.toArray()[0].focusValue()})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(Z.F0),t.Y36(x.tT),t.Y36(D.k),t.Y36(U),t.Y36(V.v),t.Y36(_t.d))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-form-daily2"]],viewQuery:function(e,o){if(1&e&&t.Gf(zo,5),2&e){let r;t.iGM(r=t.CRH())&&(o.dailyGroup=r)}},decls:4,vars:2,consts:[["novalidate","",3,"formGroup","ngSubmit","keydown.enter",4,"ngIf"],["novalidate","",3,"formGroup","ngSubmit","keydown.enter"],["sm","12",1,"text-end"],["sm","12","class","text-end",4,"ngIf"],["sm","12"],[1,"form-group","p-3","mt-2"],["xs","12","md","6","xl","3"],[1,"mb-2"],["cLabel","","for","station"],["id","station","type","hidden","formControlName","station","aria-label","default input","cFormControl","",3,"ngClass"],["class","typeahead-selection theme form-group",4,"ngIf"],[3,"onSelection",4,"ngIf"],["col","12","class","invalid-feedback",4,"ngIf"],["cLabel","","for","element"],["id","element","type","hidden","formControlName","element","aria-label","default input","cFormControl","",3,"ngClass"],[1,"mb-3"],["cInputGroupText","","id","basic-addon1"],["cIcon","","name","cilCalendar"],["id","element","type","hidden","formControlName","monthYear","aria-label","default input","cFormControl","","placeholder","Station Name"],["name","monthYear","placeholder","Select Year & Month","cFormControl","","bsDatepicker","","autocomplete","off",3,"bsConfig","bsValue","ngClass","bsValueChange","onShown"],["sm","12","class","invalid-feedback",4,"ngIf"],["cLabel","","for","hoursValue"],["formControlName","dayHour","aria-label","Hour","cSelect","",3,"ngClass","change"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"form-group","p-3","my-4"],["xs","12","md","6","lg","3"],["formControlName","temperature","aria-label","Temperature","cSelect","",3,"ngClass"],["cLabel","","for","precip"],["formControlName","precip","aria-label","Precipitation","cSelect","",3,"ngClass"],["cLabel","","for","cloudh"],["formControlName","cloud_height","aria-label","Hour","cSelect","",3,"ngClass"],["cLabel","","for","visibility"],["formControlName","visibility","aria-label","Hour","cSelect","",3,"ngClass"],[4,"ngIf"],["formArrayName","days",4,"ngIf"],[1,"mt-3"],["sm","12","md","6","lg","4","xl","3"],["cLabel","","for","total"],["type","number","formControlName","total","aria-label","total","placeholder","Total","cFormControl","",1,"txt-total",3,"ngClass"],[1,"my-4"],["xs","12 py-4"],["type","submit","cButton","","color","dark",1,"px-3"],["aria-hidden","true","size","sm",4,"ngIf"],["type","button","cButton","","color","dark",1,"px-3","mx-1",3,"click"],["type","button","cButton","","color","dark",1,"px-3",3,"click"],[1,"typeahead-selection","theme","form-group"],[1,"typeahead-selection-inner"],[1,"btn",3,"click"],["cIcon","","name","cilX"],[3,"onSelection"],["col","12",1,"invalid-feedback"],["cIcon","","name","cilXCircle"],["sm","12",1,"invalid-feedback"],[3,"value"],["md","12"],["color","danger"],["md","12 mt-3 mb-3"],[1,"form-info"],["src","./assets/img/icons/info.png","alt",""],["color","link","cButton","",1,"p-0",3,"click"],["type","button","color","link","cButton","",3,"click"],["formArrayName","days"],[1,"daily-header"],[1,"py-1"],["sm","12","md","6","lg","4","xl","3",1,"d-none","d-md-block"],["lg","4","xl","3",1,"d-none","d-lg-block"],["xl","3",1,"d-none","d-xl-block"],["md","12",4,"ngFor","ngForOf"],[3,"disabled","modified","limits","group","onReturn","onFocus","onBlur","onDirty","onRevert"],["dailyGroup",""],["aria-hidden","true","size","sm"]],template:function(e,o){1&e&&(t.TgZ(0,"h5"),t._uU(1),t.qZA(),t._UZ(2,"hr"),t.YNc(3,Nn,107,55,"form",0)),2&e&&(t.xp6(1),t.hij(" Daily data for the whole month ",o.monthModified," "),t.xp6(2),t.Q6J("ngIf",o.form))},directives:[_.O5,l._Y,l.JL,l.sg,c.iok,c.Yp0,P,c.eFW,l.Fj,c.oHf,l.JJ,l.u,_.mk,c.g8K,c.jOm,J.ar,k.Y5,k.Np,l.EJ,c.nqR,l.YN,l.Kr,_.sg,l.wV,c.Hq3,j.$,Y.n,ut.Y,c.wxo,l.CE,jo,c.ORR],pipes:[_.JJ,_.OU],styles:[".daily-header[_ngcontent-%COMP%]   c-col[_ngcontent-%COMP%]{text-align:center;font-size:.65rem;padding-left:.3rem}.daily-header[_ngcontent-%COMP%]   c-col[_ngcontent-%COMP%]:first-child{padding-left:8%}.form-info[_ngcontent-%COMP%]{position:relative;padding:1rem .8rem .2rem 5rem;background-color:#d6ebff;border:1px solid #c2e0ff;border-radius:.25rem;color:#333;box-shadow:0 3px 10px #0003}.form-info[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{position:absolute;top:1rem;left:.8rem;width:4rem}.form-info[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-size:1.1rem}.form-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;margin-top:.5rem}.txt-total[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:bold}.txt-total.is-valid[_ngcontent-%COMP%]{background-color:#d3eebc;color:#0c971e}.txt-total.is-invalid[_ngcontent-%COMP%]{background-color:#f0cdcd;color:#ff2f2f}"]}),n})();var G=d(7777);const Un=["synopticGroup"];function Pn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",32),t.TgZ(1,"div",33),t.TgZ(2,"span"),t._uU(3),t.qZA(),t.TgZ(4,"a",34),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).resetStation()}),t.O4$(),t._UZ(5,"svg",35),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(3),t.Oqu(e.station.station_name)}}function Jn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"app-station-selection",36),t.NdJ("onSelection",function(r){return t.CHM(e),t.oxw(2).onStationSelect(r)}),t.qZA()}}function Yn(n,a){1&n&&(t.TgZ(0,"div"),t.O4$(),t._UZ(1,"svg",39),t._uU(2," Station selection required."),t.qZA())}function Gn(n,a){if(1&n&&(t.TgZ(0,"div",37),t.YNc(1,Yn,3,0,"div",38),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.f.station.errors.required)}}function $n(n,a){1&n&&(t.TgZ(0,"div",40),t.O4$(),t._UZ(1,"svg",39),t._uU(2," Year and Month is required "),t.qZA())}function Vn(n,a){if(1&n&&(t.TgZ(0,"option",41),t._uU(1),t.qZA()),2&n){const e=a.$implicit,o=t.oxw(2);t.Q6J("value",e),t.xp6(1),t.Oqu(o.getHoursValue(e))}}function Qn(n,a){1&n&&(t.TgZ(0,"div"),t.O4$(),t._UZ(1,"svg",39),t._uU(2," Hour selection is required."),t.qZA())}function Ln(n,a){if(1&n&&(t.TgZ(0,"div",37),t.YNc(1,Qn,3,0,"div",38),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.f.hour.errors.required)}}function Bn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"c-col",45),t.TgZ(1,"app-synoptic-form-group",46,47),t.NdJ("onReturn",function(r){return t.CHM(e),t.oxw(3).handleReturn(r)})("onFocus",function(r){return t.CHM(e),t.oxw(3).keyFocus(r)})("onBlur",function(r){return t.CHM(e),t.oxw(3).keyBlur(r)})("onDirty",function(r){return t.CHM(e),t.oxw(3).onFormModified(r)})("onRevert",function(r){return t.CHM(e),t.oxw(3).revertItem(r)}),t.qZA(),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw(3);t.xp6(1),t.Q6J("disabled",!o.isEditable)("modified",o.isModified)("group",e)}}function Wn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"c-col",45),t.TgZ(1,"app-synoptic-form-group",46,47),t.NdJ("onReturn",function(r){return t.CHM(e),t.oxw(3).handleReturn(r)})("onFocus",function(r){return t.CHM(e),t.oxw(3).keyFocus(r)})("onBlur",function(r){return t.CHM(e),t.oxw(3).keyBlur(r)})("onDirty",function(r){return t.CHM(e),t.oxw(3).onFormModified(r)})("onRevert",function(r){return t.CHM(e),t.oxw(3).revertItem(r)}),t.qZA(),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw(3);t.xp6(1),t.Q6J("disabled",!o.isEditable)("modified",o.isModified)("group",e)}}function Kn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"c-col",45),t.TgZ(1,"app-synoptic-form-group",46,47),t.NdJ("onReturn",function(r){return t.CHM(e),t.oxw(3).handleReturn(r)})("onFocus",function(r){return t.CHM(e),t.oxw(3).keyFocus(r)})("onBlur",function(r){return t.CHM(e),t.oxw(3).keyBlur(r)})("onDirty",function(r){return t.CHM(e),t.oxw(3).onFormModified(r)})("onRevert",function(r){return t.CHM(e),t.oxw(3).revertItem(r)}),t.qZA(),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw(3);t.xp6(1),t.Q6J("disabled",!o.isEditable)("modified",o.isModified)("group",e)}}function jn(n,a){if(1&n&&(t.TgZ(0,"c-row",42),t.TgZ(1,"c-col",43),t.TgZ(2,"c-row"),t.YNc(3,Bn,3,3,"c-col",44),t.ALo(4,"slice"),t.qZA(),t.qZA(),t.TgZ(5,"c-col",43),t.TgZ(6,"c-row"),t.YNc(7,Wn,3,3,"c-col",44),t.ALo(8,"slice"),t.qZA(),t.qZA(),t.TgZ(9,"c-col",43),t.TgZ(10,"c-row"),t.YNc(11,Kn,3,3,"c-col",44),t.ALo(12,"slice"),t.qZA(),t.qZA(),t.qZA()),2&n){const e=t.oxw(2);t.xp6(3),t.Q6J("ngForOf",t.Dn7(4,3,e.formGroups,0,19)),t.xp6(4),t.Q6J("ngForOf",t.Dn7(8,7,e.formGroups,19,38)),t.xp6(4),t.Q6J("ngForOf",t.Dn7(12,11,e.formGroups,38,48))}}function zn(n,a){1&n&&(t.TgZ(0,"c-alert",48),t._uU(1,"Please select a date to view form."),t.qZA())}function Xn(n,a){1&n&&t._UZ(0,"c-spinner",49)}const pt=function(n){return{"is-invalid":n}};function tr(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"form",1),t.NdJ("ngSubmit",function(r){return t.CHM(e),t.oxw().onSubmit(r)})("keydown.enter",function(r){return t.CHM(e),t.oxw().onReturn(r)}),t.TgZ(1,"c-row"),t.TgZ(2,"c-col",2),t._UZ(3,"app-flag-legend"),t.qZA(),t.TgZ(4,"c-col",3),t.TgZ(5,"fieldset",4),t.TgZ(6,"legend"),t._uU(7,"Form Selector"),t.qZA(),t.TgZ(8,"c-row"),t.TgZ(9,"c-col",5),t.TgZ(10,"div",6),t.TgZ(11,"label",7),t._uU(12,"Station"),t.qZA(),t._UZ(13,"input",8),t.YNc(14,Pn,6,1,"div",9),t.YNc(15,Jn,1,0,"app-station-selection",10),t.YNc(16,Gn,2,1,"div",11),t.qZA(),t.qZA(),t.TgZ(17,"c-col",5),t.TgZ(18,"label",12),t._uU(19,"Year/Month/Day"),t.qZA(),t.TgZ(20,"c-input-group",13),t.TgZ(21,"span",14),t.O4$(),t._UZ(22,"svg",15),t.qZA(),t.kcU(),t._UZ(23,"input",16),t.TgZ(24,"input",17),t.NdJ("bsValueChange",function(r){return t.CHM(e),t.oxw().onDateSelection(r)}),t.qZA(),t.YNc(25,$n,3,0,"div",18),t.qZA(),t.qZA(),t.TgZ(26,"c-col",5),t.TgZ(27,"div",6),t.TgZ(28,"label",19),t._uU(29,"Hour"),t.qZA(),t.TgZ(30,"select",20),t.NdJ("change",function(r){return t.CHM(e),t.oxw().onHourSelect(r.target)}),t.TgZ(31,"option",21),t._uU(32,"Select Hour"),t.qZA(),t.YNc(33,Vn,2,2,"option",22),t.qZA(),t.YNc(34,Ln,2,1,"div",11),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(35,"fieldset",23),t.TgZ(36,"legend"),t._uU(37," Carribiean Synoptic Data "),t.qZA(),t.YNc(38,jn,13,15,"c-row",24),t.YNc(39,zn,2,0,"c-alert",25),t.qZA(),t._UZ(40,"hr",26),t.TgZ(41,"c-row"),t.TgZ(42,"c-col",27),t.TgZ(43,"button",28),t.YNc(44,Xn,1,0,"c-spinner",29),t._uU(45),t.qZA(),t.TgZ(46,"button",30),t.NdJ("click",function(){return t.CHM(e),t.oxw().onReset()}),t._uU(47," Reset "),t.qZA(),t.TgZ(48,"button",31),t.NdJ("click",function(){return t.CHM(e),t.oxw().onCancel()}),t._uU(49," Cancel "),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=t.oxw();t.Q6J("formGroup",e.form),t.xp6(13),t.Q6J("ngClass",t.VKq(16,pt,(e.submitted||e.f.station.touched)&&e.f.station.invalid)),t.xp6(1),t.Q6J("ngIf",e.station),t.xp6(1),t.Q6J("ngIf",!e.station),t.xp6(1),t.Q6J("ngIf",e.f.station.errors),t.xp6(8),t.Q6J("bsConfig",e.bsConfig)("bsValue",e.monthYearValue)("ngClass",t.VKq(18,pt,e.submitted&&e.f.dayMonthYear.invalid)),t.xp6(1),t.Q6J("ngIf",e.submitted&&e.f.dayMonthYear.invalid),t.xp6(5),t.Q6J("ngClass",t.VKq(20,pt,(e.submitted||e.f.hour.touched)&&e.f.hour.invalid)),t.xp6(3),t.Q6J("ngForOf",e.hoursList),t.xp6(1),t.Q6J("ngIf",e.f.hour.errors),t.xp6(4),t.Q6J("ngIf",e.formGroups.length),t.xp6(1),t.Q6J("ngIf",!e.formGroups.length),t.xp6(5),t.Q6J("ngIf",e.loading),t.xp6(1),t.hij(" ",e.hasRecord?"Update":"Save"," ")}}const et=[{element:106,key:"stnLevelPress",label:"Station Level Pressure"},{element:107,key:"seaReducedMSLP",label:"Pressure Reduced to MSL-P"},{element:400,key:"3HrPressCh",label:"3Hr Pressure Change-P3"},{element:814,key:"3HrPressCh",label:"3Hr Pressure Characteristic"},{element:399,key:"24HrPressCh",label:"24Hr Pressure Change-P24"},{element:301,key:"stPressLevelA",label:"Standard Pressure Level-a"},{element:185,key:"geoPotHeight",label:"Geopotential Height-hhh"},{element:102,key:"wetBulbTemp",label:"Wet Bulb Temp-TwTwTw"},{element:101,key:"dryBulbTemp",label:"Dry Bulb Temp-TTT"},{element:103,key:"dewPoint",label:"Dew Point-TdTdTd"},{element:105,key:"relativeHum",label:"Relative Humidity-U"},{element:192,key:"visibility",label:"Horizontal Visibility-VV"},{element:110,key:"visibility",label:"Low Cloud Height-h"},{element:114,key:"cloudCover",label:"Total Cloud Cover-N"},{element:115,key:"verticalSig",label:"Vertical Significance"},{element:168,key:"lowLvlCldNh",label:"Low Lvl Clouds Amt-Nh"},{element:169,key:"lowLvlCldCl",label:"Low Lvl Clouds Type-CL"},{element:170,key:"medLvlCldCm",label:"Medium Lvl Clouds Type-CM"},{element:171,key:"highLvlCldCh",label:"High Level Clouds Type-CH"},{element:119,key:"vertSig1",label:"Vertical Significance 1"},{element:116,key:"cldAmtLvl1",label:"Cloud Amt Lvl1-N1"},{element:117,key:"cldTpLvl1",label:"Cloud Type Lvl1-C1"},{element:118,key:"cldHtLvl1",label:"Cloud Ht Lvl1-HsHs1"},{element:123,key:"cldAmtLvl1",label:"Vertical Significance 2"},{element:120,key:"cldAmtLvl2",label:"Cloud Amt Lvl2-N2"},{element:121,key:"cldTpLvl2",label:"Cloud Type Lvl2-C2"},{element:122,key:"cldHtLvl2",label:"Cloud Ht Lvl2-HsHs2"},{element:127,key:"cldAmtLvl1",label:"Vertical Significance 3"},{element:124,key:"cldAmtLvl3",label:"Cloud Amt Lvl3-N3"},{element:125,key:"cldTpLvl3",label:"Cloud Type Lvl3-C3"},{element:126,key:"cldHtLvl3",label:"Cloud Ht Lvl3-HsHs3"},{element:131,key:"cldAmtLvl1",label:"Vertical Significance 4"},{element:128,key:"cldAmtLvl4",label:"Cloud Amt Lvl4-N4"},{element:129,key:"cldTpLvl4",label:"Cloud Type Lvl4-C4"},{element:130,key:"cldHtLvl4",label:"Cloud Ht Lvl4-HsHs4"},{element:167,key:"presentWx",label:"Present WX"},{element:197,key:"pastWx1",label:"Past WX1"},{element:193,key:"pastWx2",label:"Past WX2"},{element:2,key:"tmax",label:"T Max"},{element:3,key:"tmin",label:"T Min"},{element:84,key:"sss24Hr",label:"SSS-24Hr"},{element:132,key:"sss1Hr",label:"SSS-1Hr"},{element:5,key:"precip1Hr",label:"Precip-24Hr"},{element:174,key:"precip3Hr",label:"Precip-3Hr"},{element:112,key:"windDirection",label:"Wind Direction-dd"},{element:111,key:"windSpeed",label:"Wind Speed-ff"},{element:46,key:"insolation",label:"Insolation"}],or=[{path:"",component:A,children:[{path:"hourly",component:Yo,canDeactivate:[G.C],data:{title:"Hourly Data"}},{path:"",redirectTo:"daily",data:{title:"Data Entry"}},{path:"monthly",component:Ne,canDeactivate:[G.C],data:{title:"Monthly Data"}},{path:"hourly-wind",component:_o,canDeactivate:[G.C],data:{title:"Hourly Wind Data"}},{path:"daily",component:Rn,canDeactivate:[G.C],data:{title:"Daily Data for Whole Month"}},{path:"synoptic-carribiean",component:ae,canDeactivate:[G.C],data:{title:"Caribbean Synoptic Data"}},{path:"synoptic-2ra1",component:(()=>{class n{constructor(e,o,r,i){this.modalService=e,this.responsiveSvc=o,this.dataEntryService=r,this.stationService=i,this.submitted=!1,this.loading=!1,this.error="",this.monthModified=!1,this.monthYearValue=new Date,this.bsConfig={isAnimated:!0,containerClass:"theme-blue",dateInputFormat:"DD/MM/YYYY"},this.hour=6,this.hasRecord=!1,this.activeItem=0,this.hoursList=[24,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]}ngOnInit(){this.initForm(),this.responsiveSvc.screenSize.subscribe(e=>{console.log(e)}),this.dataEntryService.synopticState.pipe((0,w.b)(e=>this.loading=!!e),(0,m.h)(e=>!!e),(0,M.q)(1)).subscribe(e=>{console.log(e),this.setFormState(+e.station,new Date(`${e.month}-${e.day}-${e.year}`))})}get f(){return this.form.controls}get isEditable(){return!!this.station}get isModified(){return this.monthModified}get dirtyEntries(){return this.synopticGroup.toArray().filter(e=>!!e.isDirty).length>0}get invalidEntries(){return this.synopticGroup.toArray().filter(e=>!!e.isInvalid).length>0}onFormModified(e){this.monthModified=e}resetStation(){this.station=void 0,this.form.controls.station.reset()}onStationSelect(e){this.station=e,this.form.controls.station.setValue(e.station_id),this.loadSynopData()}onDateSelection(e){if(e){this.date=e;let o=g(e);this.year=o.year(),this.month=o.month()+1,this.day=o.date(),this.loadSynopData()}}getHoursValue(e){return g().set("hours",e).startOf("hour").format("HH:mm")}onReset(){this.form.reset(),this.initForm()}onCancel(){}onReturn(e){e.preventDefault()}onHourSelect(e){this.hour=+this.f.hour.value,this.loadSynopData()}onSubmit(e){if(this.submitted=!0,this.form.invalid)return;if(!this.dirtyEntries)return void(this.error="The form has no inputs, please make some changes and try again.");if(this.form.invalid&&(!this.f.tempRH06GMT.invalid||!this.f.soilTemp05GMT.invalid||!this.f.soilTemp09GMT.invalid||!this.f.windrunRainfall.invalid||!this.f.sunshineEvap.invalid||!this.f.tempRH12GMT.invalid||!this.f.soilTemp13GMT.invalid||!this.f.tempRSoilMoist))return;if(this.invalidEntries)return void(this.error="The agro data contains some invalid entried, please fix the items and try again.");const o=this.buildPayload();this.hasRecord?this.update(o):this.save(o)}get groupArray(){return this.form.get("tags")}get formGroups(){return this.groupArray.controls}keyFocus(e){this.activeItem=e}keyBlur(e){}handleReturn(e){e<this.synopticGroup.toArray().length-1&&this.synopticGroup.toArray()[+e+1].focusValue()}revertItem(e){this.modalService.show(q.S,{initialState:{title:"Confirm Revert",message:"Are you sure you want to revert to original values?",confirm:"Go Ahead",cancel:"Cancel"}}).content.onClose.subscribe(i=>{})}getTagGroup(e,o,r,i,s,p){return new l.cw({index:new l.NI(e),element:new l.NI(o),key:new l.NI(r),label:new l.NI(i),value:new l.NI(s),flag:new l.NI(p||u.N)})}initForm(){this.form=new l.cw({station:new l.NI(null,l.kI.required),dayMonthYear:new l.NI(new Date,l.kI.required),hour:new l.NI(6,[l.kI.min(0),l.kI.max(24)]),tags:new l.Oe([])});for(let e=0;e<et.length;e++)this.groupArray.push(this.getTagGroup(e,et[e].element,et[e].key,et[e].label,""))}setFormState(e,o){this.monthYearValue=o,this.stationService.getStation(e).subscribe(r=>{var i;this.station=r.result[0],this.form.controls.station.setValue(null===(i=this.station)||void 0===i?void 0:i.station_id),this.loadSynopData()})}loadSynopData(){console.log(this.station,this.year,this.month,this.day),this.station&&this.year&&this.month&&this.day&&this.hour&&this.dataEntryService.getSynopticEntry(this.station.station_id,this.year,this.month,this.day,this.hour).pipe((0,w.b)(e=>{this.hasRecord=e.result.length>0}),(0,m.h)(e=>e.result.length),(0,C.U)(e=>e.result[0])).subscribe(e=>{console.log(e),this.hasRecord=!0,this.patchForm(e),this.loading=!1})}patchForm(e){this.synopticGroup.forEach((o,r)=>{let i=Object.assign({},o.group.value);const s={value:e[`val_elem${this.formatEl(i.element)}`],flag:e[`flag${this.formatEl(i.element)}`]};o.group.patchValue(Object.assign({},s))})}save(e){e.mm&&(e.mm=e.mm+1),e.entry_datetime=new Date,console.log(e),this.dataEntryService.addSynopticEntry(e).subscribe(o=>{console.log(o),this.form.markAsPristine()})}update(e){console.log(e);const o=g(this.date),r=o.year(),i=o.month()+1,s=o.date();console.log(r,i,s),delete e.dd,delete e.mm,delete e.yyyy,this.station&&this.date&&this.dataEntryService.updateSynopEntry(this.station.station_id,r,i,s,this.hour,e).subscribe(p=>{console.log(p),this.form.markAsPristine()})}formatEl(e){return e<10?`00${e}`:e<100?`0${e}`:`${e}`}buildPayload(){var e;const o=g(this.date),r={station_id:null===(e=this.station)||void 0===e?void 0:e.station_id,yyyy:o.year(),mm:o.month(),dd:o.date(),hh:this.hour,Val_Elem099:null,total:0,signature:"",entry_datetime:new Date};return this.synopticGroup.forEach(i=>{const s=Object.assign({},i.group.value);r[`Val_Elem${this.formatEl(s.element)}`]=s.value,r[`flag${this.formatEl(s.element)}`]=s.flag}),r}focusFirst(){(0,O.of)(!0).pipe((0,h.g)(100)).subscribe(()=>{this.synopticGroup.toArray()[0].focusValue()})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(x.tT),t.Y36(D.k),t.Y36(U),t.Y36(V.v))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-form-synoptic-ra"]],viewQuery:function(e,o){if(1&e&&t.Gf(Un,5),2&e){let r;t.iGM(r=t.CRH())&&(o.synopticGroup=r)}},decls:4,vars:1,consts:[["novalidate","",3,"formGroup","ngSubmit","keydown.enter",4,"ngIf"],["novalidate","",3,"formGroup","ngSubmit","keydown.enter"],["sm","12",1,"text-end"],["sm","12"],[1,"form-group","p-3","mt-2"],["xs","12","md","6","xl","3"],[1,"mb-2"],["cLabel","","for","station"],["id","station","type","hidden","formControlName","station","aria-label","default input","cFormControl","",3,"ngClass"],["class","typeahead-selection theme form-group",4,"ngIf"],[3,"onSelection",4,"ngIf"],["col","12","class","invalid-feedback",4,"ngIf"],["cLabel","","for","yymmdd"],[1,"mb-3"],["cInputGroupText","","id","basic-addon1"],["cIcon","","name","cilCalendar"],["id","yymmdd","type","hidden","formControlName","dayMonthYear","aria-label","default input","cFormControl","","placeholder","Select Date"],["name","dayMonthYear","placeholder","Select Year & Month","cFormControl","","bsDatepicker","","autocomplete","off",3,"bsConfig","bsValue","ngClass","bsValueChange"],["sm","12","class","invalid-feedback",4,"ngIf"],["cLabel","","for","hoursValue"],["formControlName","hour","aria-label","Hour","cSelect","",3,"ngClass","change"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"form-group","p-3","mt-4"],["formArrayName","tags",4,"ngIf"],["color","info","class","mt-4",4,"ngIf"],[1,"my-4"],["xs","12 py-4"],["type","submit","cButton","","color","dark",1,"px-3"],["aria-hidden","true","size","sm",4,"ngIf"],["type","button","cButton","","color","dark",1,"px-3","mx-1",3,"click"],["type","button","cButton","","color","dark",1,"px-3",3,"click"],[1,"typeahead-selection","theme","form-group"],[1,"typeahead-selection-inner"],[1,"btn",3,"click"],["cIcon","","name","cilX"],[3,"onSelection"],["col","12",1,"invalid-feedback"],[4,"ngIf"],["cIcon","","name","cilXCircle"],["sm","12",1,"invalid-feedback"],[3,"value"],["formArrayName","tags"],["md","12","lg","4"],["md","12",4,"ngFor","ngForOf"],["md","12"],[3,"disabled","modified","group","onReturn","onFocus","onBlur","onDirty","onRevert"],["synopticGroup",""],["color","info",1,"mt-4"],["aria-hidden","true","size","sm"]],template:function(e,o){1&e&&(t.TgZ(0,"h5"),t._uU(1," Synoptic RA1 Data "),t.qZA(),t._UZ(2,"hr"),t.YNc(3,tr,50,22,"form",0)),2&e&&(t.xp6(3),t.Q6J("ngIf",o.form))},directives:[_.O5,l._Y,l.JL,l.sg,c.iok,c.Yp0,P,c.eFW,l.Fj,c.oHf,l.JJ,l.u,_.mk,c.g8K,c.jOm,J.ar,k.Y5,k.Np,l.EJ,c.nqR,l.YN,l.Kr,_.sg,c.Hq3,Y.n,l.CE,gt,c.wxo,c.ORR],pipes:[_.OU],styles:[""]}),n})(),canDeactivate:[G.C],data:{title:"Caribbean 2RA1"}},{path:"agro",component:Gt,canDeactivate:[G.C],data:{title:"Kenya Agromet Data"}}]}];let nr=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[Z.Bz.forChild(or)],Z.Bz]}),n})(),rr=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[_.ez,nr,y.m]]}),n})()},74:($,S,d)=>{d.d(S,{d:()=>E});var _=d(4499),y=d(2835),Z=d(7384),t=d(3668),c=d(453);const T="/v1/obselements";let E=(()=>{class A{constructor(m){this.http=m,this.state$=new _.X({elements:[],limit:10,page:1,pages:1}),this.init=!1;const f=this.state$.getValue();this.getElements(f.page,f.limit)}get elements(){return this.state$.asObservable()}adapt(m){const f={element_id:"Element ID",abbreviation:"Abbreviation",element_name:"Element Name",description:"Description",element_scale:"Element Scale",upper_limit:"Upper Limit",lower_limit:"Lower Limit",units:"Units",element_type:"Element Type",qc_total_required:"QC Total Required",selected:"Selected"};let C=[];return Object.keys(m).filter(h=>"elementId"!==h).forEach(h=>{C.push({key:f[h],value:m[h]||"No Value"})}),C}updateState(m){if(m.page){const f=this.state$.getValue().limit;this.getElements(m.page,f)}m.limit&&this.getElements(1,m.limit)}getElements(m,f){this.http.GET(`${T}?limit=${f}&offset=${(m-1)*f}`).subscribe(h=>{console.log(h),this.state$.next({elements:h.result,limit:f,page:h.page,pages:h.pages}),this.init=!0})}searchElements(m){return this.http.GET(`${T}/search?query=${m}`)}getElement(m){return this.http.GET(`${T}/${m}`)}addElement(m){return this.http.POST(`${T}`,Object.assign({},m)).pipe((0,y.K)(f=>{throw new Error(f.error.message)}),(0,Z.b)(f=>{console.log(f);const C=this.state$.getValue(),{page:h,limit:l}=C;this.getElements(h,l)}))}updateElement(m,f){return this.http.PUT(`${T}/${m}`,f).pipe((0,y.K)(C=>{throw new Error(C.error.message)}),(0,Z.b)(C=>{const h=this.state$.getValue(),{page:l,limit:M}=h;this.getElements(l,M)}))}removeElement(m){this.http.DELETE(`${T}/${m}`).pipe((0,y.K)(f=>{throw new Error(f.error.message)})).subscribe(f=>{const C=this.state$.getValue(),{page:h,limit:l}=C;this.getElements(h,l)})}}return A.\u0275fac=function(m){return new(m||A)(t.LFG(c.O))},A.\u0275prov=t.Yz7({token:A,factory:A.\u0275fac,providedIn:"root"}),A})()},9935:($,S,d)=>{d.d(S,{v:()=>E});var _=d(4499),y=d(2835),Z=d(7384),t=d(3668),c=d(453);let E=(()=>{class A{constructor(m){this.http=m,this.stations$=new _.X({stations:[],limit:10,page:1,pages:1}),this.init=!1;const f=this.stations$.getValue();this.getStations(f.page,f.limit)}get stations(){return this.stations$.asObservable()}adapt(m){const f={station_name:"Station Name",wmoid:"WMO ID",icaoid:"ICAO ID",latitude:"Latitude",longitude:"Longitude",elevation:"Elevation",qualifier:"Qualifier",geolocation_method:"Geo Location Method",geolocation_accuracy:"Geo Location Accurary",opening_datetime:"Opening",closing_datetime:"Closing",country:"Country",authority:"Authority",admin_region:"Admin Region",drainage_basin:"Drainage",waca_selection:"WACA Selection",cpt_selection:"SCP SELECTION",station_operational:"Station Operational"};let C=[];return Object.keys(m).filter(h=>-1===["station_id","station_name"].indexOf(h)).forEach(h=>{const l={};switch(l.key=f[h],l.value=m[h]||"No Value",h){case"opening_datetime":case"closing_datetime":case"closing_datetime":l.type="date";break;default:l.type=null}C.push(l)}),C}updateState(m){if(m.page){const f=this.stations$.getValue().limit;this.getStations(m.page,f)}m.limit&&this.getStations(1,m.limit)}getStations(m,f){console.log(m,f),this.http.GET(`/v1/stations?limit=${f}&offset=${(m-1)*f}`).subscribe(h=>{console.log(h),this.stations$.next({stations:h.result,limit:f,page:h.page,pages:h.pages}),this.init=!0})}getStation(m){return this.http.GET(`/v1/stations/${m}`)}searchStation(m){return this.http.GET(`/v1/stations/search?query=${m}`)}addStation(m){return this.http.POST("/v1/stations",Object.assign(Object.assign({},m),{station_id:"2343403"})).pipe((0,y.K)(C=>{throw new Error(C.error.message)}),(0,Z.b)(C=>{console.log(C);const h=this.stations$.getValue(),{page:l,limit:M}=h;this.getStations(l,M)}))}updateStation(m,f){return this.http.PUT(`/v1/stations/${m}`,f).pipe((0,y.K)(C=>{throw new Error(C.error.message)}),(0,Z.b)(C=>{const h=this.stations$.getValue(),{page:l,limit:M}=h;this.getStations(l,M)}))}removeStation(m){this.http.DELETE(`/v1/stations/${m}`).pipe((0,y.K)(f=>{throw new Error(f.error.message)})).subscribe(f=>{const C=this.stations$.getValue(),{page:h,limit:l}=C;this.getStations(h,l)})}getStationElements(m){return this.http.GET(`/v1/stations/${m}/station-elements`)}addStationElement(m){return this.http.POST("/v1/station-elements",m)}updateStationElement(m,f){return this.http.PUT(`/v1/station-elements/${m.recorded_from}/${m.described_by}/${m.recoded_with}/${m.begin_date}`,f)}getStationLocHistory(m){return this.http.GET(`/v1/station-location-histories?belongs_to=${m}`)}addStationLocHistory(m){return this.http.POST("/v1/station-location-histories",m)}updateStationLocHistory(m,f,C){return this.http.PUT(`/v1/station-location-histories/${m}/${f}`,C)}getStationQualifiers(m){return this.http.GET(`/v1/station-qualifiers?belongs_to=${m}`)}}return A.\u0275fac=function(m){return new(m||A)(t.LFG(c.O))},A.\u0275prov=t.Yz7({token:A,factory:A.\u0275fac,providedIn:"root"}),A})()},6566:($,S,d)=>{d.d(S,{Y:()=>O});var _=d(7384),y=d(3668),Z=d(8305),t=d(9463),c=d(3067),T=d(4753),E=d(6921),A=d(2997),w=d(74),m=d(9133),f=d(9097),C=d(6019);function h(g,q){1&g&&(y.TgZ(0,"div",3),y._UZ(1,"img",4),y._uU(2," searching..."),y.qZA())}function l(g,q){if(1&g&&(y.TgZ(0,"div",5),y._uU(1),y.qZA(),y.TgZ(2,"div",6),y._uU(3),y.qZA()),2&g){const u=q.item;y.xp6(1),y.AsE("",u.element_id," - ",u.abbreviation,""),y.xp6(2),y.hij(" ",u.element_name," ")}}const M=function(g){return{loading:g}};let O=(()=>{class g{constructor(u){this.elementService=u,this.onSelection=new y.vpe,this.typeaheadLoading=!1,this.typeaheadNoResults=!1,this.loading=!1,this.search="",this.errorMessage=""}ngOnInit(){this.elements$=new Z.y(u=>{u.next(this.search)}).pipe((0,t.b)(400),(0,_.b)(()=>{this.loading=!0}),(0,c.w)(u=>(console.log(u),u?this.elementService.searchElements(u).pipe((0,_.b)(()=>{this.loading=!1}),(0,T.U)(F=>F.result||[]),(0,_.b)(()=>E.Z,F=>{this.errorMessage=F&&F.message||"search failed"})):(0,A.of)([]))))}changeTypeaheadLoading(u){this.typeaheadLoading=u}onSelect(u){this.selected=u.item,this.onSelection.emit(u.item)}}return g.\u0275fac=function(u){return new(u||g)(y.Y36(w.d))},g.\u0275cmp=y.Xpm({type:g,selectors:[["app-element-selection"]],outputs:{onSelection:"onSelection"},decls:4,vars:9,consts:[["typeaheadOptionField","element_name","autocomplete","off","autocorrect","off","placeholder","Described By",1,"form-control",3,"ngModel","typeahead","typeaheadAsync","typeaheadOptionsLimit","typeaheadItemTemplate","ngClass","ngModelChange","typeaheadLoading","typeaheadOnSelect"],["class","typeahead-loading",4,"ngIf"],["itemTemplate",""],[1,"typeahead-loading"],["src","./assets/img/gif/spinner.gif","alt",""],[1,"item-heading"],[1,"item-title"]],template:function(u,F){if(1&u&&(y.TgZ(0,"input",0),y.NdJ("ngModelChange",function(x){return F.search=x})("typeaheadLoading",function(x){return F.changeTypeaheadLoading(x)})("typeaheadOnSelect",function(x){return F.onSelect(x)}),y.qZA(),y.YNc(1,h,3,0,"div",1),y.YNc(2,l,4,3,"ng-template",null,2,y.W1O)),2&u){const b=y.MAs(3);y.Q6J("ngModel",F.search)("typeahead",F.elements$)("typeaheadAsync",!0)("typeaheadOptionsLimit",7)("typeaheadItemTemplate",b)("ngClass",y.VKq(7,M,F.typeaheadLoading)),y.xp6(1),y.Q6J("ngIf",F.loading)}},directives:[m.Fj,m.JJ,m.On,f.Bp,C.mk,C.O5],styles:[".item-heading[_ngcontent-%COMP%]{font-size:.7rem}.item-title[_ngcontent-%COMP%]{font-size:.9rem}"]}),g})()},4379:($,S,d)=>{d.d(S,{$:()=>y});var _=d(3668);let y=(()=>{class Z{constructor(){}ngOnInit(){}}return Z.\u0275fac=function(c){return new(c||Z)},Z.\u0275cmp=_.Xpm({type:Z,selectors:[["app-infinite-loading"]],decls:2,vars:0,consts:[[1,"infinite-loader"],[1,"loader-bar"]],template:function(c,T){1&c&&(_.TgZ(0,"div",0),_._UZ(1,"div",1),_.qZA())},styles:['.infinite-loader[_ngcontent-%COMP%]{width:100%;margin:0 auto;border-radius:10px;border:4px solid transparent;position:relative;padding:1px}.infinite-loader[_ngcontent-%COMP%]:before{content:"";border:1px solid #1697ec;border-radius:10px;position:absolute;top:-4px;right:-4px;bottom:-4px;left:-4px}.infinite-loader[_ngcontent-%COMP%]   .loader-bar[_ngcontent-%COMP%]{position:absolute;border-radius:10px;top:0;right:100%;bottom:0;left:0;background:#1697ec;width:0;animation:borealisBar 1s linear infinite}@keyframes borealisBar{0%{left:0%;right:100%;width:0%}10%{left:0%;right:75%;width:25%}90%{right:0%;left:75%;width:25%}to{left:100%;right:0%;width:0%}}']}),Z})()},5154:($,S,d)=>{d.d(S,{n:()=>q});var _=d(3668),y=d(8305),Z=d(9463),t=d(7384),c=d(3067),T=d(4753),E=d(6921),A=d(2835),w=d(2997),m=d(9935),f=d(9133),C=d(9097),h=d(6019);function l(u,F){1&u&&(_.TgZ(0,"div",4),_._UZ(1,"img",5),_._uU(2," searching..."),_.qZA())}function M(u,F){if(1&u&&(_.TgZ(0,"div",6),_.TgZ(1,"div",7),_._uU(2),_.qZA(),_.qZA()),2&u){const b=_.oxw();_.xp6(2),_.Oqu(b.errorMessage)}}function O(u,F){if(1&u&&(_.TgZ(0,"div",8),_._uU(1),_.qZA(),_.TgZ(2,"div",9),_._uU(3),_.qZA()),2&u){const b=F.item;_.xp6(1),_.AsE("",b.station_id," - ",b.station_name,""),_.xp6(2),_.hij(" ",b.element_name," ")}}const g=function(u){return{loading:u}};let q=(()=>{class u{constructor(b){this.stationService=b,this.placeholder="Station",this.onSelection=new _.vpe,this.typeaheadLoading=!1,this.typeaheadNoResults=!1,this.loading=!1,this.search="",this.errorMessage=""}ngOnInit(){this.stations$=new y.y(b=>{b.next(this.search)}).pipe((0,Z.b)(400),(0,t.b)(()=>{this.errorMessage="",this.loading=!0}),(0,c.w)(b=>b?this.stationService.searchStation(b).pipe((0,t.b)(()=>{this.loading=!1}),(0,T.U)(x=>x.result||[]),(0,t.b)(()=>E.Z,x=>{this.loading=!1,this.errorMessage=x&&x.message||"station search failed"}),(0,A.K)(x=>(this.errorMessage="station search failed",(0,w.of)(x)))):(0,w.of)([])))}changeTypeaheadLoading(b){this.typeaheadLoading=b}onSelect(b){this.selected=b.item,this.onSelection.emit(b.item)}}return u.\u0275fac=function(b){return new(b||u)(_.Y36(m.v))},u.\u0275cmp=_.Xpm({type:u,selectors:[["app-station-selection"]],inputs:{placeholder:"placeholder"},outputs:{onSelection:"onSelection"},decls:5,vars:11,consts:[["typeaheadOptionField","station_name","autocomplete","off","autocorrect","off",1,"form-control",3,"ngModel","typeahead","typeaheadAsync","typeaheadOptionsLimit","typeaheadItemTemplate","ngClass","placeholder","ngModelChange","typeaheadLoading","typeaheadOnSelect"],["class","typeahead-loading",4,"ngIf"],["ngClass","typeahead-error","class","typeahead-loading",4,"ngIf"],["itemTemplate",""],[1,"typeahead-loading"],["src","./assets/img/gif/spinner.gif","alt",""],["ngClass","typeahead-error",1,"typeahead-loading"],[1,"typeahead-error-inner"],[1,"item-heading"],[1,"item-title"]],template:function(b,x){if(1&b&&(_.TgZ(0,"input",0),_.NdJ("ngModelChange",function(H){return x.search=H})("typeaheadLoading",function(H){return x.changeTypeaheadLoading(H)})("typeaheadOnSelect",function(H){return x.onSelect(H)}),_.qZA(),_.YNc(1,l,3,0,"div",1),_.YNc(2,M,3,1,"div",2),_.YNc(3,O,4,3,"ng-template",null,3,_.W1O)),2&b){const D=_.MAs(4);_.Q6J("ngModel",x.search)("typeahead",x.stations$)("typeaheadAsync",!0)("typeaheadOptionsLimit",7)("typeaheadItemTemplate",D)("ngClass",_.VKq(9,g,x.typeaheadLoading))("placeholder",x.placeholder),_.xp6(1),_.Q6J("ngIf",x.loading),_.xp6(1),_.Q6J("ngIf",!x.loading&&x.errorMessage)}},directives:[f.Fj,f.JJ,f.On,C.Bp,h.mk,h.O5],styles:[".typeahead-loading[_ngcontent-%COMP%]{padding:.3rem .6rem;font-size:.9rem}.typeahead-loading[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:18px;margin-right:.2rem}typeahead-container[_ngcontent-%COMP%]   .dropdown-item.active[_ngcontent-%COMP%]{background-color:#277bc9!important}.item-heading[_ngcontent-%COMP%]{font-size:.7rem}.item-title[_ngcontent-%COMP%]{font-size:.9rem}.typeahead-error[_ngcontent-%COMP%]{margin-top:.2rem;padding:0 .3rem}.typeahead-error-inner[_ngcontent-%COMP%]{padding:.1rem .3rem;font-size:.9rem;background-color:#ffd9d9;border:1px solid #c7a9a9;border-radius:.2rem;color:#d11a1a}"]}),u})()}}]);